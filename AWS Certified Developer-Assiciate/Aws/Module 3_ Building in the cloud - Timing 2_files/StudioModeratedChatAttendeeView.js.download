var StudioModeratedChatAttendeeRow=function(oStudioModeratedChatObj){var oData={},oElem=document.createElement("div");if(oElem.className="StudioModeratedChatItem",2==g_iStudioModeratedChatShowUserNames||1==g_iStudioModeratedChatShowUserNames&&oStudioModeratedChatObj.FromModerator){var oUserName=document.createElement("div");oUserName.className="StudioModeratedChatItemQuestionTextName",oUserName.appendChild(document.createTextNode(oStudioModeratedChatObj.UserName+": ")),oElem.appendChild(oUserName)}var oPrivateParent,oPrivate,oQuestion=document.createElement("div");if(oQuestion.className="StudioModeratedChatItemQuestionText",oStudioModeratedChatObj.ParentKey&&((oPrivateParent=document.createElement("div")).className="StudioModeratedChatPrivateFlagContainer",oQuestion.appendChild(oPrivateParent),(oPrivate=document.createElement("div")).className="StudioModeratedChatPrivateFlag",oPrivate.title=g_oMessages.PrivateChat,oPrivate.appendChild(document.createTextNode(g_oMessages.PrivateChat)),oStudioModeratedChatObj.Published||oPrivateParent.appendChild(oPrivate)),oElem.appendChild(oQuestion),oQuestion.innerText=oStudioModeratedChatObj.Text,oStudioModeratedChatObj.DateTime&&g_bShowTime){var oDate=document.createElement("div");oDate.className="StudioModeratedChatItemQuestionDate",oDate.appendChild(document.createTextNode(oStudioModeratedChatObj.DateTime)),oElem.appendChild(oDate)}var oMoreInfoContainer=document.createElement("div");oMoreInfoContainer.className="StudioModeratedChatItemMoreInfo",oElem.appendChild(oMoreInfoContainer);for(var iLup=0;iLup<oStudioModeratedChatObj.Children.length;iLup++)oMoreInfoContainer.appendChild(StudioModeratedChatAttendeeViewModeratorRow(oStudioModeratedChatObj.Children[iLup]));if(!oStudioModeratedChatObj.ParentKey&&oStudioModeratedChatObj.UserKey==g_oSettings.UserKey){var oWrapper=document.createElement("div");oWrapper.className="StudioModeratedChatSubmitContainer";var oTIWrapper=document.createElement("div");oTIWrapper.className="StudioModeratedChatInputWrap";var oInput=document.createElement("input");oInput.type="text",oInput.className="AxiomInput",oInput.placeholder=g_oMessages.GCEnterMessageHere,oInput.addEventListener("keydown",function(evt){13==evt.keyCode&&OnSubmit(evt)}),oTIWrapper.appendChild(oInput),oWrapper.appendChild(oTIWrapper);var oSubBtnWrapper=document.createElement("div");oSubBtnWrapper.className="StudioModeratedChatSubmitBtnWrapper";var oSubBtn=document.createElement("div");oSubBtn.className="StudioModeratedChatSubmitBtnWithText",oSubBtn.addEventListener("click",OnSubmit);var oText=document.createElement("div");oText.className="StudioModeratedChatSubmitBtnText",oText.appendChild(document.createTextNode(g_oMessages.Reply)),oSubBtn.appendChild(oText),oSubBtnWrapper.appendChild(oSubBtn),oWrapper.appendChild(oSubBtnWrapper),oElem.appendChild(oWrapper)}function OnSubmit(evt){oData.OnSubmit&&oData.OnSubmit(evt)}return oData.Element=oElem,oData.ChildrenElement=oMoreInfoContainer,oData.PrivateFlag=oPrivate,oData.PrivateParent=oPrivateParent,oData.OnSubmit,oData.Input=oInput,oData},SMC_USER_MESSAGE_PERSIST=0,SMC_USER_MESSAGE_FLASH=1,StudioModeratedChatAttendeeLayout=function(oSMCObj){var _this=this,m_oDisplayList=null,m_oContainer=null,m_oHeader=null,m_oInput=null,m_oUserMessageContainer=null,m_oCurrentMessage=null,m_oContent=null,m_oTextInput=null,m_oItems={},m_oFilterSuite=null,m_bActive=!1,m_fnOnActiveChange=null,m_bLoading=!1,m_oAutoScrolly=null,m_aVisibleData=[];function CheckAppend(oFilterable){!oFilterable.Filtered&&QuestionPassesVisibilityTest(oFilterable.Data)&&m_aVisibleData.indexOf(oFilterable.Data.AttendeeElementData.Element)<0&&m_oAutoScrolly&&(m_oAutoScrolly.appendChild(oFilterable.Data.AttendeeElementData.Element),m_aVisibleData.push(oFilterable.Data.AttendeeElementData.Element))}function HandleKeyDown(evt){13==evt.keyCode&&OnSubmit(evt)}function OnSubmit(evt){if(evt.preventDefault(),evt.stopPropagation(),""!=m_oTextInput.value.replace(/\s/g,"")){oSMCObj.QueueQuestion(m_oTextInput.value,MC_PRIO_MED,0,0);var cMessage=oSMCObj.Messages.MessageSent;_this.SetUserMessage(cMessage,SMC_USER_MESSAGE_FLASH),m_oTextInput.value=""}else _this.SetUserMessage("You cannot send an empty message.",SMC_USER_MESSAGE_FLASH)}function QuestionPassesVisibilityTest(oSMChatObj){var bRetVal=!1;return(bRetVal=oSMChatObj.Children.some(function(oSMCChildObj){return oSMCChildObj.Published||oSMCChildObj.UserKey==oSMCObj.UserData.UserKey&&oSMCChildObj.UserType==oSMCObj.UserData.UserType}))||(bRetVal=oSMChatObj.UserKey==oSMCObj.UserData.UserKey&&oSMChatObj.UserType==oSMCObj.UserData.UserType&&oSMChatObj.Children.length||(oSMChatObj.Priority&STUDIOMC_PUBLISH_NO_ANSWER)==STUDIOMC_PUBLISH_NO_ANSWER||oSMCObj.IsAdmin&&oSMChatObj.Children.length),bRetVal}function AnswerPassesVisibilityTest(oSMChatObj){var bRetVal=!1;return(bRetVal=oSMChatObj.Published||oSMChatObj.UserKey==oSMCObj.UserData.UserKey&&oSMChatObj.UserType==oSMCObj.UserData.UserType||oSMCObj.IsAdmin)||m_oItems[oSMChatObj.ParentKey]&&m_oItems[oSMChatObj.ParentKey].Data.UserKey==oSMCObj.UserData.UserKey&&m_oItems[oSMChatObj.ParentKey].Data.UserType==oSMCObj.UserData.UserType&&(bRetVal=!0),bRetVal}function ProcessSubscriptionEvent(oData){var aElems=[],aQuestionsToDisplay=[];oData.Result.forEach(function(oFilterable){!oFilterable.Filtered&&QuestionPassesVisibilityTest(oFilterable.Data)&&aQuestionsToDisplay.push(oFilterable)}),aQuestionsToDisplay.forEach(function(oFilterable){for(aElems.push(oFilterable.Data.AttendeeElementData.Element);oFilterable.Data.AttendeeElementData.ChildrenElement.childNodes.length;)oFilterable.Data.AttendeeElementData.ChildrenElement.removeChild(oFilterable.Data.AttendeeElementData.ChildrenElement.firstChild);oFilterable.Data.Children.forEach(function(oChild){AnswerPassesVisibilityTest(oChild)&&(oFilterable.Data.AttendeeElementData.ChildrenElement.appendChild(oChild.AttendeeElementData.Element),oChild.Published&&oChild.AttendeeElementData.PrivateParent&&oChild.AttendeeElementData.PrivateFlag.parentNode==oChild.AttendeeElementData.PrivateParent?oChild.AttendeeElementData.PrivateParent.removeChild(oChild.AttendeeElementData.PrivateFlag):!oChild.Published&&oChild.AttendeeElementData.PrivateParent&&oChild.AttendeeElementData.PrivateParent.appendChild(oChild.AttendeeElementData.PrivateFlag))})}),function(aElems){m_oAutoScrolly&&(m_oAutoScrolly.removeAllChildren(),m_oAutoScrolly.appendChildren(aElems),m_aVisibleData=aElems)}(aElems)}Object.defineProperties(this,{Container:{get:function(){return m_oContainer}},Content:{get:function(){return m_oContent}},ListObj:{get:function(){return m_oDisplayList}},Header:{get:function(){return m_oHeader}},OnSubmit:{set:function(fnOnSubmit){"function"==typeof fnOnSubmit?fnOnSubmit:null}},TextInput:{get:function(){return m_oTextInput}},Active:{get:function(){return m_bActive},set:function(bActive){"boolean"==typeof bActive&&(m_bActive=bActive,m_oContainer.setAttribute("data-active",m_bActive?1:0),m_fnOnActiveChange&&m_fnOnActiveChange())}},OnActiveChange:{set:function(fnOnActiveChange){m_fnOnActiveChange="function"==typeof fnOnActiveChange?fnOnActiveChange:null}},FilterSuite:{get:function(){return m_oFilterSuite},set:function(oFilterSuite){"function"==typeof oFilterSuite?(m_oFilterSuite=new oFilterSuite(m_oItems,oSMCObj)).Publisher&&m_oFilterSuite.Publisher.Subscribe(new InxpoSubscriber("FilterComplete",ProcessSubscriptionEvent)):m_oFilterSuite=null}},Loading:{get:function(){return m_bLoading},set:function(bLoading){m_bLoading=!!bLoading}}}),this.ShowHeader=function(bShow){m_oHeader.setAttribute("data-active",bShow?1:0)},this.ShowInput=function(bShow){m_oUserMessageContainer.setAttribute("data-active",bShow?1:0),m_oInput.setAttribute("data-active",bShow?1:0)},this.OnItemAdded=function(oCustomEventObj){_this.AddItem(oCustomEventObj.Data)},this.OnItemRemoved=function(oCustomEventObj){var oSMCItem=oCustomEventObj.Data;m_oItems[oSMCItem.Key]&&_this.RemoveItem(oSMCItem.Key)},this.OnChildAdded=function(oCustomEventObj){var oParent=m_oItems[oCustomEventObj.Data.Key];if(oParent||_this.AddItem(oCustomEventObj.Data),oParent=m_oItems[oCustomEventObj.Data.Key]){for(;oParent.Data.AttendeeElementData.ChildrenElement.childNodes.length;)oParent.Data.AttendeeElementData.ChildrenElement.removeChild(oParent.Data.AttendeeElementData.ChildrenElement.firstChild);oParent.Data.Children.forEach(function(oChild){AnswerPassesVisibilityTest(oChild)&&(oParent.Data.AttendeeElementData.ChildrenElement.appendChild(oChild.AttendeeElementData.Element),oChild.Published&&oChild.AttendeeElementData.PrivateParent&&oChild.AttendeeElementData.PrivateFlag.parentNode==oChild.AttendeeElementData.PrivateParent?oChild.AttendeeElementData.PrivateParent.removeChild(oChild.AttendeeElementData.PrivateFlag):!oChild.Published&&oChild.AttendeeElementData.PrivateParent&&oChild.AttendeeElementData.PrivateParent.appendChild(oChild.AttendeeElementData.PrivateFlag))}),CheckAppend(oParent)}},this.OnChildRemoved=function(oCustomEventObj){var oParent=m_oItems[oCustomEventObj.Data.Key];if(oParent){for(;oParent.Data.AttendeeElementData.ChildrenElement.childNodes.length;)oParent.Data.AttendeeElementData.ChildrenElement.removeChild(oParent.Data.AttendeeElementData.ChildrenElement.firstChild);var bRemoveQuestion=!1;oParent.Data.Children.length?(oParent.Data.Children.forEach(function(oChild){AnswerPassesVisibilityTest(oChild)&&oParent.Data.AttendeeElementData.ChildrenElement.appendChild(oChild.AttendeeElementData.Element)}),oParent.Data.AttendeeElementData.ChildrenElement.childNodes||(bRemoveQuestion=!0)):bRemoveQuestion=!0,bRemoveQuestion&&_this.RemoveItem(oParent.Data.Key)}},this.OnAttendeeNodeUpdated=function(oCustomEventObj){m_oDisplayList.Container.contains(oCustomEventObj.OldData.Element)&&oCustomEventObj.OldData.Element.parentNode.replaceChild(oCustomEventObj.NewData.Element,oCustomEventObj.OldData.Element)},this.OnPublishedUpdated=function(oCustomEventObj){m_oFilterSuite?_this.FilterSuite.ProcessFilters():ProcessSubscriptionEvent({Result:Object.keys(m_oItems).map(function(iKey){return m_oItems[iKey]})})},this.OnPriorityUpdated=function(oCustomEventObj){if(oCustomEventObj.Data.Priority&STUDIOMC_PUBLISH_NO_ANSWER){var oFilterable=m_oItems[oCustomEventObj.Data.Key];oFilterable?(m_oFilterSuite&&m_oFilterSuite.ApplyFiltersSingle(oFilterable),CheckAppend(oFilterable)):_this.AddItem(oCustomEventObj.Data)}},this.AddItem=function(oSMCItem){if(oSMCItem instanceof StudioModeratedChat&&oSMCItem&&!m_oItems[oSMCItem.Key]){var oFilterable=new StudioModeratedChatFilterableItem(oSMCItem);m_oItems[oSMCItem.Key]=oFilterable,m_oFilterSuite&&m_oFilterSuite.ApplyFiltersSingle(oFilterable),CheckAppend(oFilterable)}},this.RemoveItem=function(iKey){var oFilterable=m_oItems[iKey];oFilterable&&(oFilterable.Data.AttendeeElementData.Element&&oFilterable.Data.AttendeeElementData.Element.parentNode==m_oDisplayList.Container&&m_oDisplayList.RemoveElem(oFilterable.Data.AttendeeElementData.Element),delete m_oItems[iKey],m_oAutoScrolly.removeChild(oFilterable.Data.AttendeeElementData.Element))},this.OnResize=function(oSizeData){m_oFilterSuite&&m_oFilterSuite.FilterActive&&(oSizeData.height-=MC_MOD_ATT_HEIGHT_FILTER_OFFSET),m_oAutoScrolly&&m_oAutoScrolly.setPageSize(oSizeData)},this.SetUserMessage=function(cMessage,iType){m_oCurrentMessage?m_oCurrentMessage.UpdateText(cMessage):m_oCurrentMessage||(m_oCurrentMessage=new function(cMessage,bShowClose,iType){var _this=this;this.Type=iType;var m_iTimeout=null,m_iMsgHeight=0,m_iMsgScrollHeight=0;this.Container=document.createElement("div"),this.Container.className="StudioModeratedChatUserMessage";var oDisplay=document.createElement("div");oDisplay.className="StudioModeratedChatUserMessageDisplay",_this.Container.appendChild(oDisplay);var oMsg=document.createElement("div");if(oMsg.className="StudioModeratedChatUserMessageText",oMsg.innerText=cMessage,oDisplay.appendChild(oMsg),bShowClose){var oElem=document.createElement("div");oElem.className="StudioModeratedChatUserMessageClose",oElem.addEventListener("click",Close),oDisplay.appendChild(oElem)}function TransitionEnd(evt){m_oUserMessageContainer.contains(_this.Container)&&(m_oUserMessageContainer.removeChild(_this.Container),m_oCurrentMessage=null)}function Close(evt){m_iTimeout&&clearTimeout(m_iTimeout),_this.Container.addEventListener("transitionend",TransitionEnd),_this.Container.removeAttribute("data-active"),_this.Container.style.height="0px"}this.UpdateText=function(cText){""!=cText&&(oMsg.innerText=cText)},this.Activate=function(bSuppressTimeout){_this.Container.removeEventListener("transitionend",TransitionEnd),_this.Container.setAttribute("data-active",1),m_iMsgHeight||(m_iMsgHeight=oDisplay.offsetHeight+oMsg.scrollHeight),oMsg.scrollHeight!=m_iMsgScrollHeight&&(m_iMsgScrollHeight=oMsg.scrollHeight),_this.Container.style.height=m_iMsgHeight+m_iMsgScrollHeight+"px",m_iTimeout&&(clearTimeout(m_iTimeout),_this.Container.removeAttribute("data-announce"),_this.Container.offsetWidth,_this.Container.setAttribute("data-announce",1)),bSuppressTimeout||(m_iTimeout=setTimeout(Close,3e3))},this.Close=function(){Close(null)}}(cMessage,!0,iType),m_oUserMessageContainer.appendChild(m_oCurrentMessage.Container)),m_oCurrentMessage.Activate(0==iType)},(m_oContainer=document.createElement("div")).className="StudioModeratedChatAttendeeView",m_oContainer.setAttribute("data-active",0),(m_oContent=document.createElement("div")).className="StudioModeratedChatAttendeeContent",m_oContainer.appendChild(m_oContent),(m_oHeader=document.createElement("div")).className="StudioModeratedChatHeaderContainer",m_oHeader.setAttribute("data-active",0),m_oContent.appendChild(m_oHeader),m_oDisplayList=new StudioModeratedChatListDisplay,m_oContent.appendChild(m_oDisplayList.Container),m_oDisplayList.Container.style.overflow="hidden",(m_oUserMessageContainer=document.createElement("div")).className="StudioModeratedChatAttendeeMessageContainer",m_oContent.appendChild(m_oUserMessageContainer),(m_oInput=document.createElement("div")).className="StudioModeratedChatAttendeeViewInputContainer",m_oInput.setAttribute("data-active",0),m_oContent.appendChild(m_oInput),function(){var oWrapper=document.createElement("div");oWrapper.className="StudioModeratedChatSubmitContainer";var oTIWrapper=document.createElement("div");oTIWrapper.className="StudioModeratedChatInputWrap",(m_oTextInput=document.createElement("input")).type="text",m_oTextInput.className="AxiomInput",m_oTextInput.placeholder=oSMCObj.Messages.EnterQuestionPlaceholder,m_oTextInput.addEventListener("keydown",HandleKeyDown),oTIWrapper.appendChild(m_oTextInput),oWrapper.appendChild(oTIWrapper);var oSubBtnWrapper=document.createElement("div");oSubBtnWrapper.className="StudioModeratedChatSubmitBtnWrapper";var oSubBtn=document.createElement("div");oSubBtn.className="StudioModeratedChatSubmitBtnWithText",oSubBtn.addEventListener("click",OnSubmit);var oText=document.createElement("div");oText.className="StudioModeratedChatSubmitBtnText",oText.appendChild(document.createTextNode(oSMCObj.Messages.NewQuestion)),oSubBtn.appendChild(oText),oSubBtnWrapper.appendChild(oSubBtn),oWrapper.appendChild(oSubBtnWrapper),m_oInput.appendChild(oWrapper)}(),m_oAutoScrolly=new AutoScrolly,m_oDisplayList.AddToHead(m_oAutoScrolly.element)},StudioModeratedChatAttendeeFilterSuite=function(m_oFilterables,oSMCObj){var m_oFilterInput,_this=this,m_oContainer=null,m_oFiltersContainer=null,m_iInputTimeout=null,m_oFilter=null,m_oFilters={},m_oPublisher=null,m_bPaused=!1,m_aFilterables=[];function ShowFilters(evt){var iState=m_oFiltersContainer.getAttribute("data-state");m_oFiltersContainer.setAttribute("data-state","0"==iState?1:0),m_oFilter.setAttribute("data-state","0"==iState?1:0),oSMCObj.OnResize()}function OnClear(evt){for(var cKey in m_oFilterInput.value="",m_oFilterables)m_oFilterables[cKey].Filtered=!1;_this.ProcessFilters()}function HandleKeyDown(evt){m_iInputTimeout&&clearTimeout(m_iInputTimeout),m_iInputTimeout=setTimeout(_this.ApplyFiltersMulti,1e3)}Object.defineProperties(this,{Container:{get:function(){return m_oContainer}},Publisher:{get:function(){return m_oPublisher}},FilterActive:{get:function(){return"1"==m_oFiltersContainer.getAttribute("data-state")}},Paused:{get:function(){return m_bPaused},set:function(bPaused){bPaused?m_bPaused=!0:m_bPaused&&(m_bPaused=!1,_this.ProcessFilters())}}}),this.ApplyFiltersSingle=function(oFilterable){for(var cName in oFilterable.Filtered=!1,m_oFilters)if(m_oFilters[cName].ApplyFilter(oFilterable),oFilterable.Filtered)break;oFilterable.InList||(oFilterable.InList=!0,m_aFilterables.push(oFilterable))},this.ApplyFiltersMulti=function(){for(var oFilterable,iLup=0;iLup<m_aFilterables.length;iLup++)oFilterable=m_aFilterables[iLup],_this.ApplyFiltersSingle(oFilterable);_this.ProcessFilters()},this.ProcessFilters=function(){m_oPublisher.Publish("FilterComplete",{Result:m_aFilterables})},function(){if(m_oPublisher=new InxpoPublisher,(m_oContainer=document.createElement("div")).className="StudioModeratedChatModeratorFilterSuiteContainer",oSMCObj.IsAdmin){var oNav=document.createElement("div");oNav.className="AxiomModeratedChatNavRow",m_oContainer.appendChild(oNav);var oClose=document.createElement("div");oClose.className="AxiomCardNavCloseButton",oClose.addEventListener("click",function(evt){oSMCObj.Components.AttendeeLayout.Component.Active=!oSMCObj.Components.AttendeeLayout.Component.Active;var oCB=document.querySelector("[name='DisplayAttendeeView']");oCB&&oSMCObj.Components.AttendeeLayout&&(oCB.checked=!1)}),oNav.appendChild(oClose)}var oHeader=document.createElement("div");oHeader.className="StudioModeratedChatHeader";var oWrapper=document.createElement("div");oWrapper.className="StudioModeratedChatHeaderWrapper",oHeader.appendChild(oWrapper);var oLabel=document.createElement("div");oLabel.className="AxiomLabel",oLabel.appendChild(document.createTextNode(oSMCObj.Messages.AttendeeView)),oWrapper.appendChild(oLabel),m_oContainer.appendChild(oHeader),(m_oFilter=document.createElement("div")).className="StudioModeratedChatFilter",m_oFilter.setAttribute("data-state",0),m_oFilter.addEventListener("click",ShowFilters),oHeader.appendChild(m_oFilter),(m_oFiltersContainer=document.createElement("div")).className="StudioModeratedChatFiltersContainer",m_oFiltersContainer.setAttribute("data-state",0),m_oContainer.appendChild(m_oFiltersContainer);var oTIWrapper=document.createElement("div");oTIWrapper.className="AxiomDGFeatures";var oP=document.createElement("p");oP.className="dgFilter",oTIWrapper.appendChild(oP),(m_oFilterInput=document.createElement("input")).type="text",m_oFilterInput.className="AxiomInput",m_oFilterInput.placeholder=g_oMessages.SearchLabel,m_oFilterInput.addEventListener("keydown",HandleKeyDown),oP.appendChild(m_oFilterInput),m_oFiltersContainer.appendChild(oTIWrapper);var oClearBtnWrapper=document.createElement("div");oClearBtnWrapper.className="StudioModeratedChatClearBtnWrapper";var oClearBtn=document.createElement("div");oClearBtn.className="AxiomGeneralActionButton",oClearBtn.innerText=oSMCObj.Messages.ResetLabel,oClearBtn.addEventListener("click",OnClear),oClearBtnWrapper.appendChild(oClearBtn),m_oFiltersContainer.appendChild(oClearBtnWrapper);var oTextFilter=new StudioModeratedChatFilter("TextSearch",SMCStringFilter(m_oFilterInput));m_oFilters[oTextFilter.Name]=oTextFilter}()};