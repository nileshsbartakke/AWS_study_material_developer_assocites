var GC_LOCAL_STORGE_READING_MODE_KEY="AxiomGroupChatReadingMode",MODERATOR_RIGHTS_QA_ONLY=8388608;function GroupChat(oLightningSettings,oMessages,oChatRoomDetails,oUserDetails){var m_iExecuteTimeout,m_iPollingTimeout,m_iLastMessageSeen,m_bRunning,m_oAJAX,m_aAJAXQueue,m_aHistoryKeys,m_oHistoryMap,m_oUserListMap,_this=this,CHAT_USER_ADD_VALUE=10,POLLING_INTERVAL=3e3,EXECUTE_INTERVAL=50,m_oChatRoomDetails=oChatRoomDetails,m_oUserDetails=oUserDetails,m_oLightningSettings=oLightningSettings,m_oMessages=oMessages;_this.HistoryElement=null,_this.UserListElement=null;var m_fnStartListeningCallback=null,m_fnStopListeningCallback=null,m_bPolling=!0;function AddToHistory(oData,bProcessLinkText){if((iKey=oData.DetailsKey)&&!m_oHistoryMap[iKey]){var bAutoScroll=!1;if(_this.HistoryElement.parentNode)Math.ceil(_this.HistoryElement.parentNode.scrollTop)+10>=_this.HistoryElement.parentNode.scrollHeight-_this.HistoryElement.parentNode.offsetHeight&&(bAutoScroll=!0);oData.LocaleID=parseInt(oData.LocaleID),oData.DateFmtMask=m_oChatRoomDetails.DateFmtMask,oData.ChatUserKey||(oData.ChatUserKey=oData.UserKey),oData.PostText=bProcessLinkText?_this.CreateLinkText(oData.PostText):oData.PostText,oData.ChatRoomKey=m_oChatRoomDetails.ChatRoomKey,oData.bSelf=oData.ChatUserKey==m_oUserDetails.ChatUserKey,oData.bModerator=m_oUserDetails.Moderator,oData.bDisplayUserImages=m_oChatRoomDetails.DisplayUserImages,oData.bNeedsTranslation=!oData.bSelf&&oData.LocaleID>0&&m_oUserDetails.LocaleID!=oData.LocaleID&&m_oChatRoomDetails.TranslatorMethod>0;var oRow=_this.CreateMessageRow(oData);if(_this.HistoryElement.appendChild(oRow),m_oHistoryMap[iKey]=oRow,m_aHistoryKeys.push(iKey),bAutoScroll&&_this.ScrollToBottom(),m_oChatRoomDetails&&m_oChatRoomDetails.MaxDisplayChatLines&&m_aHistoryKeys.length>m_oChatRoomDetails.MaxDisplayChatLines){var iKey=m_aHistoryKeys.splice(0,1)[0],oElem=m_oHistoryMap[iKey];oElem&&(oElem.parentNode&&oElem.parentNode.removeChild(oElem),delete m_oHistoryMap[iKey])}}}function AddMessageHelper(aData){AddToAJAXQueue("LASCmd=AI:"+m_oLightningSettings.InstanceID+";F:CHAT!680&OpCode=A&ChatRoomKey="+m_oChatRoomDetails.ChatRoomKey+"&ChatUserKey="+m_oUserDetails.ChatUserKey+"&Message="+encodeURIComponent(JSON.stringify(aData)),null,null)}function NextMessagePoll(){var cParams="LASCmd=AI:"+m_oLightningSettings.InstanceID+";F:CHAT!680&OpCode=G&ChatRoomKey="+m_oChatRoomDetails.ChatRoomKey+"&ChatUserKey="+m_oUserDetails.ChatUserKey+"&LastMessageSeen="+m_iLastMessageSeen+"&UserName="+encodeURIComponent(m_oUserDetails.UserName)+"&EmoticonImage="+encodeURIComponent(m_oUserDetails.EmoticonImage);AddToAJAXQueue(RandomizeURL(cParams),MessagePollOnComplete,MessagePollOnError)}function MessagePollOnComplete(cResult){var oResult=InxpoAJAXEvalJSON(cResult);if(0==oResult.Status){var aData;m_iLastMessageSeen=oResult.LMS;for(var oList=oResult.Data,iLup=0;iLup<oList.length;iLup++)(aData=oList[iLup])&&aData.length&&_this.ProcessChatData(aData)}m_bRunning&&(m_iPollingTimeout=setTimeout(NextMessagePoll,POLLING_INTERVAL))}function MessagePollOnError(cResult){m_bRunning&&(m_iPollingTimeout=setTimeout(NextMessagePoll,POLLING_INTERVAL))}function AddToAJAXQueue(cParams,fnOnComplete,fnOnError){m_aAJAXQueue.push({Params:cParams,OnComplete:fnOnComplete,OnError:fnOnError}),ExecuteNextAJAX()}function ExecuteNextAJAX(){m_bRunning&&(m_iExecuteTimeout||(m_iExecuteTimeout=setTimeout(ExecuteNextAJAXHelper,EXECUTE_INTERVAL)))}function ExecuteNextAJAXHelper(){if(m_iExecuteTimeout=0,m_aAJAXQueue.length>0){var oData=m_aAJAXQueue.splice(0,1)[0];m_aAJAXQueue[0];m_oAJAX.Abort(),m_oAJAX.OnComplete=function(a,b,c){oData.OnComplete&&oData.OnComplete(a,b,c),ExecuteNextAJAX()},m_oAJAX.OnError=function(a,b,c){oData.OnError&&oData.OnError(a,b,c),ExecuteNextAJAX()},m_oAJAX.SendRequest("POST","/scripts/"+m_oLightningSettings.LASFileName,oData.Params)}}_this.CreateMessageRow=function(oData){return document.createElement("div")},_this.CreateUserRow=function(oData){return document.createElement("div")},_this.SetFont=function(cName,cSize,cType,cColor){},_this.ProcessHistroyMessages=function(aMessages){for(var oData,iLup=0;iLup<aMessages.length;iLup++)(oData=aMessages[iLup]).PostText&&AddToHistory(oData,!0)},_this.AddMessage=function(cMessage){AddToAJAXQueue("LASCmd=AI:"+m_oLightningSettings.InstanceID+";F:CHAT!660&ChatRoomKey="+m_oChatRoomDetails.ChatRoomKey+"&ChatUserKey="+m_oUserDetails.ChatUserKey+"&UserName="+encodeURIComponent(m_oUserDetails.UserName)+"&LocaleID="+m_oUserDetails.LocaleID+"&FrontTag="+encodeURIComponent(m_oUserDetails.FrontTag)+"&EndTag="+encodeURIComponent(m_oUserDetails.EndTag)+"&PostText="+encodeURIComponent(cMessage)+"&EmoticonImage="+encodeURIComponent(m_oUserDetails.EmoticonImage),function(cResult){if("E"!=cResult.substring(0,1)){var aLine=cResult.split("|^|"),oLine=new Object;oLine.DetailsKey=parseInt(aLine[0]),oLine.UserName=aLine[1],oLine.UserKey=parseInt(aLine[2]),oLine.PostDate=aLine[3],oLine.LocaleID=parseInt(aLine[4]),oLine.FrontTag=aLine[5],oLine.EndTag=aLine[6],oLine.PostText=_this.CreateLinkText(aLine[7]),AddMessageHelper([20,oLine])}},function(cResult){})},_this.RemoveMessage=function(iDetailsKey){m_oUserDetails.Moderator&&AddToAJAXQueue("LASCmd=AI:"+m_oLightningSettings.InstanceID+";F:CHAT!661&ChatRoomKey="+m_oChatRoomDetails.ChatRoomKey+"&ChatRoomDetailKey="+iDetailsKey,function(cResult){var aLine=cResult.split("|^|");"S"==aLine[0]&&AddMessageHelper([23,aLine[1]])},function(cResult){alert(m_oMessages.ServerUnavailable)})},_this.StartListening=function(bPreventPolling,fnStartListeningCallback,fnStopListeningCallback){var cParams;m_bPolling=!bPreventPolling,fnStartListeningCallback&&(m_fnStartListeningCallback=fnStartListeningCallback),fnStopListeningCallback&&(m_fnStopListeningCallback=fnStopListeningCallback),_this.StopListening(),m_bRunning=!0,m_oLightningSettings=oLightningSettings,m_oAJAX=new InxpoAJAXObject,m_bPolling?(cParams="LASCmd=AI:"+m_oLightningSettings.InstanceID+";F:CHAT!680&OpCode=C&ChatRoomKey="+m_oChatRoomDetails.ChatRoomKey+"&ChatUserKey="+m_oUserDetails.ChatUserKey+"&UserName="+encodeURIComponent(m_oUserDetails.UserName)+"&EmoticonImage="+encodeURIComponent(m_oUserDetails.EmoticonImage),m_oAJAX.Abort(),m_oAJAX.OnComplete=function(cResult){var oResult=InxpoAJAXEvalJSON(cResult);if(0==oResult.Status){var oUser;m_iLastMessageSeen=parseInt(oResult.CMID)-1;for(var oList=oResult.Data,iLup=0;iLup<oList.length;iLup++)(oUser=oList[iLup])&&_this.ProcessChatData([CHAT_USER_ADD_VALUE,oUser]);m_bPolling&&NextMessagePoll(),m_fnStartListeningCallback&&m_fnStartListeningCallback()}else _this.StopListening()},m_oAJAX.OnError=function(a,b,c){_this.StopListening()},m_oAJAX.SendRequest("POST","/scripts/"+m_oLightningSettings.LASFileName,cParams)):m_fnStartListeningCallback&&m_fnStartListeningCallback()},_this.StopListening=function(){var cParams;m_bPolling&&(m_iPollingTimeout&&clearTimeout(m_iPollingTimeout),m_iExecuteTimeout&&clearTimeout(m_iExecuteTimeout)),m_bRunning&&m_bPolling&&(cParams="LASCmd=AI:"+m_oLightningSettings.InstanceID+";F:CHAT!680;$:837&OpCode=D&ChatRoomKey="+m_oChatRoomDetails.ChatRoomKey+"&RoomID="+m_oChatRoomDetails.ChatRoomKey+"&ChatUserID="+m_oUserDetails.ChatUserKey+"&ChatUserKey="+m_oUserDetails.ChatUserKey,m_oAJAX.Abort(),m_oAJAX.OnComplete=null,m_oAJAX.OnError=null,m_aAJAXQueue=[],m_oAJAX.SendSyncRequest("POST","/scripts/"+m_oLightningSettings.LASFileName,cParams)),m_bRunning=!1,m_fnStopListeningCallback&&m_fnStopListeningCallback()},_this.ProcessChatData=function(aData){switch(aData[0]){case CHAT_USER_ADD_VALUE:!function(oData){var iKey=oData.UserKey+"_"+oData.UserType;if(iKey&&!m_oUserListMap[iKey]){var oRow=_this.CreateUserRow(oData);_this.UserListElement.appendChild(oRow),m_oUserListMap[iKey]=oRow}}(aData[1]);break;case 11:!function(oData){var iKey=oData.UserKey+"_"+oData.UserType;if(iKey){var oElem=m_oUserListMap[iKey];oElem&&(oElem.parentNode&&oElem.parentNode.removeChild(oElem),delete m_oUserListMap[iKey])}}(aData[1]);break;case 15:break;case 20:AddToHistory(aData[1],!m_bPolling);break;case 23:!function(iKey){if(iKey){var oElem=m_oHistoryMap[iKey];oElem&&(oElem.parentNode&&oElem.parentNode.removeChild(oElem),delete m_oHistoryMap[iKey])}}(aData[1])}},_this.CreateLinkText=function(cText){var oDecoder=document.createElement("div");oDecoder.innerHTML=String(cText);var cFrontText,iEndIndex,cURLText="",cURLLink="",cTrailer="",iIndex=(cText=oDecoder.innerText).toUpperCase().indexOf("HTTP:");return-1==iIndex&&(iIndex=cText.toUpperCase().indexOf("HTTPS:")),-1==iIndex&&(iIndex=cText.toUpperCase().indexOf("WWW.")),-1==iIndex?cText:(cFrontText=cText.substring(0,iIndex),cURLText=cText.substr(iIndex),iEndIndex=cText.toUpperCase().indexOf(" ",iIndex),-1!=(iIndex=cURLText.toUpperCase().indexOf(" ",iIndex-cFrontText.length))&&(cURLText=cURLText.substring(0,iIndex)),4==cURLText.length?cText:(iIndex=cURLText.toUpperCase().indexOf(".",4))<5?cText:(cURLLink=0==cURLText.toUpperCase().indexOf("WWW.")?"http://"+cURLText:cURLText,iEndIndex>0&&(cTrailer=_this.CreateLinkText(cText.substr(iEndIndex))),cText=cFrontText+"<a href='"+cURLLink+"' target='_blank'>"+cURLText+"</a>"+cTrailer))},_this.ScrollToBottom=function(){_this.HistoryElement.parentNode.scrollTop=_this.HistoryElement.parentNode.scrollHeight},m_bRunning=!1,m_iLastMessageSeen=0,m_aAJAXQueue=[],m_aHistoryKeys=[],m_oHistoryMap={},_this.HistoryElement=document.createElement("div"),m_oUserListMap={},_this.UserListElement=document.createElement("div")}function AxiomGroupChatRoom(m_oConfig,m_oLightningDetails,m_oMessages){var _this=this;_this.element=null,_this.componentArea=null;var m_oGroupChat,m_oEmojiBuilder,m_bTimeStamps,m_oChatRoomDetails,m_oUserDetails,m_oHistory,m_oUserList,m_oFontPanel,m_oTranslatorArea,m_oErrorMessageBox,m_oFontOptionsForm,m_oTypingInput,m_oSendBtn,m_oEntryForm,m_bPolling,m_oOptInBtn,m_iSource,m_iKeyVal,m_iWorkspacePanelKey,m_bRequireLateRendering,m_oSendBar,m_oOptInBar,MAX_CHAT_CHARACTERS=6e3,m_bPromptOnDelete=!1,m_bAllowBan=!1,m_bOptInRequired=!1,m_bOptedIn=!1,m_oOptInContent=null,m_bNeedsOptInBtnEnabled=!1,m_oOptInTextHolder=null,m_cOptInText=null,m_oOptInBtnHolder=null;function CreateCustomButtonArea(cText){var oArea=document.createElement("div");oArea.className="AxiomGroupChatSendArea";var oPipe=document.createElement("span");oPipe.className="AxiomGroupChatSendPipe",oArea.appendChild(oPipe);var oBtn=document.createElement("span");oBtn.className="AxiomGroupChatSendBtn",oArea.appendChild(oBtn);var oFlexGrow=document.createElement("span");oFlexGrow.className="AxiomFlexGrow",oBtn.appendChild(oFlexGrow);var oText=document.createElement("span");return oText.className="AxiomGroupChatSendBtnText",oText.appendChild(document.createTextNode(cText)),oBtn.appendChild(oText),oBtn.appendChild(oFlexGrow.cloneNode(!0)),{element:oArea,button:oBtn}}function GetChatRoomData(iChatRoomKey,iSource,iKeyVal,cPassword){var cParams="LASCmd=AI:"+m_oLightningDetails.InstanceID;iChatRoomKey?cParams+=";F:CHAT!645&ChatRoomKey="+iChatRoomKey:iSource&&iKeyVal&&(cParams+=";S:36201;F:CHAT!645&Source="+iSource+"&KeyVal="+iKeyVal,m_iWorkspacePanelKey&&(cParams+="&WorkspacePanelKey="+m_iWorkspacePanelKey),m_iSource=iSource,m_iKeyVal=iKeyVal),cPassword&&(cParams+="&Password="+cPassword);var oAJAX=new InxpoAJAXObject;oAJAX.OnComplete=GetChatRoomData_OnComplete,oAJAX.SendRequest("POST","/scripts/"+m_oLightningDetails.LASFileName,cParams)}function GetChatRoomData_OnComplete(cResult){var oJSON=InxpoAJAXEvalJSON(cResult);switch(oJSON.Status){case 0:!function CreateChatRoom(oJSON){oJSON.ResultSet[0][0].DisplayEmojis=!1;if(oJSON.ResultSet[0][0].TranslatorMethod&&"undefined"==typeof Translator)return void LoadScript(m_oLightningDetails.ScriptDir+"/VTS/Translator.js",function(oEvent){CreateChatRoom(oJSON)});if(oJSON.ResultSet[0][0].DisplayEmojis&&"undefined"==typeof EmojiBuilder)return LoadStylesheet(g_oSettings.CSSDir+"/EmojiBuilder.css"),void LoadScript(m_oLightningDetails.ScriptDir+"/VTS/EmojiBuilder.js",function(oEvent){CreateChatRoom(oJSON)});_this.element.innerHTML="";m_oHistory=document.createElement("div");m_oHistory.className="AxiomGroupChatHistoryArea";_this.element.appendChild(m_oHistory);m_oUserList=document.createElement("div");m_oUserList.className="AxiomGroupChatHistoryArea";m_oUserList.style.display="none";_this.element.appendChild(m_oUserList);_this.componentArea.innerHTML="";_this.element.appendChild(_this.componentArea);m_oChatRoomDetails=oJSON.ResultSet[0][0];m_oChatRoomDetails.DisplaySideBar=!1;m_oUserDetails=oJSON.ResultSet[1][0];m_oUserDetails.EndTag="";m_oUserDetails.FrontTag="";!function(cFontColor,aFontFaces,aFontSizes,aFontModifiers){(m_oFontPanel=document.createElement("div")).className="AxiomGroupChatFontOptionsBackground",_this.element.appendChild(m_oFontPanel);var oContainer=document.createElement("div");oContainer.className="AxiomGroupChatFontOptionsContainer",m_oFontPanel.appendChild(oContainer),(m_oFontOptionsForm=document.createElement("form")).setAttribute("onsubmit","return false;"),oContainer.appendChild(m_oFontOptionsForm);var oHeader=document.createElement("div");oHeader.className="AxiomGroupChatFontOptionsHeader AxiomFlex",m_oFontOptionsForm.appendChild(oHeader);var oTitle=document.createElement("div");oTitle.className="AxiomGroupChatFontOptionsTitle AxiomFlexGrow",oTitle.appendChild(document.createTextNode(m_oMessages.GCFontOptions)),oHeader.appendChild(oTitle);var oRow,oName,oValue,oBtn=document.createElement("span");if(oBtn.className="AxiomGroupChatFontOptionsClose",oBtn.addEventListener("click",FontOptions_OnClick),oHeader.appendChild(oBtn),(oRow=document.createElement("div")).className="AxiomGroupChatFontOptionsRow",m_oFontOptionsForm.appendChild(oRow),(oName=document.createElement("div")).className="AxiomGroupChatFontOptionsName",oName.appendChild(document.createTextNode(m_oMessages.GCFontFace)),oRow.appendChild(oName),(oValue=document.createElement("select")).className="AxiomInput",oValue.name="FontFace",AddSelectorOptions(oValue,aFontFaces),oRow.appendChild(oValue),(oRow=document.createElement("div")).className="AxiomGroupChatFontOptionsRow",m_oFontOptionsForm.appendChild(oRow),(oName=document.createElement("div")).className="AxiomGroupChatFontOptionsName",oName.appendChild(document.createTextNode(m_oMessages.GCFontSize)),oRow.appendChild(oName),(oValue=document.createElement("select")).className="AxiomInput",oValue.name="FontSize",m_oConfig.KioskMode&&aFontSizes.length>1)for(var iLup=0;iLup<aFontSizes.length;iLup++)aFontSizes[iLup].Selected=1==iLup?1:0;AddSelectorOptions(oValue,aFontSizes),oRow.appendChild(oValue),(oRow=document.createElement("div")).className="AxiomGroupChatFontOptionsRow",m_oFontOptionsForm.appendChild(oRow),(oName=document.createElement("div")).className="AxiomGroupChatFontOptionsName",oName.appendChild(document.createTextNode(m_oMessages.GCFontColor)),oRow.appendChild(oName),(oValue=document.createElement("input")).className="AxiomInput",oValue.name="FontColor",oValue.type="text",oValue.value=cFontColor,oRow.appendChild(oValue);var oData,oWrapper,oLabel,oInput,oCheck;new jscolor.color(oValue,{hash:!0,pickerBorder:0,pickerInset:0,pickerFaceColor:"#FFFFFF"});(oRow=document.createElement("div")).className="AxiomGroupChatFontOptionsRow",m_oFontOptionsForm.appendChild(oRow);for(var iLup=0;iLup<aFontModifiers.length;iLup++)oData=aFontModifiers[iLup],(oWrapper=document.createElement("div")).className="AxiomSelectionWrapper",oRow.appendChild(oWrapper),(oLabel=document.createElement("label")).className="AxiomUserSelect",oWrapper.appendChild(oLabel),(oInput=document.createElement("input")).className="AxiomUserSelect",oInput.type="checkbox",oInput.name=oData.Name,oInput.value=oData.Value,oInput.checked=oData.Checked,oLabel.appendChild(oInput),(oCheck=document.createElement("div")).className="AxiomCheckbox",oLabel.appendChild(oCheck),(oCheck=document.createElement("span")).appendChild(document.createTextNode(m_oMessages[oData.Name]?m_oMessages[oData.Name]:oData.Text)),oLabel.appendChild(oCheck)}(oJSON.ResultSet[1][0].FontColor,oJSON.ResultSet[2],oJSON.ResultSet[3],oJSON.ResultSet[4]);if(HasLocalStorage()){var iMode=parseInt(localStorage.getItem(GC_LOCAL_STORGE_READING_MODE_KEY));iMode&&SetReadingModeState(iMode)}m_oChatRoomDetails.DisplayEmojis&&((m_oEmojiBuilder=new EmojiBuilder).fnEmojiSelected=Emoji_OnSelected,_this.element.appendChild(m_oEmojiBuilder.element));m_oGroupChat=new GroupChat(m_oLightningDetails,m_oMessages,oJSON.ResultSet[0][0],m_oUserDetails);m_oGroupChat.CreateMessageRow=_this.CreateMessageRow.bind(_this);m_oGroupChat.CreateUserRow=_this.CreateUserRow.bind(_this);m_bTimeStamps=!0;TimeStamps_OnClick();m_oHistory&&m_oHistory.appendChild(m_oGroupChat.HistoryElement);m_oChatRoomDetails.DisplaySideBar&&m_oUserList&&m_oUserList.appendChild(m_oGroupChat.UserListElement);m_oGroupChat.ProcessHistroyMessages(oJSON.ResultSet[5].reverse());var fnStartCallback;_this.ExternalStartListening&&(fnStartCallback=_this.ExternalStartListening.bind(_this));var fnEndCallback;_this.ExternalStopListening&&(fnEndCallback=_this.ExternalStopListening.bind(_this));m_bPolling=m_oConfig.Polling;m_oGroupChat.StartListening(!m_bPolling,fnStartCallback,fnEndCallback);_this.element.setAttribute("data-chat-room-key",_this.GetChatRoomKey());if(oJSON.ResultSet.length>6&&oJSON.ResultSet[6].length)for(var oDataObj,iLup=0;iLup<oJSON.ResultSet[6].length;iLup++)"AllowBan"==(oDataObj=oJSON.ResultSet[6][iLup]).Name?m_bAllowBan=1==oDataObj.Value&&g_oSettings.ModeratorRights!=MODERATOR_RIGHTS_QA_ONLY:"PromptBeforeDelete"==oDataObj.Name?m_bPromptOnDelete=1==oDataObj.Value:"RequireOptIn"==oDataObj.Name?m_bOptInRequired=1==oDataObj.Value:"RequireOptInText"==oDataObj.Name&&(m_cOptInText=oDataObj.Value?oDataObj.Value:"Opt in to chat?");!function(bHideFontOptions,bHideReadingMode){var oArea=document.createElement("div");oArea.className="AxiomGroupChatAdditionalArea",m_oSendBar=oArea;var oFlex=document.createElement("div");oFlex.className="AxiomFlex",oArea.appendChild(oFlex);var oBtn,oFlexGrow=document.createElement("span");if(oFlexGrow.className="AxiomFlexGrow",bHideFontOptions||((oBtn=document.createElement("span")).className="AxiomGroupChatOptionsButton",oBtn.title=m_oMessages.GCOpenFontOptions,oBtn.addEventListener("click",FontOptions_OnClick),oFlex.appendChild(oBtn)),(oBtn=document.createElement("span")).className="AxiomGroupChatTimeButton",oBtn.title=m_oMessages.GCShowHideTime,oBtn.addEventListener("click",TimeStamps_OnClick),oFlex.appendChild(oBtn),m_oChatRoomDetails.DisplayEmojis&&((oBtn=document.createElement("span")).className="AxiomGroupChatEmojiBtn",oBtn.addEventListener("click",EmojiToggle_OnClick),oFlex.appendChild(oBtn)),m_oChatRoomDetails.DisplaySideBar&&((oBtn=document.createElement("span")).className="AxiomGroupChatMembersButton",oBtn.title=m_oMessages.GCMembers,oBtn.addEventListener("click",UserList_OnClick),oFlex.appendChild(oBtn)),bHideReadingMode||((oBtn=document.createElement("span")).className="AxiomGroupChatReadingModeButton",oBtn.title=m_oMessages.GCReadingMode,oBtn.addEventListener("click",ReadingMode_OnClick),oFlex.appendChild(oBtn)),m_bAllowBan&&(m_oBanIconContainer=oBtn=document.createElement("span"),oFlex.appendChild(m_oBanIconContainer)),oFlex.appendChild(oFlexGrow),(m_oTranslatorArea=document.createElement("div")).className="AxiomGroupChatTranslatorArea",oFlex.appendChild(m_oTranslatorArea),m_oChatRoomDetails.TranslatorMethod){Translator.Init(m_oChatRoomDetails.TranslatorMethod,m_oUserDetails.LocaleID,_this.TranslatorCallback,m_oMessages.GCTranslatorBranding,!0,m_oLightningDetails.InstanceID),m_oTranslatorArea.appendChild(oFlexGrow.cloneNode(!0));var oBranding=Translator.GetBranding();oBranding.removeAttribute("id"),oBranding.className="AxiomGroupChatTranslatorBranding",m_oTranslatorArea.appendChild(oBranding),m_oTranslatorArea.appendChild(oFlexGrow.cloneNode(!0))}var oSet=CreateCustomButtonArea(m_oMessages.GCSend);oFlex.appendChild(oSet.element),m_oSendBtn=oSet.button}(m_oConfig.HideFontSetings,m_oConfig.HideReadingMode);!function(){var oArea=document.createElement("div");oArea.className="AxiomGroupChatAdditionalArea",m_oOptInBar=oArea;var oFlex=document.createElement("div");oFlex.className="AxiomFlex",oArea.appendChild(oFlex);var oBtn,oFlexGrow=document.createElement("span");oFlexGrow.className="AxiomFlexGrow",(oBtn=document.createElement("span")).className="AxiomGroupAgreeToTermsButton",oBtn.title=m_oMessages.OptInLabel,oBtn.addEventListener("click",OptInToggle),oFlex.appendChild(oBtn),oFlex.appendChild(oFlexGrow);var oSet=CreateCustomButtonArea(g_oMessages.GCAgree);m_oOptInBtnHolder=oSet.element,(m_oOptInBtn=oSet.button).setAttribute("data-disabled",1),oFlex.appendChild(m_oOptInBtnHolder)}();MakeComponentArea();_this.ResizeRequest&&_this.ResizeRequest();m_oOptInTextHolder&&OptInScrolling({currentTarget:m_oOptInTextHolder});SizeWidthBubblesCheck();m_bRequireLateRendering?setTimeout(_this.ScrollToBottom,50):_this.ScrollToBottom();_this.ExternalChatRoomLoaded&&_this.ExternalChatRoomLoaded(_this)}(oJSON);break;case 2:!function(){_this.element.innerHTML="";var oBackground=document.createElement("div");oBackground.className="AxiomFlex";var oFlexGrow=document.createElement("div");oFlexGrow.className="AxiomFlexGrow",oBackground.appendChild(oFlexGrow),oDiv=document.createElement("div"),m_oEntryForm.appendChild(oDiv),(m_oErrorMessageBox=document.createElement("div")).className="AxiomGroupChatErrorMessage",oDiv.appendChild(m_oErrorMessageBox),oFlexGrow=oFlexGrow.cloneNode(!0),oBackground.appendChild(oFlexGrow),_this.element.appendChild(oBackground)}(),m_oErrorMessageBox.setAttribute("data-status",oJSON.Status),m_oErrorMessageBox.innerHTML=oJSON.ResultSet[0][0].ErrorMessage;break;case-4:m_oErrorMessageBox.setAttribute("data-status",oJSON.Status),m_oErrorMessageBox.innerHTML=oJSON.ResultSet[0][0].ErrorMessage;break;case-5:!function(oJSON){var oData=oJSON.ResultSet[0][0];_this.element.innerHTML="";var oBackground=document.createElement("div");oBackground.className="AxiomFlex";var oFlexGrow=document.createElement("div");oFlexGrow.className="AxiomFlexGrow",oBackground.appendChild(oFlexGrow);var oContainer=document.createElement("div");oContainer.className="AxiomGroupChatPasswordParent",oBackground.appendChild(oContainer),(m_oEntryForm=document.createElement("form")).setAttribute("onsubmit","return false;"),oContainer.appendChild(m_oEntryForm);var oHeader=document.createElement("div");oHeader.appendChild(document.createTextNode(m_oMessages.GCPasswordRequiredMsg)),m_oEntryForm.appendChild(oHeader);var oName=document.createElement("div");oName.appendChild(document.createTextNode(m_oMessages.GCPassword)),m_oEntryForm.appendChild(oName);var oDiv=document.createElement("div");m_oEntryForm.appendChild(oDiv);var oInput=document.createElement("input");oInput.type="password",oInput.className="AxiomInput",oInput.name="Password",oDiv.appendChild(oInput),(oInput=document.createElement("input")).type="hidden",oInput.name="ChatRoomKey",oInput.value=oData.ChatRoomKey,oDiv.appendChild(oInput),oDiv=document.createElement("div"),m_oEntryForm.appendChild(oDiv),(m_oErrorMessageBox=document.createElement("div")).className="AxiomGroupChatErrorMessage",oDiv.appendChild(m_oErrorMessageBox),oDiv=document.createElement("div"),m_oEntryForm.appendChild(oDiv);var oBtn=_this.CreateActionButton(document.createTextNode(m_oMessages.GCEnter));oBtn.addEventListener("click",function(oEvent){GetChatRoomData(m_oEntryForm.ChatRoomKey.value,null,null,m_oEntryForm.Password.value)}),oDiv.appendChild(oBtn),oFlexGrow=oFlexGrow.cloneNode(!0),oBackground.appendChild(oFlexGrow),_this.element.appendChild(oBackground)}(oJSON)}}function SizeWidthBubblesCheck(){0==_this.element.offsetWidth?setTimeout(SizeWidthBubblesCheck,50):SizeWidthBubblesIfNeccessary(_this.element.offsetWidth)}function SizeWidthBubblesIfNeccessary(iWidth){m_bRequireLateRendering&&SetRule("GroupChat.css",".AxiomGroupChatContentSizer","max-width",iWidth-50+"px")}function AddSelectorOptions(oElem,aOptions){if(oElem)for(var oOption,oData,iLup=0;iLup<aOptions.length;iLup++)oData=aOptions[iLup],(oOption=document.createElement("option")).value=oData.Value,oOption.appendChild(document.createTextNode(oData.Text)),oElem.appendChild(oOption),oData.Selected&&(oElem.selectedIndex=iLup)}function MakeComponentArea(){_this.componentArea.innerHTML="";var oTypingArea,bIsModerator=m_bOptInRequired&&IsChatModerator(m_oUserDetails.ChatUserKey);!m_bOptInRequired||m_bOptedIn||bIsModerator?(m_bOptInRequired&&bIsModerator&&!m_bOptedIn&&(onOptInClick(),m_bOptedIn=!0),(oTypingArea=document.createElement("div")).className="AxiomGroupChatTypingArea AxiomFlex",_this.componentArea.appendChild(oTypingArea),(m_oTypingInput=document.createElement("textarea")).className="AxiomGroupChatTypeMessageBox AxiomFlexGrow",m_oTypingInput.placeholder=m_oMessages.GCEnterMessageHere,m_oTypingInput.addEventListener("keypress",TypingMessage_OnKeyPress),m_oTypingInput.addEventListener("keyup",TypingMessage_OnKeyUp),oTypingArea.appendChild(m_oTypingInput),ApplyUserStyles(),_this.EnableTyping(!0),_this.componentArea.appendChild(m_oSendBar)):(!function(){var oOptIn=document.createElement("div");oOptIn.className="AxiomGroupChatOptInContainer",oOptIn.setAttribute("data-state",1);var oCloseContainer=document.createElement("div");oCloseContainer.className="AxiomGroupChatOptInCloseContainer",oOptIn.appendChild(oCloseContainer);var oGrow=document.createElement("div");oGrow.className="AxiomGroupChatCloseRow AxiomFlexGrow",oCloseContainer.appendChild(oGrow);var oClose=document.createElement("div");oClose.className="AxiomGroupChatFontOptionsClose",oClose.addEventListener("click",OptInToggle),oCloseContainer.appendChild(oClose),(m_oOptInTextHolder=document.createElement("div")).className="AxiomGroupChatOptInText",m_bNeedsOptInBtnEnabled=!0,m_oOptInTextHolder.addEventListener("scroll",OptInScrolling),m_cOptInText&&(m_oOptInTextHolder.innerText=m_cOptInText);oOptIn.appendChild(m_oOptInTextHolder),_this.element.appendChild(oOptIn),m_oOptInContent=oOptIn}(),_this.componentArea.appendChild(m_oOptInBar))}function OptInScrolling(oEvent){var oElem=oEvent.currentTarget;oElem.offsetHeight&&oElem.scrollTop+oElem.offsetHeight>=oElem.scrollHeight&&(m_oOptInBtn.removeAttribute("data-disabled"),m_oOptInBtn.addEventListener("click",onOptInClick),oElem.removeEventListener("scroll",OptInScrolling),m_bNeedsOptInBtnEnabled=!1)}function OptInToggle(){m_oOptInContent&&m_oOptInContent.setAttribute("data-state","1"==m_oOptInContent.getAttribute("data-state")?"0":"1"),m_oOptInBtnHolder&&(m_oOptInBtnHolder.style.display="none"==m_oOptInBtnHolder.style.display?"":"none")}function onOptInClick(){if(_this.ExternalOptIn)_this.ExternalOptIn(_this.GetChatRoomKey());else{var cParams="LASCmd=AI:"+m_oLightningDetails.InstanceID+";F:LBSEXPORT!JSON&SQLID=649&EventKey="+m_iKeyVal+"&ChatRoomKey="+_this.GetChatRoomKey(),oAJAX=new InxpoAJAXObject;oAJAX.OnComplete=function(cResult){0==InxpoAJAXEvalJSON(cResult).Status&&_this.ProcessOptInResponse({O:"1"})},oAJAX.SendRequest("POST","/scripts/"+m_oLightningDetails.LASFileName,cParams)}}function SendMessage_OnClick(oEvent){var cMsg=m_oTypingInput.value;_this.SendMessage(cMsg),m_oTypingInput.value=""}function EmojiToggle_OnClick(oEvent){m_oEmojiBuilder.Toggle(oEvent),m_oEmojiBuilder.element.style.position="absolute";var oRect=oEvent.currentTarget.getBoundingClientRect();m_oEmojiBuilder.element.style.bottom=oRect.height+"px",m_oEmojiBuilder.element.style.left="7px"}function Emoji_OnSelected(oEvent,cChar){m_oEmojiBuilder.Hide(oEvent),m_oTypingInput&&(m_oTypingInput.value+=cChar)}function FontOptions_OnClick(oEvent){if(m_oFontPanel){var iState=parseInt(m_oFontPanel.getAttribute("data-state"));if(iState?(m_oFontPanel.setAttribute("data-state",0),function(){if(m_oFontOptionsForm){var cParams="LASCmd=AI:"+m_oLightningDetails.InstanceID+";F:CHAT!642&ChatUserID="+m_oUserDetails.ChatUserKey+"&RefreshRate=2&PrimaryFont="+encodeURIComponent(m_oFontOptionsForm.FontFace.value)+"&AlternateFont="+encodeURIComponent(m_oFontOptionsForm.FontFace.value)+"&FontSize="+encodeURIComponent(m_oFontOptionsForm.FontSize.value)+"&FontColor="+encodeURIComponent(m_oFontOptionsForm.FontColor.value);if(m_oFontOptionsForm.FontBold&&(cParams+="&Bold="+(m_oFontOptionsForm.FontBold.checked?"1":"0")),m_oFontOptionsForm.FontItalic&&(cParams+="&Italic="+(m_oFontOptionsForm.FontItalic.checked?"1":"0")),m_oFontOptionsForm.FontUnderline&&(cParams+="&Underline="+(m_oFontOptionsForm.FontUnderline.checked?"1":"0")),m_oConfig.KioskMode);else{var oAJAX=new InxpoAJAXObject;oAJAX.OnComplete=onSaveChatUserOptionsComplete,oAJAX.OnError=onSaveChatUserOptionsError,oAJAX.SendRequest("POST","/scripts/"+m_oLightningDetails.LASFileName,cParams)}}}(),ApplyUserStyles()):m_oFontPanel.setAttribute("data-state",1),m_bRequireLateRendering){var fnRequestAnimationFrame=RequestAnimationFrame();fnRequestAnimationFrame&&fnRequestAnimationFrame(function(){SetRule("GroupChat.css",".AxiomGroupChatFontOptionsContainer","transform",iState?"":"translate3d(0px,0px,0px)")})}}}function TimeStamps_OnClick(oEvent){(m_bTimeStamps=!m_bTimeStamps)?SetRule("AxiomGroupChat.css",".AxiomGroupChatLineTimeStamp","display",""):SetRule("AxiomGroupChat.css",".AxiomGroupChatLineTimeStamp","display","none")}function UserList_OnClick(oEvent){m_oHistory&&m_oUserList&&("none"==m_oHistory.style.display?(m_oHistory.style.display="",m_oUserList.style.display="none"):(m_oHistory.style.display="none",m_oUserList.style.display=""))}function ReadingMode_OnClick(oEvent){var bShow=!parseInt(_this.element.getAttribute("data-reading-mode"));SetReadingModeState(bShow),HasLocalStorage()&&localStorage.setItem(GC_LOCAL_STORGE_READING_MODE_KEY,bShow?1:0)}function SetReadingModeState(bShow){_this.element.setAttribute("data-reading-mode",bShow?1:0),ApplyUserStyles()}function onSaveChatUserOptionsComplete(cResponse){}function onSaveChatUserOptionsError(cResponse){console.log(cResponse)}function TypingMessage_OnKeyUp(oEvent){var oElem=oEvent.currentTarget;oElem.value.length>MAX_CHAT_CHARACTERS&&(oElem.value=oElem.value.substring(0,MAX_CHAT_CHARACTERS))}function TypingMessage_OnKeyPress(oEvent){var cValue=oEvent.currentTarget.value;if(13==oEvent.keyCode){if(oEvent.preventDefault(),cValue.length<=0)return!1;SendMessage_OnClick()}else if(cValue.length>MAX_CHAT_CHARACTERS&&8!=oEvent.keyCode)return oEvent.preventDefault(),alert(m_oMessages.GCTooManyCharacters.replace("{MaxCount}",MAX_CHAT_CHARACTERS)),!1}function ApplyUserStyles(){var oElem,cFontSize="12px",cFontBold="normal",cFontItalic="normal",cFontUnderline="none",cFontColor="#000000",cFontFace="Arial";if(oElem=m_oFontOptionsForm.FontSize)switch(oElem.options[oElem.selectedIndex].value){case"1":cFontSize="10px";break;case"2":cFontSize="12px";break;case"3":cFontSize="16px";break;case"4":cFontSize="20px"}((oElem=m_oFontOptionsForm.FontColor)&&(cFontColor=oElem.value),(oElem=m_oFontOptionsForm.FontBold)&&oElem.checked&&(cFontBold="bold"),(oElem=m_oFontOptionsForm.FontItalic)&&oElem.checked&&(cFontItalic="italic"),(oElem=m_oFontOptionsForm.FontUnderline)&&oElem.checked&&(cFontUnderline="underline"),(oElem=m_oFontOptionsForm.FontFace)&&(cFontFace=oElem.options[oElem.selectedIndex].value),m_oUserDetails&&(m_oUserDetails.FrontTag="<span style='font-family:"+cFontFace+";font-size:"+cFontSize+";color:"+cFontColor+";font-weight:"+cFontBold+";font-style:"+cFontItalic+";text-decoration:"+cFontUnderline+"' >",m_oUserDetails.EndTag="</span>"),m_oTypingInput)&&(parseInt(_this.element.getAttribute("data-reading-mode"))?(m_oTypingInput.style="",m_oTypingInput.style.fontSize="16px",m_oTypingInput.style.color="#FFFFFF"):(m_oTypingInput.style.fontFamily=cFontFace,m_oTypingInput.style.fontSize=cFontSize,m_oTypingInput.style.fontWeight=cFontBold,m_oTypingInput.style.fontStyle=cFontItalic,m_oTypingInput.style.textDecoration=cFontUnderline,m_oTypingInput.style.color=cFontColor))}_this.DeleteMessage=function(iDetailsKey){_this.ExternalRemoveMessage?_this.ExternalRemoveMessage(m_oChatRoomDetails.ChatRoomKey,iDetailsKey):m_oGroupChat&&m_oGroupChat.RemoveMessage(iDetailsKey)},_this.SendMessage=function(cMsg){cMsg=StringReplace(cMsg,"\n"," "),cMsg=StringReplace(cMsg,"\r",""),cMsg=StringReplace(cMsg,"\u2028"," "),(cMsg=StringReplace(cMsg,"\u2029"," ")).length>MAX_CHAT_CHARACTERS?alert(m_oMessages.TooManyCharacters.replace("{MaxCount}",MAX_CHAT_CHARACTERS)):cMsg.length>0&&(_this.ExternalAddMessage?_this.ExternalAddMessage(m_oChatRoomDetails.ChatRoomKey,m_oUserDetails.ChatUserKey,m_oUserDetails.UserName,m_oUserDetails.LocaleID,m_oUserDetails.FrontTag,m_oUserDetails.EndTag,cMsg):m_oGroupChat&&m_oGroupChat.AddMessage(cMsg))},_this.Start=function(iChatRoomKey,iSource,iKeyVal,bPreventPolling,iWorkspacePanelKey){m_oConfig.KioskMode?GetChatRoomData_OnComplete(m_oConfig.KioskData):(_this.Stop(),m_bPolling=!bPreventPolling,m_iWorkspacePanelKey=iWorkspacePanelKey,GetChatRoomData(iChatRoomKey,iSource,iKeyVal))},_this.Stop=function(){m_oGroupChat&&m_oGroupChat.StopListening()},_this.AddChatMessage=function(oData){oData&&oData.PostText&&(oData.PromptOnDelete=m_bPromptOnDelete,oData.AllowBan=m_bAllowBan,m_oGroupChat.ProcessChatData([20,oData]))},_this.RemoveChatMessage=function(oData){oData&&oData.DetailsKey&&m_oGroupChat.ProcessChatData([23,oData.DetailsKey])},_this.ScrollToBottom=function(){m_oGroupChat.ScrollToBottom()},_this.GetChatUserKey=function(){return m_oUserDetails.ChatUserKey},_this.GetChatRoomKey=function(){return m_oChatRoomDetails.ChatRoomKey},_this.IsSourceKeyVal=function(iSource,iKeyVal){return m_iSource==iSource&&m_iKeyVal==iKeyVal},_this.IsBanEnabled=function(){return m_bAllowBan},_this.IsOptInEnabled=function(){return m_bOptInRequired},_this.SetPageSize=function(oSize){if(oSize.height>-1){var bAutoScroll=!1;if(m_oHistory&&m_oHistory.scrollTop==m_oHistory.scrollHeight-m_oHistory.offsetHeight&&(bAutoScroll=!0),m_oEmojiBuilder&&m_oEmojiBuilder.Hide(null),_this.element.style.height=oSize.height+"px",bAutoScroll){var fnRequestAnimationFrame=RequestAnimationFrame();fnRequestAnimationFrame&&fnRequestAnimationFrame(function(){fnRequestAnimationFrame(function(){m_oHistory.scrollTop=m_oHistory.scrollHeight})})}}oSize.width&&(SetRule("GroupChat.css",".AxiomGroupChatFontOptionsContainer","max-width",oSize.width+"px"),SizeWidthBubblesIfNeccessary(oSize.width)),m_oOptInTextHolder&&OptInScrolling({currentTarget:m_oOptInTextHolder})},_this.GetBannedUserList=function(oData){},_this.CreateMessageRow=function(oData){},_this.CreateUserRow=function(oData){},_this.CreateActionButton=function(cText){var oBtn=document.createElement("span");return oBtn.className="AxiomGroupChatActionBtn",oBtn.appendChild(cText),oBtn},_this.TranslatorCallback=function(oResult){},_this.ResizeRequest=function(){},_this.EnableTyping=function(bEnable){bEnable?(m_oTypingInput&&m_oTypingInput.removeAttribute("disabled"),m_oSendBtn&&(m_oSendBtn.removeAttribute("data-disabled"),m_oSendBtn.addEventListener("click",SendMessage_OnClick))):(m_oTypingInput&&m_oTypingInput.setAttribute("disabled",!0),m_oSendBtn&&(m_oSendBtn.setAttribute("data-disabled",1),m_oSendBtn.removeEventListener("click",SendMessage_OnClick)))},_this.ProcessOptInResponse=function(oData){m_bOptedIn=!0,m_oOptInContent&&m_oOptInContent.parentNode&&(m_oOptInContent.parentNode.removeChild(m_oOptInContent),m_oOptInContent=null),MakeComponentArea()},_this.PauseRequestCallback=function(oData){oData&&oData.Pause&&oData.Pause},_this.OptInRenderCheck=function(){m_bNeedsOptInBtnEnabled&&m_oOptInTextHolder&&OptInScrolling({currentTarget:m_oOptInTextHolder})},_this.SetBanLookupIcon=function(oBtn){oBtn&&m_oBanIconContainer&&(oBtn.title=m_oMessages.BannedUsersIcon,m_oBanIconContainer.parentNode.replaceChild(oBtn,m_oBanIconContainer))},m_bRequireLateRendering=IsEdge()||IsIE(),m_oConfig&&(m_oConfig.CreateMessageRow&&(_this.CreateMessageRow=m_oConfig.CreateMessageRow),m_oConfig.CreateUserRow&&(_this.CreateUserRow=m_oConfig.CreateUserRow),m_oConfig.CreateActionButton&&(_this.CreateActionButton=m_oConfig.CreateActionButton),m_oConfig.TranslatorCallback&&(_this.TranslatorCallback=m_oConfig.TranslatorCallback),m_oConfig.ResizeRequest&&(_this.ResizeRequest=m_oConfig.ResizeRequest),m_oConfig.ExternalAddMessage&&(_this.ExternalAddMessage=m_oConfig.ExternalAddMessage),m_oConfig.ExternalRemoveMessage&&(_this.ExternalRemoveMessage=m_oConfig.ExternalRemoveMessage),m_oConfig.ExternalStartListening&&(_this.ExternalStartListening=m_oConfig.ExternalStartListening),m_oConfig.ExternalStopListening&&(_this.ExternalStopListening=m_oConfig.ExternalStopListening),m_oConfig.ExternalOptIn&&(_this.ExternalOptIn=m_oConfig.ExternalOptIn),m_oConfig.ExternalChatRoomLoaded&&(_this.ExternalChatRoomLoaded=m_oConfig.ExternalChatRoomLoaded)),_this.element=document.createElement("div"),_this.element.className="AxiomGroupChatLayout",_this.element.style.transform="translate3d(0,0,0)",_this.componentArea=document.createElement("div"),_this.componentArea.className="AxiomGroupChatComponents"}function IsChatModerator(iChatUserKey){var bRetval=!1;if("undefined"!=typeof g_oModerators)for(var cMod in g_oModerators)if(g_oModerators[cMod].ChatUserID==iChatUserKey){bRetval=!0;break}return bRetval}