var StudioModeratedChat=function(m_iKey,m_iParentKey,m_iUserKey,m_iUserType,m_cUserName,m_cChatText,m_cDateTime,m_iQuestionNumber,m_bFromModerator){var _this=this,m_aChildChats=[],m_oAttendeeElemData=null,m_oModElemData=null,m_bPublished=!1,m_iPriority=0,m_oPublisher=null,m_bReadByModerator=!1,m_oTags={};Object.defineProperties(this,{Key:{get:function(){return m_iKey}},ParentKey:{get:function(){return m_iParentKey}},UserKey:{get:function(){return m_iUserKey}},UserType:{get:function(){return m_iUserType}},UserName:{get:function(){return m_cUserName}},FromModerator:{get:function(){return m_bFromModerator}},Text:{get:function(){return m_cChatText},set:function(cText){""!=cText&&(m_cChatText=String(cText))}},DateTime:{get:function(){return m_cDateTime}},AttendeeElementData:{get:function(){return m_oAttendeeElemData},set:function(oData){var oOldData=m_oAttendeeElemData;m_oAttendeeElemData=oData||null,m_oPublisher.Publish("AttendeeNodeUpdated",{Data:_this,OldData:oOldData,NewData:m_oAttendeeElemData})}},ModeratorElementData:{get:function(){return m_oModElemData},set:function(oData){var oOldData=m_oModElemData;m_oModElemData=oData||null,m_oPublisher.Publish("ModeratorNodeUpdated",{Data:_this,OldData:oOldData,NewData:m_oModElemData})}},Published:{get:function(){return m_bPublished},set:function(bPublished){if("boolean"==typeof bPublished){if(m_bPublished===bPublished)return;m_bPublished=bPublished,m_oPublisher.Publish("PublishedUpdated",{Data:_this})}}},Children:{get:function(){return m_aChildChats}},Publisher:{get:function(){return m_oPublisher}},Priority:{get:function(){return m_iPriority},set:function(iPriority){m_iPriority===iPriority||isNaN(iPriority)||(m_iPriority=iPriority,m_oPublisher.Publish("PriorityUpdated",{Data:_this}))}},Number:{get:function(){return m_iQuestionNumber}},ReadByModerator:{get:function(){return m_bReadByModerator},set:function(bRead){"boolean"==typeof bRead&&(m_bReadByModerator=bRead)}}}),this.AddChild=function(oSMCObj){oSMCObj instanceof StudioModeratedChat&&(m_aChildChats.push(oSMCObj),m_aChildChats.sort(function(a,b){return a.Key<b.Key?-1:1}),m_oPublisher.Publish("ChildAdded",{Data:_this,Child:oSMCObj}))},this.RemoveChild=function(oSMCObj){if(oSMCObj instanceof StudioModeratedChat){for(var iLup=0;iLup<m_aChildChats.length;iLup++)if(m_aChildChats[iLup]===oSMCObj){m_aChildChats.splice(iLup,1);break}m_oPublisher.Publish("ChildRemoved",{Data:_this,Child:oSMCObj})}},this.AddTag=function(cTag){var oRetVal=new StudioModeratedRetVal;return 1==m_oTags[cTag]?oRetVal.Msg="Tag already exists.":(m_oTags[cTag]=1,oRetVal.RetVal=!0,m_oPublisher.Publish("TagAdded",{Data:_this,Tag:cTag})),oRetVal},this.RemoveTag=function(cTag){var oRetVal=new StudioModeratedRetVal;return 1==m_oTags[cTag]&&"FOLDER_ALL"!=cTag?(delete m_oTags[cTag],oRetVal.RetVal=!0,m_oPublisher.Publish("TagRemoved",{Data:_this,Tag:cTag})):oRetVal.Msg="Tag not found.",oRetVal},this.GetTags=function(){return Object.keys(m_oTags)},this.HasTag=function(cTag){return 1==m_oTags[cTag]},m_oPublisher=new InxpoPublisher},StudioModeratedChatDataStore=function(){var m_oData={},m_oPublisher=null;function ModeratorNodeUpdated(oCustomEventObj){m_oPublisher.Publish("ModeratorNodeUpdated",oCustomEventObj)}function AttendeeNodeUpdated(oCustomEventObj){m_oPublisher.Publish("AttendeeNodeUpdated",oCustomEventObj)}function PublishedUpdated(oCustomEventObj){m_oPublisher.Publish("PublishedUpdated",oCustomEventObj)}function PriorityUpdated(oCustomEventObj){m_oPublisher.Publish("PriorityUpdated",oCustomEventObj)}function ChildRemoved(oCustomEventObj){m_oPublisher.Publish("ChildRemoved",oCustomEventObj)}function ChildAdded(oCustomEventObj){m_oPublisher.Publish("ChildAdded",oCustomEventObj)}function TagRemoved(oCustomEventObj){m_oPublisher.Publish("TagRemoved",oCustomEventObj)}function TagAdded(oCustomEventObj){m_oPublisher.Publish("TagAdded",oCustomEventObj)}Object.defineProperties(this,{Publisher:{get:function(){return m_oPublisher}}}),this.AddMessageData=function(oMessageData){var oRetVal=new StudioModeratedRetVal;if(oMessageData instanceof StudioModeratedChat)if(m_oData[oMessageData.Key])oRetVal.Msg="Message already exists.";else{var oModeratorNodeUpdate=new InxpoSubscriber("ModeratorNodeUpdated",ModeratorNodeUpdated),oAttendeeNodeUpdate=new InxpoSubscriber("AttendeeNodeUpdated",AttendeeNodeUpdated),oPublishedUpdate=new InxpoSubscriber("PublishedUpdated",PublishedUpdated),oPriorityUpdate=new InxpoSubscriber("PriorityUpdated",PriorityUpdated),oChildAdded=new InxpoSubscriber("ChildAdded",ChildAdded),oChildRemoved=new InxpoSubscriber("ChildRemoved",ChildRemoved),oTagRemoved=new InxpoSubscriber("TagRemoved",TagRemoved),oTagAdded=new InxpoSubscriber("TagAdded",TagAdded);oMessageData.Publisher.Subscribe(oAttendeeNodeUpdate),oMessageData.Publisher.Subscribe(oModeratorNodeUpdate),oMessageData.Publisher.Subscribe(oPublishedUpdate),oMessageData.Publisher.Subscribe(oPriorityUpdate),oMessageData.Publisher.Subscribe(oChildRemoved),oMessageData.Publisher.Subscribe(oChildAdded),oMessageData.Publisher.Subscribe(oTagAdded),oMessageData.Publisher.Subscribe(oTagRemoved),m_oData[oMessageData.Key]={Data:oMessageData,Subscribers:[oAttendeeNodeUpdate,oModeratorNodeUpdate,oPublishedUpdate,oPriorityUpdate,oChildRemoved,oChildAdded,oTagAdded,oTagRemoved]},oRetVal.RetVal=!0,oMessageData.ParentKey?m_oData[oMessageData.ParentKey].Data.AddChild(oMessageData):m_oPublisher.Publish("ItemAdded",{Data:oMessageData})}return oRetVal},this.RemoveMessageData=function(iKey){var oRetVal=new StudioModeratedRetVal,oData=m_oData[iKey];if(oData){if(oData.Data.ParentKey){var oParent=m_oData[oData.Data.ParentKey];oParent&&(oParent=oParent.Data).RemoveChild(oData.Data)}else m_oPublisher.Publish("ItemRemoved",{Data:oData.Data});for(var iLup=0;iLup<oData.Subscribers.length;iLup++)oData.Data.Publisher.Unsubscribe(oData.Subscribers[iLup]);delete m_oData[iKey],oRetVal.RetVal=!0}return oRetVal},this.GetData=function(iKey){return m_oData[iKey]&&m_oData[iKey].Data?m_oData[iKey].Data:null},this.GetDataCount=function(){return Object.keys(m_oData).length},this.GetDataAsArray=function(){return Object.keys(m_oData).map(function(cKey){return m_oData[cKey].Data})},m_oPublisher=new InxpoPublisher};