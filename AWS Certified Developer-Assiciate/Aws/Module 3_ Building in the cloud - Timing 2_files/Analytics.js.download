function EventTracker(oInitParams){var m_iPingInterval=0,m_iUserKey=oInitParams.UserKey,m_iAttendeeKey=parseInt(oInitParams.EventAttendeeKey),m_iPlayerQualityLevel=-2,m_bStalled=!1,m_fnBufferUpdate=null,m_fnQualityComplete=null,m_fnQualitySet=null,m_fnPlayerError=null,m_fnStalled=null,m_fnCustomHeaders=null;this.sendAdaptationEvent=function(iQualityLevel,bUserInitiated){this.sendEvent(MSG_ANALYTICS_ADAPTATION,[m_iUserKey,m_iAttendeeKey,~~iQualityLevel,bUserInitiated])},this.sendBufferEvent=function(iTime){(iTime=~~iTime)>ANALYTICS_TRACKER_MAX_TIME&&(iTime=ANALYTICS_TRACKER_MAX_TIME),iTime>0&&(m_bStalled=!1),iTime>=0&&this.sendEvent(MSG_ANALYTICS_BUFFERING,[m_iUserKey,m_iAttendeeKey,iTime])},this.sendHTTPErrorEvent=function(iErrorCode,iStreamType,iSegmentCount){this.sendEvent(MSG_ANALYTICS_HTTPERROR,[m_iUserKey,m_iAttendeeKey,iErrorCode,iStreamType,iSegmentCount])},this.sendGenericCodeEvent=function(iErrorCode){this.sendEvent(MSG_ANALYTICS_GENERICODE,[m_iUserKey,m_iAttendeeKey,iErrorCode])},this.sendEvent=function(iEventType,oData,bBuffer){g_oAxiomCommManager.SendAnalytics(g_cSocketName,null,iEventType,oData,bBuffer)},this.SetPlayerEvents=function(){g_oAxiomMediaPlayer&&(g_oAxiomMediaPlayer.removeHandler(AXIOM_MEDIA_PLAYER_BUFFER_UPDATED_LIVE,m_fnBufferUpdate),g_oAxiomMediaPlayer.removeHandler(AXIOM_MEDIA_PLAYER_QUALITY_COMPLETED,m_fnQualityComplete),g_oAxiomMediaPlayer.removeHandler(AXIOM_MEDIA_PLAYER_QUALITY_SET,m_fnQualitySet),g_oAxiomMediaPlayer.removeHandler(AXIOM_MEDIA_PLAYER_ERROR,m_fnPlayerError),g_oAxiomMediaPlayer.removeHandler(AXIOM_MEDIA_PLAYER_STALLED,m_fnStalled),g_oAxiomMediaPlayer.removeHandler(AXIOM_MEDIA_PLAYER_CUSTOM_HEADERS,m_fnCustomHeaders),g_oAxiomMediaPlayer.setHandler(AXIOM_MEDIA_PLAYER_BUFFER_UPDATED_LIVE,m_fnBufferUpdate),g_oAxiomMediaPlayer.setHandler(AXIOM_MEDIA_PLAYER_QUALITY_COMPLETED,m_fnQualityComplete),g_oAxiomMediaPlayer.setHandler(AXIOM_MEDIA_PLAYER_QUALITY_SET,m_fnQualitySet),g_oAxiomMediaPlayer.setHandler(AXIOM_MEDIA_PLAYER_ERROR,m_fnPlayerError),g_oAxiomMediaPlayer.setHandler(AXIOM_MEDIA_PLAYER_STALLED,m_fnStalled),g_oAxiomMediaPlayer.setHandler(AXIOM_MEDIA_PLAYER_CUSTOM_HEADERS,m_fnCustomHeaders))},function(){m_fnBufferUpdate=function(oEvent){(oEvent.buffering||!oEvent.buffering&&oEvent.time>0)&&this.sendBufferEvent(oEvent.time)}.bind(this),m_fnQualityComplete=function(oEvent){var iCurrentQualityLevel=g_oAxiomMediaPlayer.getCurrentQualityIndex(),iTime=g_oAxiomMediaPlayer.getCurrentTime();!oEvent.UserInitiated&&iTime>0&&iCurrentQualityLevel!=m_iPlayerQualityLevel&&(m_iPlayerQualityLevel=iCurrentQualityLevel,this.sendAdaptationEvent(m_iPlayerQualityLevel,0))}.bind(this),m_fnQualitySet=function(oEvent){var iCurrentQualityLevel=g_oAxiomMediaPlayer.getQualityByIndex(oEvent.Level);g_oAxiomMediaPlayer.getCurrentTime()>0&&iCurrentQualityLevel!=m_iPlayerQualityLevel&&(m_iPlayerQualityLevel=iCurrentQualityLevel,this.sendAdaptationEvent(m_iPlayerQualityLevel,1))}.bind(this),m_fnPlayerError=function(oEvent){oEvent.error&&"http"==oEvent.error&&oEvent.code?this.sendHTTPErrorEvent(oEvent.code,oEvent.stream,oEvent.segment):"error"==oEvent.type&&oEvent.code&&this.sendGenericCodeEvent(oEvent.code)}.bind(this),m_fnStalled=function(){m_bStalled||(m_bStalled=!0,this.sendGenericCodeEvent(102))}.bind(this),m_fnCustomHeaders=function(oHeaders){var cHeaders=oHeaders["x-akamai-request-id"]+"|"+oHeaders.Stream+"|"+oHeaders.Segment;oHeaders["x-cache"]&&(cHeaders=cHeaders+"|"+oHeaders["x-cache"]),oHeaders["x-cache-remote"]&&(cHeaders=cHeaders+"|"+oHeaders["x-cache-remote"]);var oInfo={};oInfo.UserKey=m_iUserKey,oInfo.AttendeeKey=m_iAttendeeKey,oInfo.QueryCode=ANALYTICS_QUERY_CODE_AKA_HEADERS,oInfo.Query=cHeaders,g_oAxiomCommManager.SendAnalyticQuery(g_cSocketName,null,oInfo)}.bind(this);var iTimeout=1e4;g_oAxiomMediaPlayer&&g_oAxiomMediaPlayer.bIOS&&(iTimeout=3e4),m_iPingInterval=setTimeout(function onPing(){m_iPingInterval&&clearTimeout(m_iPingInterval);var iTimeout=1e4;if(g_oAxiomMediaPlayer&&g_oAxiomMediaPlayer.bIOS&&(iTimeout=3e4),m_iPingInterval=setTimeout(onPing.bind(this),iTimeout),g_oAxiomMediaPlayer&&g_oAxiomMediaPlayer.bIOS){var iTime=g_oAxiomMediaPlayer.getCurrentTime();iTime=iTime>=0?iTime:0,this.sendEvent(MSG_ANALYTICS_PINGIOS,[m_iUserKey,m_iAttendeeKey,iTime])}else{var iBytesLoaded=g_oAxiomMediaPlayer?g_oAxiomMediaPlayer.getBytesLoaded():0;iBytesLoaded<0&&(iBytesLoaded=0),this.sendEvent(MSG_ANALYTICS_PING,[m_iUserKey,m_iAttendeeKey,iBytesLoaded])}}.bind(this),iTimeout),g_oAxiomMediaPlayer&&g_oAxiomMediaPlayer.bDash&&setTimeout(function(){new AxiomHTTP("https://time.akamai.com/",function(oMsg){}.bind(this),!0,null,null,function(oMsg){this.sendGenericCodeEvent(104)}.bind(this),null,null,!0)}.bind(this),500),g_oAxiomCommManager.SetRequestAnalyticQueryHandler(g_cSocketName,{call:function(oMsg){switch(oMsg[ANALYTICS_QUERY_CODE]){case ANALYTICS_QUERY_CODE_AKA_HEADERS:g_oAxiomMediaPlayer&&g_oAxiomMediaPlayer.startCustomHeaderCapture(0);break;case ANALYTICS_QUERY_CODE_USER_INFO:SendClientInfo();break;case ANALYTICS_QUERY_CODE_USER_PLAYER:g_oAxiomMediaPlayer&&g_oAxiomMediaPlayer.SendInfo()}}.bind(this)})}.call(this)}