var FLAG_PANELMAP=1,FLAG_RESTORE=2,FLAG_BACKGROUNDSHIFT=4,FLAG_AUTOSIZE=8,FLAG_RESETORIGIN=16,FLAG_RESIZEWIDTH=32,FLAG_RESIZEHEIGHT=64,FLAG_CONSTRAIN=128,FLAG_ANIMATERESTORE=256,DRAG_WANTMOVE=0,DRAG_MOVE=1,DRAG_RESIZE=2,DRAG_MOVE_THRESHOLD=5,DRAG_SNAP_THRESHOLD=20,DRAG_SNAP_MARGIN=5,BEHAVIOR_MOVE=1,BEHAVIOR_RESIZE=2,BEHAVIOR_CLOSE=4,BEHAVIOR_MAXIMIZE=8,BEHAVIOR_SHIFT=16,BEHAVIOR_ONRESIZE_L=32,BEHAVIOR_ONRESIZE_T=64,BEHAVIOR_ONRESIZE_W=128,BEHAVIOR_ONRESIZE_H=256,BEHAVIOR_PANELBUTTON=512,LAYER_BACKGROUND=0,LAYER_WORKSPACE=1,LAYER_TOP=2,POSITION_TOP=0,POSITION_BOTTOM=1,POSITION_LEFT=2,POSITION_RIGHT=3,ARROW_LEFT=37,ARROW_UP=38,ARROW_RIGHT=39,ARROW_DOWN=40,KEYCODE_TAB=9,KEYCODE_ENTER=13,KEYCODE_SHIFT=16,KEYCODE_CTRL=17,KEYCODE_ALT=18,KEYCODE_DELETE=46,TOUCH_SWIPEDURATION=300,TOUCH_CLICKDURATION=150,TOUCH_HIGHLIGHTDURATION=600,EDGE_NW=7,EDGE_N=0,EDGE_NE=1,EDGE_W=6,EDGE_E=2,EDGE_SW=5,EDGE_S=4,EDGE_SE=3,PANEL_MAP_SCALE=.05,RESIZER_WIDTH=6,MAXIMIZE_PAD=5,PARALLAX_FACTOR=.3333,ANIM_TICK=20,SPOTLIGHT_TICK=50,FOREGROUND_Z=20,Editor=null,Workspace={Node:null,Initialized:!1,Modified:!1,Title:"",Description:"",ThemeKey:0,Width:0,Height:0,Flags:0,HasPanelMap:!1,HasRestore:!1,RestoreIconURL:"",BackgroundShift:!1,AutoSize:!1,ResetOrigin:!1,ResizeWidth:!1,ResizeHeight:!1,Constrained:!1,AnimateRestore:!1,AutoImages:[],SnapThreshold:20,SnapMargin:5,InitialSize:{Width:0,Height:0},LastWindowSize:null,LastOffsetLeft:0,CaptureLayer:null,Stylesheet:null,BackgroundPosition:{Left:0,Top:0,InitPosition:""},Scrolling:!1,Touch:!1,UIColor:"Silver",TransitionColor:"",BackgroundColor:"",ViewPort:{Left:0,Top:0,MinLeft:0,MaxLeft:0,MinTop:0,MaxTop:0},ShiftButton:{North:null,East:null,South:null,West:null},ShiftAnimList:[],ShiftRestorePanel:null,AnimPanel:null,AnimLayer:null,AnimList:[],SpotlightPanel:null,SpotlightAnim:[],PanelBar:{Position:POSITION_TOP,Left:0,Top:0,ThumbClass:"ThumbDefault",Node:null},Panels:[],PanelMap:null,TouchTool:null,TempPanelKey:0,TempPanelZ:0,TopPanel:null,Cursors:["n","ne","e","se","s","sw","w","nw"],DragState:{Type:null,Panel:null,Touch:null,EdgeIndex:null,TimerID:null,StartX:0,StartY:0},SnapState:{Snap:!0,Top:{Value:null,Node:null},Left:{Value:null,Node:null},Right:{Value:null,Node:null},Bottom:{Value:null,Node:null}},Initialize:function(bEditMode){var oLayer=document.getElementById("Workspace");if(oLayer&&(!oLayer||"DIV"==oLayer.tagName)){Workspace.LoadScript("AutoImage.js",Workspace.OnLoadAutoImage),Workspace.Node=oLayer,Workspace.Touch=IsIPad(),Workspace.Flags=1*oLayer.getAttribute("flags"),Workspace.HasPanelMap=!!(Workspace.Flags&FLAG_PANELMAP),Workspace.HasRestore=!!(Workspace.Flags&FLAG_RESTORE),Workspace.BackgroundShift=!!(Workspace.Flags&FLAG_BACKGROUNDSHIFT),Workspace.AutoSize=!!(Workspace.Flags&FLAG_AUTOSIZE),Workspace.ResetOrigin=!!(Workspace.Flags&FLAG_RESETORIGIN),Workspace.ResizeWidth=!!(Workspace.Flags&FLAG_RESIZEWIDTH),Workspace.ResizeHeight=!!(Workspace.Flags&FLAG_RESIZEHEIGHT),Workspace.Constrained=!!(Workspace.Flags&FLAG_CONSTRAIN),Workspace.AnimateRestore=!!(Workspace.Flags&FLAG_ANIMATERESTORE);var cLimits=oLayer.getAttribute("limits");cLimits&&""!=cLimits&&"0,0,0,0"!=cLimits||(Workspace.Scrolling=!0,cLimits="0,0,0,0");var aLimits=cLimits.split(",");if(Workspace.ViewPort.MinLeft=1*aLimits[0],Workspace.ViewPort.MaxLeft=1*aLimits[1],Workspace.ViewPort.MinTop=1*aLimits[2],Workspace.ViewPort.MaxTop=1*aLimits[3],Workspace.SnapState.Top.Node=document.getElementById("SnapTop"),Workspace.SnapState.Left.Node=document.getElementById("SnapLeft"),Workspace.SnapState.Right.Node=document.getElementById("SnapRight"),Workspace.SnapState.Bottom.Node=document.getElementById("SnapBottom"),Workspace.ViewPort.MinTop?Workspace.ShiftButton.North=document.getElementById("ShiftNorth"):Workspace.Node.parentNode.removeChild(document.getElementById("ShiftNorth")),Workspace.ViewPort.MaxLeft?Workspace.ShiftButton.East=document.getElementById("ShiftEast"):Workspace.Node.parentNode.removeChild(document.getElementById("ShiftEast")),Workspace.ViewPort.MaxTop?Workspace.ShiftButton.South=document.getElementById("ShiftSouth"):Workspace.Node.parentNode.removeChild(document.getElementById("ShiftSouth")),Workspace.ViewPort.MinLeft?Workspace.ShiftButton.West=document.getElementById("ShiftWest"):Workspace.Node.parentNode.removeChild(document.getElementById("ShiftWest")),Workspace.Touch)for(var aEdge=document.getElementsByTagName("DIV"),i=aEdge.length-1;i>=0;i--)"Edge"==aEdge[i].className&&aEdge[i].parentNode.removeChild(aEdge[i]);Workspace.Width=parseInt(oLayer.style.width,10),Workspace.Height=parseInt(oLayer.style.height,10),Workspace.InitialSize.Width=Workspace.Width,Workspace.InitialSize.Height=Workspace.Height,Workspace.LastWindowSize={width:Workspace.Width,height:Workspace.Height},Workspace.SnapState.Snap=bEditMode||Workspace.ResizeWidth||Workspace.ResizeHeight,Workspace.SnapThreshold=1*oLayer.getAttribute("snapthreshold"),Workspace.SnapThreshold&&!isNaN(Workspace.SnapThreshold)||(Workspace.SnapThreshold=DRAG_SNAP_THRESHOLD),Workspace.SnapMargin=1*oLayer.getAttribute("snapmargin"),isNaN(Workspace.SnapMargin)?Workspace.SnapMargin=DRAG_SNAP_MARGIN:MAXIMIZE_PAD=Workspace.SnapMargin,Workspace.Stylesheet=SS.FindSheet("WS!36040"),Workspace.Stylesheet||(Workspace.Stylesheet={Rules:{body:document.body}});var oBody=Workspace.Stylesheet.Rules.body;if(oBody&&(Workspace.BackgroundColor=oBody.style.backgroundColor),oLayer&&(Workspace.TransitionColor=oLayer.getAttribute("transitioncolor")),Workspace.BackgroundColor&&Workspace.TransitionColor&&oBody&&(oBody.style.transition="background-color ease 5s"),Workspace.ThemeKey=oLayer.getAttribute("themekey"),Workspace.UIColor=oLayer.getAttribute("uicolor"),Workspace.PanelBar.ThumbClass=oLayer.getAttribute("thumbclass"),Workspace.PanelBar.Position=1*oLayer.getAttribute("panelbarpos"),Workspace.RestoreIconURL=oLayer.getAttribute("restoreiconurl"),Workspace.CreatePanelBarNode(),Workspace.HasPanelMap&&Workspace.CreatePanelMap(),oBody&&(Workspace.BackgroundPosition.InitPosition=oBody.style.backgroundPosition),Workspace.BackgroundShift&&oBody){var aPosition=oBody.style.backgroundPosition.split(" ");aPosition&&aPosition.length&&(Workspace.BackgroundPosition.Left=parseInt(aPosition[0],10),isNaN(Workspace.BackgroundPosition.Left)&&(Workspace.BackgroundPosition.Left=0),Workspace.BackgroundPosition.Top=parseInt(aPosition[1],10),isNaN(Workspace.BackgroundPosition.Top)&&(Workspace.BackgroundPosition.Top=0))}Workspace.AnimLayer=document.createElement("div"),Workspace.AnimLayer.style.display="none",Workspace.AnimLayer.style.position="absolute";try{Workspace.AnimLayer.style.border="solid 1px "+Workspace.UIColor}catch(e){Workspace.AnimLayer.style.border="solid 1px black"}Workspace.AnimLayer.style.backgroundColor="White",Workspace.AnimLayer.style.zIndex=98,Workspace.AnimLayer.style.opacity=.5,Workspace.Node.appendChild(Workspace.AnimLayer),Workspace.ResizeWidth||(Workspace.Node.style.margin="0px auto");var oNode,oPanel,iCount=0;for(i=0;i<oLayer.childNodes.length;i++)if(1==(oNode=oLayer.childNodes[i]).nodeType&&oNode.className.indexOf("WorkspacePanel")>-1){oPanel=new Workspace.Panel(oNode,++iCount,bEditMode),Workspace.Panels.push(oPanel),Workspace.InitializeFrame(oPanel),Workspace.InitializeTitle(oPanel);var cResizeFunction="PanelResize"+oPanel.Key;void 0!=window[cResizeFunction]&&window[cResizeFunction](oPanel.ContentNode,oPanel.ContentWidth,oPanel.ContentHeight)}Workspace.TempPanelZ=iCount,AddEventHandler(window,"resize",Workspace.OnResize),AddEventHandler(window,"keydown",Workspace.OnKeyDown),AddEventHandler(window,"keyup",Workspace.OnKeyUp),setTimeout(Workspace.Reveal,50),window.focus()}},Panel:function(oNode,iZIndex,bEditMode){this.Node=oNode,this.SizeNode=null,this.Left=parseInt(oNode.style.left,10),this.Top=parseInt(oNode.style.top,10),this.Width=parseInt(oNode.style.width,10),this.Height=parseInt(oNode.style.height,10),this.VirtualLeft=this.Left,this.VirtualTop=this.Top,this.Key=1*oNode.getAttribute("key"),this.DisplayOrder=1*oNode.getAttribute("displayorder"),this.EdgeWidth=1*oNode.getAttribute("edgewidth"),this.TitleHeight=1*oNode.getAttribute("titleheight"),this.ContentLeft=1*oNode.getAttribute("contentleft"),this.ContentTop=1*oNode.getAttribute("contenttop"),this.ContentWidth=1*oNode.getAttribute("contentwidth"),this.ContentHeight=1*oNode.getAttribute("contentheight"),this.MinWidth=1*oNode.getAttribute("minwidth"),this.MinHeight=1*oNode.getAttribute("minheight"),this.Behavior=1*oNode.getAttribute("behavior"),this.InitBehavior=this.Behavior,bEditMode&&(this.Behavior=this.Behavior|BEHAVIOR_MOVE|BEHAVIOR_RESIZE,this.SizeNode=document.createElement("span"),this.SizeNode.setAttribute("class","ContentSize"),this.SizeNode.setAttribute("title","Content area dimensions"),this.SizeNode.appendChild(document.createTextNode(this.ContentWidth+" x "+this.ContentHeight))),this.Layer=1*oNode.getAttribute("layer"),this.ThumbURL=oNode.getAttribute("thumb"),this.ThumbNode=null,this.Title=oNode.getAttribute("paneltitle"),this.TitleType=oNode.getAttribute("titletype"),this.TitleHeight=0,this.LinkHREF=oNode.getAttribute("linkhref"),this.LinkTarget=oNode.getAttribute("linktarget"),this.LinkDesc="",this.InternalID=1*oNode.getAttribute("internalid"),this.Active="true"==oNode.getAttribute("active"),this.Framed="1"==oNode.getAttribute("frametype"),this.Maximized=!1,this.Closed="true"==oNode.getAttribute("closed"),this.InitClosed=this.Closed,this.Group=null,iZIndex+=this.Layer*FOREGROUND_Z,this.Node.style.zIndex=iZIndex,this.InitialState={x:this.Left,y:this.Top,w:this.Width,h:this.Height,z:iZIndex,c:this.Closed},this.GetRect=function(){return{x:this.Left,y:this.Top,w:this.Width,h:this.Height}},this.LanguageAlternates="",this.PropertyAlternates="",this.PropertyParams="",this.Modified=!1,this.Refresh=!1,this.NeedFrameSrc=!1},PanelFrameResize:function(oContentNode,iWidth,iHeight){var oFrame=oContentNode.getElementsByTagName("IFRAME")[0];if(oFrame.setAttribute("width",iWidth),oFrame.setAttribute("height",iHeight),Workspace.Touch)try{oFrame.contentWindow.OverflowLayerResize()}catch(e){}},CreatePanel:function(cPanelTitle,iKey,iType){if(Editor)return null;var oTemplate=Workspace.Panels[0];if(iType)for(var i=0;i<Workspace.Panels.length;i++)if(Workspace.Panels[i].InternalID==iType){oTemplate=Workspace.Panels[i];break}var oNode=document.createElement("div");if(Workspace.CloneEverythingExcept(oNode,oTemplate.Node,{VIDEO:1,AUDIO:1}),oNode=oNode.children[0],iKey||(Workspace.TempPanelKey--,iKey=Workspace.TempPanelKey),Workspace.Stylesheet.CloneRules(oNode.id.replace("Panel","PanelButton"),"PanelButton"+iKey),oNode.setAttribute("key",iKey),oNode.id="Panel"+iKey,oNode.style.display="",oTemplate.Framed){oNode.setAttribute("paneltitle",cPanelTitle);for(var oTitleNode=GetFirstChild(oNode);oTitleNode.childNodes.length>1;)oTitleNode.removeChild(oTitleNode.childNodes[0]);if("0"==oTemplate.TitleType){for(var oTitle=oNode.getElementsByTagName("P")[0];oTitle.childNodes.length;)oTitle.removeChild(oTitle.childNodes[0]);oTitle.appendChild(document.createTextNode(cPanelTitle))}}var oPanel=new Workspace.Panel(oNode,Workspace.TempPanelZ++,!1);for(oPanel.VirtualLeft=Workspace.ViewPort.Left*Workspace.Width,oPanel.VirtualTop=Workspace.ViewPort.Top*Workspace.Height,oPanel.ContentWidth=oTemplate.ContentWidth,oPanel.ContentHeight=oTemplate.ContentHeight,Workspace.Panels.push(oPanel),Workspace.InitializeFrame(oPanel),oPanel.Framed&&Workspace.InitializeTitle(oPanel),Workspace.PositionPanelBar(GetViewSize());oPanel.ContentNode.childNodes.length;)oPanel.ContentNode.removeChild(oPanel.ContentNode.childNodes[0]);return Workspace.Node.appendChild(oNode),oPanel},CloneEverythingExcept:function(oParent,oNode,oInvalidMap){if(oNode){var oClonedNode;if(oInvalidMap&&oInvalidMap[oNode.tagName.toUpperCase()])return;oClonedNode=oNode.cloneNode(!1),oParent.appendChild(oClonedNode);for(var iLup=0;iLup<oNode.children.length;iLup++)Workspace.CloneEverythingExcept(oClonedNode,oNode.children[iLup],oInvalidMap)}},DestroyPanel:function(oPanel){oPanel.Node&&(oPanel.Node.parentNode.removeChild(oPanel.Node),oPanel.Node=null),oPanel.ThumbNode&&(oPanel.ThumbNode.parentNode.removeChild(oPanel.ThumbNode),oPanel.ThumbNode=null);for(var i=0;i<Workspace.Panels.length;i++)if(Workspace.Panels[i]==oPanel){Workspace.Panels.splice(i,1);break}Workspace.PositionPanelBar(GetViewSize())},OnContentLoaded:function(evt){var iKey=1*(evt.target?evt.target:evt.srcElement).getAttribute("key"),oPanel=Workspace.FindPanel(null,iKey);if(oPanel){var oFrame=oPanel.ContentNode.getElementsByTagName("IFRAME")[0];try{oFrame.contentWindow.g_iWorkspacePanelKey=oPanel.Key,Workspace.InstallClickHandler(oFrame.contentWindow),Workspace.Touch&&oFrame.contentWindow.OverflowLayerResize()}catch(e){}}},InstallClickHandler:function(oWin){var cEvent=Workspace.Touch?"touchstart":"click",cFunc="function(){try{parent.Workspace.OnFrameDocClick(g_iWorkspacePanelKey);}catch(e){}}";oWin.setTimeout('if(window.addEventListener) window.addEventListener("'+cEvent+'",'+cFunc+',false); else if(window.attachEvent) window.attachEvent("on'+cEvent+'",'+cFunc+");",1)},InitializeFrame:function(oPanel){var oNode,iEdge;oPanel.Layer==LAYER_WORKSPACE?AddEventHandler(oPanel.Node,Workspace.Touch?"touchstart":"click",Workspace.PanelClick):oPanel.Layer==LAYER_BACKGROUND&&oPanel.LinkHREF.length&&(AddEventHandler(oPanel.Node,Workspace.Touch?"touchstart":"click",Workspace.PanelClick),oPanel.Node.style.cursor="pointer");for(var i=0;i<oPanel.Node.childNodes.length;i++)if(1==(oNode=oPanel.Node.childNodes[i]).nodeType&&"Edge"==oNode.className)oPanel.Edge||(oPanel.Edge=[]),iEdge=1*oNode.getAttribute("edge"),oPanel.Edge[iEdge]=oNode,oPanel.Behavior&BEHAVIOR_RESIZE&&(oNode.style.cursor=Workspace.Cursors[iEdge]+"-resize",AddEventHandler(oNode,"mousedown",Workspace.DragStart));else if(1==oNode.nodeType&&"Content"==oNode.className){oPanel.ContentNode=oNode;var oChild=GetFirstChild(oPanel.ContentNode);oChild&&"IFRAME"==oChild.tagName&&(oPanel.FrameNode=oChild,oPanel.FrameNode.setAttribute("key",oPanel.Key),AddEventHandler(oPanel.FrameNode,"load",Workspace.OnContentLoaded)),oPanel.Framed&&oPanel.SizeNode&&oPanel.ContentNode.appendChild(oPanel.SizeNode)}oPanel.Closed&&(oPanel.Node.style.visibility="hidden")},InitializeTitle:function(oPanel){for(var oNode,oSpan,oImg,i=0;i<oPanel.Node.childNodes.length;i++)1==(oNode=oPanel.Node.childNodes[i]).nodeType&&"TitleBar"==oNode.className&&(oPanel.TitleNode=oNode,oPanel.TitleHeight=parseInt(oNode.style.height,10),Workspace.DisableSelection(oNode),oPanel.ThumbURL&&oPanel.ThumbURL.length&&((oImg=document.createElement("img")).className="PanelIcon",oImg.src=oPanel.ThumbURL,oNode.insertBefore(oImg,oNode.childNodes[0])),(oPanel.Behavior&BEHAVIOR_MOVE||Workspace.Touch&&oPanel.Behavior&BEHAVIOR_RESIZE)&&((!Editor||Editor&&Editor.Advanced)&&(oNode.style.cursor="move"),Workspace.Touch?AddEventHandler(oNode,"touchstart",Workspace.TouchStart):AddEventHandler(oNode,"mousedown",Workspace.DragStart)),(oSpan=document.createElement("span")).className="PanelMaximize",oSpan.setAttribute("aria-hidden","true"),oNode.insertBefore(oSpan,oNode.childNodes[0]),oPanel.ToggleNode=oSpan,(!Editor||Editor&&Editor.Advanced)&&AddEventHandler(oSpan,Workspace.Touch?"touchstart":"mousedown",Workspace.PanelToggleClick),oSpan.style.display=oPanel.Behavior&BEHAVIOR_MAXIMIZE?"":"none",(oSpan=document.createElement("span")).className="PanelClose",oSpan.setAttribute("aria-hidden","true"),oNode.insertBefore(oSpan,oNode.childNodes[0]),oPanel.CloseNode=oSpan,AddEventHandler(oSpan,Workspace.Touch?"touchstart":"mousedown",Workspace.PanelCloseClick),oSpan.style.display=oPanel.Behavior&BEHAVIOR_CLOSE?"":"none");if(Workspace.AddPanelBarThumb(oPanel),!oPanel.TitleNode&&oPanel.Behavior&BEHAVIOR_MOVE){Workspace.Touch?AddEventHandler(oPanel.Node,"touchstart",Workspace.TouchStart):AddEventHandler(oPanel.Node,"mousedown",Workspace.DragStart);var oDragHandle=document.createElement("div");oDragHandle.className="DragHandle",oDragHandle.style.left=oPanel.EdgeWidth+"px",oDragHandle.style.top=oPanel.EdgeWidth+"px",oDragHandle.style.width=Math.max(0,oPanel.Width-2*oPanel.EdgeWidth)+"px",oDragHandle.style.height=Math.max(0,oPanel.Height-2*oPanel.EdgeWidth)+"px",oPanel.Node.appendChild(oDragHandle),oPanel.DragHandle=oDragHandle,!Editor||Editor&&Editor.Advanced?oPanel.Node.style.cursor="move":oDragHandle.style.cursor="default"}else oPanel.DragHandle=null},InitializeGroups:function(){for(var oPanel,cGroup,aKeys,oMergeWith,i=0;i<Workspace.Panels.length;i++)if((cGroup=(oPanel=Workspace.Panels[i]).Node.getAttribute("group"))&&cGroup.length&&!oPanel.Group){if((aKeys=cGroup.split(",")).length<2)continue;for(var j=0;j<aKeys.length;j++)if(oMergeWith=Workspace.FindPanel(null,aKeys[j])){for(var k=j+1;k<aKeys.length;k++)Workspace.MergePanel(Workspace.FindPanel(null,aKeys[k]),oMergeWith);oMergeWith.Closed||Editor||Workspace.ActivateGroupedPanel(oMergeWith);break}}},CreatePanelBarNode:function(){var oNode=document.createElement("div");if(oNode.id="PanelBar",oNode.style.visibility="hidden",Workspace.Node.parentNode.appendChild(oNode),Workspace.PanelBar.Node=oNode,Workspace.HasRestore){var cTitle="Restore";window.g_oMessages&&g_oMessages.RestoreLabel?cTitle=g_oMessages.RestoreLabel:window.g_cMessages&&g_cMessages.Restore?cTitle=g_cMessages.Restore:window.g_oStrings&&g_oStrings.Restore&&(cTitle=g_oStrings.Restore);var cURL=Workspace.RestoreIconURL?Workspace.RestoreIconURL:"/cfr/images/VTS/Workspace/Restore.png";Workspace.AddPanelBarThumb(null,{ThumbURL:cURL,Attributes:{id:"PanelBarRestoreBtn",title:cTitle},ClickHandler:Workspace.RestoreInitialState},!0)}},AddPanelBarThumb:function(oPanel,oCustom,bFirst){var oBar=Workspace.PanelBar.Node,oImg=document.createElement("img");if(oImg.className=Workspace.PanelBar.ThumbClass,oImg.src=oPanel?oPanel.ThumbURL:oCustom.ThumbURL,bFirst&&oBar.childNodes[0]?oBar.insertBefore(oImg,oBar.childNodes[0]):oBar.appendChild(oImg),oCustom){if("object"==typeof oCustom.Attributes)for(var cName in oCustom.Attributes)"class"==cName?oImg.className=oCustom.Attributes[cName]+" "+oImg.className:"cssText"==cName?oImg.style.cssText=oCustom.Attributes[cName]:oImg.setAttribute(cName,oCustom.Attributes[cName]);"function"==typeof oCustom.ClickHandler&&AddEventHandler(oImg,Workspace.Touch?"touchstart":"mousedown",oCustom.ClickHandler)}else if(oImg.setAttribute("id","PanelButton"+oPanel.Key),oImg.setAttribute("key",oPanel.Key),oImg.setAttribute("title",oPanel.Title),oPanel.ThumbNode=oImg,AddEventHandler(oImg,Workspace.Touch?"touchstart":"mousedown",Workspace.PanelRestoreClick),oPanel.Behavior&BEHAVIOR_PANELBUTTON||(oPanel.ThumbNode.style.display="none"),oPanel.Active||(Editor?oPanel.ThumbNode.style.opacity=".3":oPanel.ThumbNode.style.display="none"),Workspace.PanelMap&&oPanel.Behavior&BEHAVIOR_SHIFT){var oNode=document.createElement("div");oNode.className="PanelMapRect",oNode.style.left=Math.floor(oPanel.Left*PANEL_MAP_SCALE)+Workspace.PanelMap.OffsetX+"px",oNode.style.top=Math.floor(oPanel.Top*PANEL_MAP_SCALE)+Workspace.PanelMap.OffsetY+"px",oNode.style.width=Math.max(2,Math.floor(oPanel.Width*PANEL_MAP_SCALE)-2)+"px",oNode.style.height=Math.max(2,Math.floor(oPanel.Height*PANEL_MAP_SCALE)-2)+"px";try{oNode.style.borderColor=Workspace.UIColor}catch(e){}oPanel.MapNode=oNode,Workspace.PanelMap.Node.appendChild(oNode)}},CreatePanelMap:function(){Workspace.PanelMap=new Object,Workspace.PanelMap.Left=0,Workspace.PanelMap.Top=0,Workspace.PanelMap.Width=Math.floor((1+Math.abs(Workspace.ViewPort.MinLeft)+Math.abs(Workspace.ViewPort.MaxLeft))*Workspace.Width*PANEL_MAP_SCALE),Workspace.PanelMap.Height=Math.floor((1+Math.abs(Workspace.ViewPort.MinTop)+Math.abs(Workspace.ViewPort.MaxTop))*Workspace.Height*PANEL_MAP_SCALE),Workspace.PanelMap.OffsetX=Math.floor(Math.abs(Workspace.ViewPort.MinLeft)*Workspace.Width*PANEL_MAP_SCALE),Workspace.PanelMap.OffsetY=Math.floor(Math.abs(Workspace.ViewPort.MinTop)*Workspace.Height*PANEL_MAP_SCALE),Workspace.PanelMap.ViewPortWidth=Math.floor(Workspace.Width*PANEL_MAP_SCALE),Workspace.PanelMap.ViewPortHeight=Math.floor(Workspace.Height*PANEL_MAP_SCALE);var oNode=document.createElement("div");oNode.id="PanelMap",oNode.style.left="0px",oNode.style.top="0px",oNode.style.width=Math.max(0,Workspace.PanelMap.Width)+"px",oNode.style.height=Math.max(0,Workspace.PanelMap.Height)+"px",oNode.style.visibility="hidden",Workspace.Node.parentNode.appendChild(oNode),Workspace.PanelMap.Node=oNode,Workspace.PanelMap.ViewPortNodes=[];for(var iTop=Workspace.ViewPort.MinTop;iTop<=Workspace.ViewPort.MaxTop;iTop++)for(var iLeft=Workspace.ViewPort.MinLeft;iLeft<=Workspace.ViewPort.MaxLeft;iLeft++)(oNode=document.createElement("div")).id="PanelMapViewPort_"+iLeft+"_"+iTop,oNode.className="PanelMapViewPort"+(0==iLeft&&0==iTop?"Active":""),oNode.style.left=(iLeft-Workspace.ViewPort.MinLeft)*Workspace.PanelMap.ViewPortWidth+"px",oNode.style.top=(iTop-Workspace.ViewPort.MinTop)*Workspace.PanelMap.ViewPortHeight+"px",oNode.style.width=Math.max(0,Workspace.PanelMap.ViewPortWidth-2)+"px",oNode.style.height=Math.max(0,Workspace.PanelMap.ViewPortHeight-2)+"px",oNode.setAttribute("leftpos",iLeft),oNode.setAttribute("toppos",iTop),AddEventHandler(oNode,Workspace.Touch?"touchstart":"click",Workspace.PanelMapClick),Workspace.PanelMap.Node.appendChild(oNode),Workspace.PanelMap.ViewPortNodes.push(oNode)},ConnectFrameDocs:function(){for(var oPanel,aFrames,i=0;i<Workspace.Panels.length;i++)if((oPanel=Workspace.Panels[i]).ContentNode){if(0==(aFrames=oPanel.ContentNode.getElementsByTagName("IFRAME")).length)continue;oPanel.Closed?oPanel.NeedFrameSrc=!0:Workspace.SetFrameSrc(oPanel,aFrames)}},SetFrameSrc:function(oPanel,aFrames){aFrames||(aFrames=oPanel.ContentNode.getElementsByTagName("IFRAME"));for(var iFrame=0;iFrame<aFrames.length;iFrame++)try{var cSrc=aFrames[iFrame].getAttribute("initsrc");cSrc&&cSrc.length?aFrames[iFrame].src=RandomizeURL(cSrc,!0):(aFrames[iFrame].contentWindow.g_iWorkspacePanelKey=oPanel.Key,Workspace.InstallClickHandler(aFrames[iFrame].contentWindow))}catch(e){}},OnFrameDocClick:function(iKey){var oPanel=Workspace.FindPanel(null,iKey);oPanel&&oPanel.Layer==LAYER_WORKSPACE&&Workspace.BringForward(oPanel)},OnLinkClick:function(oAnchor){for(var oPanel,i=0;i<Workspace.Panels.length;i++)if((oPanel=Workspace.Panels[i]).FrameNode&&oPanel.FrameNode.name==oAnchor.target)return void Workspace.RestorePanel(oPanel)},Reveal:function(){if(Workspace.ResizeWidth||Workspace.ResizeHeight){var iOffset=Math.min(Workspace.PanelBar.Node.offsetWidth,Workspace.PanelBar.Node.offsetHeight);iOffset&&(iOffset+=MAXIMIZE_PAD),Workspace.LastWindowSize={width:Workspace.Width,height:Workspace.Height},!Workspace.ResizeHeight||Workspace.PanelBar.Position!=POSITION_BOTTOM&&Workspace.PanelBar.Position!=POSITION_TOP||(Workspace.LastWindowSize.height+=iOffset),!Workspace.ResizeWidth||Workspace.PanelBar.Position!=POSITION_LEFT&&Workspace.PanelBar.Position!=POSITION_RIGHT||(Workspace.LastWindowSize.width+=iOffset)}Workspace.LastOffsetLeft=Workspace.Node.offsetLeft,Workspace.OnResize(),Workspace.UpdateShiftButtons(),Workspace.InitializeGroups(),Workspace.Node.style.display="",setTimeout(Workspace.Reveal2,50)},Reveal2:function(){for(var oPanel,i=0;i<Workspace.Panels.length;i++){var cResizeFunction="PanelResize"+(oPanel=Workspace.Panels[i]).Key;void 0!=window[cResizeFunction]&&window[cResizeFunction](oPanel.ContentNode,oPanel.ContentWidth,oPanel.ContentHeight)}var oSize=GetViewSize();Workspace.PositionPanelMap(oSize),Workspace.PositionPanelBar(oSize),Workspace.PositionShiftButtons(oSize),setTimeout('Workspace.Node.style.visibility ="visible";',50),Workspace.PanelMap&&(Workspace.PanelMap.Node.style.visibility="visible"),Workspace.Initialized=!0,void 0!=window.WorkspaceInitComplete&&setTimeout(WorkspaceInitComplete,50),setTimeout(Workspace.ConnectFrameDocs,50)},OnResize:function(evt,iWidthAdjust,iHeightAdjust){var iWidthChange,iHeightChange,oPanel,oChange,oSize=GetViewSize();iWidthChange=oSize.width-Workspace.LastWindowSize.width-(iWidthAdjust||0),iHeightChange=oSize.height-Workspace.LastWindowSize.height-(iHeightAdjust||0),Workspace.ResizeWidth&&iWidthChange&&(Workspace.Width+=iWidthChange,Workspace.Node.style.width=Math.max(0,Workspace.Width)+"px"),Workspace.ResizeHeight&&iHeightChange&&(Workspace.Height+=iHeightChange,Workspace.Node.style.height=Math.max(0,Workspace.Height)+"px"),Editor&&(Workspace.ResizeWidth&&iWidthChange||Workspace.ResizeHeight&&iHeightChange)&&Editor.SetWorkspaceModified(!0);for(var i=0;i<Workspace.Panels.length;i++)oChange={x:0,y:0,w:0,h:0},(oPanel=Workspace.Panels[i]).Maximized?(oChange.x=Workspace.LastOffsetLeft-Workspace.Node.offsetLeft,oChange.w=iWidthChange,oChange.h=iHeightChange):(Workspace.ResizeWidth&&(oPanel.Behavior&BEHAVIOR_ONRESIZE_L&&(oChange.x=iWidthChange),oPanel.Behavior&BEHAVIOR_ONRESIZE_W&&(oChange.w=iWidthChange)),Workspace.ResizeHeight&&(oPanel.Behavior&BEHAVIOR_ONRESIZE_T&&(oChange.y=iHeightChange),oPanel.Behavior&BEHAVIOR_ONRESIZE_H&&(oChange.h=iHeightChange))),(oChange.x||oChange.y||oChange.w||oChange.h)&&Workspace.UpdatePanel(oPanel,oChange,!1,!1);Workspace.Initialized&&(Workspace.PositionPanelMap(oSize),Workspace.PositionPanelBar(oSize),Workspace.PositionShiftButtons(oSize)),Workspace.LastWindowSize=oSize,Workspace.LastOffsetLeft=Workspace.Node.offsetLeft},UpdatePanel:function(oPanel,oChange,bShift,bUpdateGroup){if(Workspace.Constrained&&Workspace.Dragging(oPanel)&&Workspace.Constrain(oPanel,oChange),oPanel.Width+oChange.w<oPanel.MinWidth){var iAdjust=oPanel.MinWidth-(oPanel.Width+oChange.w);oChange.w+=iAdjust,Workspace.DragState.Type==DRAG_RESIZE&&[EDGE_NW,EDGE_W,EDGE_SW].indexOf(Workspace.DragState.EdgeIndex)>-1&&(oChange.x-=iAdjust)}if(oPanel.Height+oChange.h<oPanel.MinHeight){iAdjust=oPanel.MinHeight-(oPanel.Height+oChange.h);oChange.h+=iAdjust,Workspace.DragState.Type==DRAG_RESIZE&&[EDGE_NW,EDGE_N,EDGE_NE].indexOf(Workspace.DragState.EdgeIndex)>-1&&(oChange.y-=iAdjust)}var bResized=!1;if(bShift){if(bShift&&oPanel==Workspace.DragState.Panel){if(oPanel.Group)for(var i=0;i<oPanel.Group.length;i++)oPanel.Group[i].VirtualLeft-=oChange.x,oPanel.Group[i].VirtualTop-=oChange.y;else oPanel.VirtualLeft-=oChange.x,oPanel.VirtualTop-=oChange.y;oPanel.Modified=!0,Editor&&Editor.SetWorkspaceModified(!0)}}else oPanel.VirtualLeft+=oChange.x,oPanel.VirtualTop+=oChange.y,(oChange.x||oChange.y)&&(oPanel.Modified=!0,Editor&&Editor.SetWorkspaceModified(!0));if((!bShift||bShift&&!Workspace.Dragging(oPanel))&&(oPanel.Left+=oChange.x,oPanel.Top+=oChange.y,oPanel.Width+=oChange.w,oPanel.Height+=oChange.h,oPanel.ContentWidth+=oChange.w,oPanel.ContentHeight+=oChange.h,(oChange.w||oChange.h)&&(oPanel.Modified=!0,Editor&&Editor.SetWorkspaceModified(!0))),oChange.x&&(oPanel.Node.style.left=oPanel.Left+"px",!bShift&&oPanel.MapNode&&(oPanel.MapNode.style.left=Math.floor(oPanel.Left*PANEL_MAP_SCALE)+Workspace.PanelMap.OffsetX+"px")),oChange.y&&(oPanel.Node.style.top=oPanel.Top+"px",!bShift&&oPanel.MapNode&&(oPanel.MapNode.style.top=Math.floor(oPanel.Top*PANEL_MAP_SCALE)+Workspace.PanelMap.OffsetY+"px")),oChange.w){oPanel.Node.style.width=Math.max(0,oPanel.Width)+"px",oPanel.ContentNode.style.width=Math.max(0,oPanel.ContentWidth)+"px",oPanel.MapNode&&(oPanel.MapNode.style.width=Math.max(0,Math.floor(oPanel.Width*PANEL_MAP_SCALE)-2)+"px");var cInnerWidth=Math.max(0,oPanel.Width-2*oPanel.EdgeWidth)+"px";if(oPanel.TitleNode&&(oPanel.TitleNode.style.width=cInnerWidth),oPanel.Edge){cInnerWidth=Math.max(0,oPanel.Width-(oPanel.EdgeWidth>RESIZER_WIDTH?2*oPanel.EdgeWidth:2*RESIZER_WIDTH))+"px",oPanel.Edge[0].style.width=cInnerWidth,oPanel.Edge[4].style.width=cInnerWidth;var cLeft=oPanel.Width-(oPanel.EdgeWidth>RESIZER_WIDTH?oPanel.EdgeWidth:RESIZER_WIDTH)+"px";oPanel.Edge[1].style.left=cLeft,oPanel.Edge[2].style.left=cLeft,oPanel.Edge[3].style.left=cLeft}oPanel.DragHandle&&(oPanel.DragHandle.style.width=Math.max(0,oPanel.Width-12)+"px"),Workspace.Touch&&oPanel==Workspace.DragState.Panel&&(Workspace.TouchTool.style.width=Math.max(0,oPanel.Width)+"px"),bResized=!0}if(oChange.h){if(oPanel.Node.style.height=Math.max(0,oPanel.Height)+"px",oPanel.ContentNode.style.height=Math.max(0,oPanel.ContentHeight)+"px",oPanel.MapNode&&(oPanel.MapNode.style.height=Math.max(0,Math.floor(oPanel.Height*PANEL_MAP_SCALE)-2)+"px"),oPanel.Edge){var cInnerHeight=Math.max(0,oPanel.Height-(oPanel.EdgeWidth>RESIZER_WIDTH?2*oPanel.EdgeWidth:2*RESIZER_WIDTH))+"px";oPanel.Edge[2].style.height=cInnerHeight,oPanel.Edge[6].style.height=cInnerHeight;var cTop=oPanel.Height-(oPanel.EdgeWidth>RESIZER_WIDTH?oPanel.EdgeWidth:RESIZER_WIDTH)+"px";oPanel.Edge[3].style.top=cTop,oPanel.Edge[4].style.top=cTop,oPanel.Edge[5].style.top=cTop}oPanel.DragHandle&&(oPanel.DragHandle.style.height=Math.max(0,oPanel.Height-12)+"px"),Workspace.Touch&&oPanel==Workspace.DragState.Panel&&(Workspace.TouchTool.style.height=Math.max(0,oPanel.Height)+"px"),bResized=!0}if(oPanel.Group&&bUpdateGroup)for(i=0;i<oPanel.Group.length;i++)oPanel.Group[i]!=oPanel&&Workspace.UpdatePanel(oPanel.Group[i],oChange,bShift,!1);if(Editor&&Editor.OnPanelUpdated(oPanel),bResized){var cResizeFunction="PanelResize"+oPanel.Key;void 0!=window[cResizeFunction]&&window[cResizeFunction](oPanel.ContentNode,oPanel.ContentWidth,oPanel.ContentHeight)}},UpdateAllPanels:function(oChange){for(var oPanel,i=0;i<Workspace.Panels.length;i++)oPanel=Workspace.Panels[i],Workspace.UpdatePanel(oPanel,oChange,!1,!1)},Constrain:function(oPanel,oChange){var oOver={Left:Math.min(0,oPanel.Left+oChange.x),Top:Math.min(0,oPanel.Top+oChange.y),Right:Math.max(0,oPanel.Left+oPanel.Node.offsetWidth+oChange.x+oChange.w-Workspace.Width),Bottom:Math.max(0,oPanel.Top+oPanel.Node.offsetHeight+oChange.y+oChange.h-Workspace.Height)};oChange.x-=oChange.x&&oOver.Right?Math.max(oChange.x,oOver.Right):oOver.Left,oChange.y-=oChange.y&&oOver.Bottom?Math.max(oChange.y,oOver.Bottom):oOver.Top,oChange.w-=oOver.Right||oOver.Left?oChange.w:oOver.Right,oChange.h-=oOver.Bottom||oOver.Top?oChange.h:oOver.Bottom},OnKeyDown:function(evt){var oEvent=new EventObj(evt);oEvent.ctrlKey||(oEvent.keyCode!=KEYCODE_SHIFT?oEvent.keyCode==ARROW_UP&&Workspace.ViewPort.Top>Workspace.ViewPort.MinTop?Workspace.Shift("n"):oEvent.keyCode==ARROW_RIGHT&&Workspace.ViewPort.Left<Workspace.ViewPort.MaxLeft?Workspace.Shift("e"):oEvent.keyCode==ARROW_DOWN&&Workspace.ViewPort.Top<Workspace.ViewPort.MaxTop?Workspace.Shift("s"):oEvent.keyCode==ARROW_LEFT&&Workspace.ViewPort.Left>Workspace.ViewPort.MinLeft&&Workspace.Shift("w"):Workspace.SnapState.Snap&&Workspace.UpdateSnapDisplay(null,!0))},OnKeyUp:function(evt){new EventObj(evt).keyCode==KEYCODE_SHIFT&&Workspace.SnapState.Snap&&Workspace.DragState.Panel&&Workspace.UpdateSnapDisplay(Workspace.DragState.Panel)},PositionPanelMap:function(oSize){Workspace.PanelMap&&(Workspace.PanelMap.Node.style.left=oSize.width-Workspace.PanelMap.Width-2+"px")},PositionPanelBar:function(oSize){var oNode=Workspace.PanelBar.Node,iMin=Math.min(oNode.offsetHeight,oNode.offsetWidth),iMax=Math.max(oNode.offsetHeight,oNode.offsetWidth);Workspace.Node.style.marginTop=Workspace.PanelBar.Position==POSITION_TOP?iMin+MAXIMIZE_PAD+"px":"",Workspace.ResizeWidth&&(Workspace.Node.style.marginLeft=Workspace.PanelBar.Position==POSITION_LEFT?iMin+MAXIMIZE_PAD+"px":"",Workspace.Node.style.marginRight=Workspace.PanelBar.Position==POSITION_RIGHT?iMin+MAXIMIZE_PAD+"px":""),Workspace.PanelBar.Position==POSITION_TOP?(Workspace.PanelBar.Left=Math.floor((oSize.width-iMax)/2),Workspace.PanelBar.Top=MAXIMIZE_PAD,oNode.style.width=""):Workspace.PanelBar.Position==POSITION_BOTTOM?(Workspace.PanelBar.Left=Math.floor((oSize.width-iMax)/2),Workspace.PanelBar.Top=oSize.height-iMin-MAXIMIZE_PAD,oNode.style.width=""):Workspace.PanelBar.Position==POSITION_LEFT?(Workspace.PanelBar.Left=MAXIMIZE_PAD,Workspace.PanelBar.Top=Math.floor((oSize.height-iMax)/2),oNode.style.width=iMin+"px"):Workspace.PanelBar.Position==POSITION_RIGHT&&(Workspace.PanelBar.Left=oSize.width-iMin-MAXIMIZE_PAD,Workspace.PanelBar.Top=Math.floor((oSize.height-iMax)/2),oNode.style.width=iMin+"px"),oNode.style.left=Workspace.PanelBar.Left+"px",oNode.style.top=Workspace.PanelBar.Top+"px",oNode.style.visibility="visible"},PositionShiftButtons:function(oSize){Workspace.ShiftButton.North&&(Workspace.ShiftButton.North.style.left=Math.floor(oSize.width/2)-Math.floor(Workspace.ShiftButton.North.offsetWidth/2)+"px",Workspace.ShiftButton.North.style.top="0px"),Workspace.ShiftButton.East&&(Workspace.ShiftButton.East.style.left=oSize.width-Workspace.ShiftButton.East.offsetWidth+"px",Workspace.ShiftButton.East.style.top=Math.floor(oSize.height/2)-Math.floor(Workspace.ShiftButton.East.offsetHeight/2)+"px"),Workspace.ShiftButton.South&&(Workspace.ShiftButton.South.style.left=Math.floor(oSize.width/2)-Math.floor(Workspace.ShiftButton.South.offsetWidth/2)+"px",Workspace.ShiftButton.South.style.top=oSize.height-Workspace.ShiftButton.South.offsetHeight+"px"),Workspace.ShiftButton.West&&(Workspace.ShiftButton.West.style.left="0px",Workspace.ShiftButton.West.style.top=Math.floor(oSize.height/2)-Math.floor(Workspace.ShiftButton.West.offsetHeight/2)+"px")},UpdateShiftButtons:function(){Workspace.ShiftButton.North&&(Workspace.ShiftButton.North.style.visibility=Workspace.ViewPort.Top>Workspace.ViewPort.MinTop?"visible":"hidden"),Workspace.ShiftButton.East&&(Workspace.ShiftButton.East.style.visibility=Workspace.ViewPort.Left<Workspace.ViewPort.MaxLeft?"visible":"hidden"),Workspace.ShiftButton.South&&(Workspace.ShiftButton.South.style.visibility=Workspace.ViewPort.Top<Workspace.ViewPort.MaxTop?"visible":"hidden"),Workspace.ShiftButton.West&&(Workspace.ShiftButton.West.style.visibility=Workspace.ViewPort.Left>Workspace.ViewPort.MinLeft?"visible":"hidden")},DisableSelection:function(oElem){oElem.onselectstart=function(){return!1},oElem.ondragstart=function(){return!1},oElem.unselectable="on",oElem.style.MozUserSelect="none"},MaximizeClear:function(oPanel){if(oPanel.Maximized=!1,oPanel.RestoreRect=null,oPanel.Group)for(var i=0;i<oPanel.Group.length;i++)oPanel.Group[i].Maximized=!1,oPanel.Group[i].RestoreRect=null,oPanel.Group[i].ToggleNode.className="PanelMaximize";else oPanel.ToggleNode.className="PanelMaximize"},Dragging:function(oPanel){return!!Workspace.DragState.Panel&&(Workspace.DragState.Panel==oPanel||!!(Workspace.DragState.Panel.Group&&Workspace.DragState.Panel.Group.indexOf(oPanel)>-1))},DragStart:function(evt){var oEvent=new EventObj(evt);if(oEvent){var oPanel=Workspace.FindPanel(oEvent.srcElement);if(oPanel&&(Workspace.BringForward(oPanel),!Editor||Editor&&Editor.Advanced)){Workspace.DragState.Panel=oPanel;var iEdge=oEvent.srcElement.getAttribute("edge");Workspace.DragState.Type=iEdge?DRAG_RESIZE:DRAG_WANTMOVE,Workspace.DragState.EdgeIndex=iEdge?1*iEdge:null,AddEventHandler(document,"mousemove",Workspace.Drag),AddEventHandler(document,"mouseup",Workspace.DragEnd),Workspace.DragState.StartX=Math.floor(oEvent.clientX),Workspace.DragState.StartY=Math.floor(oEvent.clientY),Workspace.CaptureLayer||Workspace.CreateCaptureLayer(),Workspace.SizeCaptureLayer(),Workspace.CaptureLayer.style.display=""}return oEvent.CancelBubble(!0),oEvent.ReturnValue(!1),!1}},Drag:function(evt){if(Workspace.DragState.Panel&&(evt=evt||window.event))try{var iChangeX=Math.floor(evt.clientX)-Workspace.DragState.StartX,iChangeY=Math.floor(evt.clientY)-Workspace.DragState.StartY,oPanel=Workspace.DragState.Panel;if(Workspace.DragState.Type==DRAG_WANTMOVE)return Math.abs(iChangeX)+Math.abs(iChangeY)>DRAG_MOVE_THRESHOLD&&(Workspace.DragState.Type=DRAG_MOVE),!0;if(Workspace.DragState.Type==DRAG_MOVE)oPanel&&(oPanel.Maximized&&Workspace.TogglePanel(oPanel),evt.ctrlKey&&oPanel.Group&&Workspace.UnMergePanel(oPanel),Workspace.UpdatePanel(oPanel,{x:iChangeX,y:iChangeY,w:0,h:0},!1,!0),Workspace.SnapState.Snap&&Workspace.UpdateSnapDisplay(oPanel,evt.shiftKey));else if(Workspace.DragState.Type==DRAG_RESIZE){var oChange={x:0,y:0,w:0,h:0},iEdge=Workspace.DragState.EdgeIndex;iEdge!=EDGE_NW&&iEdge!=EDGE_N&&iEdge!=EDGE_NE||(oChange.y+=iChangeY,oChange.h-=iChangeY),iEdge!=EDGE_NE&&iEdge!=EDGE_E&&iEdge!=EDGE_SE||(oChange.w+=iChangeX),iEdge!=EDGE_SE&&iEdge!=EDGE_S&&iEdge!=EDGE_SW||(oChange.h+=iChangeY),iEdge!=EDGE_SW&&iEdge!=EDGE_W&&iEdge!=EDGE_NW||(oChange.x+=iChangeX,oChange.w-=iChangeX),Workspace.UpdatePanel(oPanel,oChange,!1,!0),Workspace.SnapState.Snap&&Workspace.UpdateSnapDisplay(oPanel,evt.shiftKey)}Workspace.DragState.StartX=Math.floor(evt.clientX),Workspace.DragState.StartY=Math.floor(evt.clientY)}catch(e){}},DragEnd:function(evt){var oPanel=Workspace.DragState.Panel;if(oPanel){var bMerged=!1;Workspace.DragState.Type==DRAG_MOVE&&evt&&evt.shiftKey&&(bMerged=Workspace.MergePanel(oPanel,null,!0)),bMerged||!Workspace.SnapState.Snap||evt&&evt.shiftKey||Workspace.SnapPanel(oPanel)}RemoveEventHandler(document,"mousemove",Workspace.Drag),RemoveEventHandler(document,"mouseup",Workspace.DragEnd),Workspace.CaptureLayer&&(Workspace.CaptureLayer.style.display="none"),Workspace.DragState.Type=null,Workspace.DragState.Panel=null,Workspace.DragState.EdgeIndex=null,Workspace.ResetSnapState(),Workspace.Node.parentNode.onselectstart=null},ResetSnapState:function(){Workspace.SnapState.Top.Value=null,Workspace.SnapState.Top.Node.style.display="none",Workspace.SnapState.Left.Value=null,Workspace.SnapState.Left.Node.style.display="none",Workspace.SnapState.Right.Value=null,Workspace.SnapState.Right.Node.style.display="none",Workspace.SnapState.Bottom.Value=null,Workspace.SnapState.Bottom.Node.style.display="none"},TouchToolCreate:function(){var oTouchTool=document.createElement("div");oTouchTool.setAttribute("class","TouchTool"),oTouchTool.style.left="0px",oTouchTool.style.top="0px",oTouchTool.style.backgroundColor=Workspace.UIColor,Workspace.TouchTool=oTouchTool;for(var oEdge,aStyle=["right","top","right","bottom","left","bottom","left","top"],i=0;i<8;i+=2)(oEdge=document.createElement("div")).setAttribute("class","TouchEdge"),oEdge.style[aStyle[i]]="0px",oEdge.style[aStyle[i+1]]="0px",oEdge.setAttribute("edge",i+1),oTouchTool.appendChild(oEdge)},TouchStart:function(evt){var oPanel=Workspace.FindPanel(evt.srcElement);oPanel&&(Workspace.BringForward(oPanel),Workspace.DragState.TimerID=setTimeout(Workspace.TouchHighlight,TOUCH_HIGHLIGHTDURATION),Workspace.DragState.Panel=oPanel,AddEventHandler(window,"touchend",Workspace.TouchEnd),evt.preventDefault())},TouchHighlight:function(){Workspace.DragState.TimerID=null,RemoveEventHandler(window,"touchend",Workspace.TouchEnd);var oPanel=Workspace.DragState.Panel;if(oPanel){Workspace.TouchTool||Workspace.TouchToolCreate(),Workspace.TouchTool.parentNode&&(RemoveEventHandler(Workspace.TouchTool,"touchstart",Workspace.TouchDragStart),Workspace.TouchTool.parentNode.removeChild(Workspace.TouchTool)),Workspace.TouchTool.style.width=Math.max(0,oPanel.Width)+"px",Workspace.TouchTool.style.height=Math.max(0,oPanel.Height)+"px",Workspace.TouchTool.style.backgroundImage=oPanel.Behavior&BEHAVIOR_MOVE?"url(/cfr/images/TouchMove.png)":"";for(var bResize=!!(oPanel.Behavior&BEHAVIOR_RESIZE),aEdge=Workspace.TouchTool.getElementsByTagName("DIV"),i=0;i<aEdge.length;i++)aEdge[i].style.display=bResize?"":"none";oPanel.Node.appendChild(Workspace.TouchTool),AddEventHandler(Workspace.TouchTool,"touchstart",Workspace.TouchDragStart)}},TouchEnd:function(evt){Workspace.TouchClear(!1),RemoveEventHandler(window,"touchend",Workspace.TouchEnd)},TouchClear:function(bRemove){Workspace.DragState.TimerID&&clearTimeout(Workspace.DragState.TimerID),Workspace.DragState.TimerID=null,Workspace.DragState.Panel=null,Workspace.DragState.Type=null,Workspace.DragState.EdgeIndex=null,bRemove&&Workspace.TouchTool&&Workspace.TouchTool.parentNode&&(RemoveEventHandler(Workspace.TouchTool,"touchstart",Workspace.TouchDragStart),Workspace.TouchTool.parentNode.removeChild(Workspace.TouchTool))},TouchDragStart:function(evt){evt.preventDefault();var iEdge=evt.srcElement.getAttribute("edge");Workspace.DragState.Type=iEdge?DRAG_RESIZE:DRAG_MOVE,Workspace.DragState.EdgeIndex=iEdge?1*iEdge:null,Workspace.DragState.Touch=new Touch(Workspace.TouchTool,evt.touches[0].pageX,evt.touches[0].pageY,Workspace.TouchMove,Workspace.TouchComplete)},TouchMove:function(oTouch){var oPanel=Workspace.DragState.Panel,oChange={x:0,y:0,w:0,h:0};if(Workspace.DragState.Type==DRAG_MOVE){if(!(oPanel.Behavior&BEHAVIOR_MOVE))return;oChange.x=oTouch.iDeltaX,oChange.y=oTouch.iDeltaY}else if(Workspace.DragState.Type==DRAG_RESIZE){var iEdge=Workspace.DragState.EdgeIndex;iEdge!=EDGE_NW&&iEdge!=EDGE_NE||(oChange.y+=oTouch.iDeltaY,oChange.h-=oTouch.iDeltaY),iEdge!=EDGE_NE&&iEdge!=EDGE_SE||(oChange.w+=oTouch.iDeltaX),iEdge!=EDGE_SE&&iEdge!=EDGE_SW||(oChange.h+=oTouch.iDeltaY),iEdge!=EDGE_SW&&iEdge!=EDGE_NW||(oChange.x+=oTouch.iDeltaX,oChange.w-=oTouch.iDeltaX)}Workspace.UpdatePanel(oPanel,oChange,!1,!0),Workspace.SnapState.Snap&&Workspace.UpdateSnapDisplay(oPanel),oPanel.Maximized&&Workspace.MaximizeClear(oPanel)},TouchComplete:function(oTouch){Workspace.SnapState.Snap&&(Workspace.SnapPanel(Workspace.DragState.Panel),Workspace.ResetSnapState()),oTouch.iDuration<=TOUCH_CLICKDURATION&&Workspace.TouchClear(!0)},SnapPanel:function(oPanel){var oChange={x:0,y:0,w:0,h:0};if(Workspace.DragState.Type==DRAG_MOVE){if(null!=Workspace.SnapState.Top.Value?oChange.y=Workspace.SnapState.Top.Value-oPanel.Top:null!=Workspace.SnapState.Bottom.Value&&(oChange.y=Workspace.SnapState.Bottom.Value-(oPanel.Top+oPanel.Node.offsetHeight)),null!=Workspace.SnapState.Left.Value?oChange.x=Workspace.SnapState.Left.Value-oPanel.Left:null!=Workspace.SnapState.Right.Value&&(oChange.x=Workspace.SnapState.Right.Value-(oPanel.Left+oPanel.Node.offsetWidth)),oChange.x||oChange.y)return Workspace.UpdatePanel(oPanel,oChange,!1,!0),!0}else if(Workspace.DragState.Type==DRAG_RESIZE){var iEdge=Workspace.DragState.EdgeIndex;if(null!=Workspace.SnapState.Top.Value&&[EDGE_NW,EDGE_N,EDGE_NE].indexOf(iEdge)>-1&&(oChange.h=-(Workspace.SnapState.Top.Value-oPanel.Top)),!oChange.h&&null!=Workspace.SnapState.Bottom.Value&&[EDGE_SW,EDGE_S,EDGE_SE].indexOf(iEdge)>-1&&(oChange.h=Workspace.SnapState.Bottom.Value-(oPanel.Top+oPanel.Node.offsetHeight)),null!=Workspace.SnapState.Left.Value&&[EDGE_NW,EDGE_W,EDGE_SW].indexOf(iEdge)>-1&&(oChange.w=-(Workspace.SnapState.Left.Value-oPanel.Left)),!oChange.w&&null!=Workspace.SnapState.Right.Value&&[EDGE_NE,EDGE_E,EDGE_SE].indexOf(iEdge)>-1&&(oChange.w=Workspace.SnapState.Right.Value-(oPanel.Left+oPanel.Node.offsetWidth)),iEdge!=EDGE_NW&&iEdge!=EDGE_N&&iEdge!=EDGE_NE||(oChange.y-=oChange.h),iEdge!=EDGE_SW&&iEdge!=EDGE_W&&iEdge!=EDGE_NW||(oChange.x-=oChange.w),oChange.x||oChange.y||oChange.w||oChange.h)return Workspace.UpdatePanel(oPanel,oChange,!1,!0),!0}return!1},SnapTest:function(oSnapPanel,oPanel){null==Workspace.SnapState.Top.Value&&(Workspace.SnapState.Top.Value=Math.abs(oSnapPanel.Top-oPanel.Top)<=Workspace.SnapThreshold?oPanel.Top:null),null==Workspace.SnapState.Top.Value&&(Workspace.SnapState.Top.Value=Math.abs(oSnapPanel.Top-(oPanel.Top+oPanel.Node.offsetHeight+Workspace.SnapMargin))<=Workspace.SnapThreshold?oPanel.Top+oPanel.Node.offsetHeight+Workspace.SnapMargin:null),null==Workspace.SnapState.Left.Value&&(Workspace.SnapState.Left.Value=Math.abs(oSnapPanel.Left-oPanel.Left)<=Workspace.SnapThreshold?oPanel.Left:null),null==Workspace.SnapState.Left.Value&&(Workspace.SnapState.Left.Value=Math.abs(oSnapPanel.Left-(oPanel.Left+oPanel.Node.offsetWidth+Workspace.SnapMargin))<=Workspace.SnapThreshold?oPanel.Left+oPanel.Node.offsetWidth+Workspace.SnapMargin:null),null==Workspace.SnapState.Right.Value&&(Workspace.SnapState.Right.Value=Math.abs(oSnapPanel.Left+oSnapPanel.Node.offsetWidth-(oPanel.Left+oPanel.Node.offsetWidth))<=Workspace.SnapThreshold?oPanel.Left+oPanel.Node.offsetWidth:null),null==Workspace.SnapState.Right.Value&&(Workspace.SnapState.Right.Value=Math.abs(oSnapPanel.Left+oSnapPanel.Node.offsetWidth-(oPanel.Left-Workspace.SnapMargin))<=Workspace.SnapThreshold?oPanel.Left-Workspace.SnapMargin:null),null==Workspace.SnapState.Bottom.Value&&(Workspace.SnapState.Bottom.Value=Math.abs(oSnapPanel.Top+oSnapPanel.Node.offsetHeight-(oPanel.Top+oPanel.Node.offsetHeight))<=Workspace.SnapThreshold?oPanel.Top+oPanel.Node.offsetHeight:null),null==Workspace.SnapState.Bottom.Value&&(Workspace.SnapState.Bottom.Value=Math.abs(oSnapPanel.Top+oSnapPanel.Node.offsetHeight-(oPanel.Top-Workspace.SnapMargin))<=Workspace.SnapThreshold?oPanel.Top-Workspace.SnapMargin:null)},UpdateSnapDisplay:function(oSnapPanel,bDisable){if(bDisable)return Workspace.SnapState.Top.Node.style.display="none",Workspace.SnapState.Left.Node.style.display="none",Workspace.SnapState.Right.Node.style.display="none",void(Workspace.SnapState.Bottom.Node.style.display="none");if(Workspace.SnapState.Top.Value=Math.abs(oSnapPanel.Top-Workspace.SnapMargin)<=Workspace.SnapThreshold?Workspace.SnapMargin:null,Workspace.SnapState.Left.Value=Math.abs(oSnapPanel.Left-Workspace.SnapMargin)<=Workspace.SnapThreshold?Workspace.SnapMargin:null,Workspace.SnapState.Right.Value=Math.abs(oSnapPanel.Left+oSnapPanel.Node.offsetWidth-(Workspace.Width-Workspace.SnapMargin))<=Workspace.SnapThreshold?Workspace.Width-Workspace.SnapMargin:null,Workspace.SnapState.Bottom.Value=Math.abs(oSnapPanel.Top+oSnapPanel.Node.offsetHeight-(Workspace.Height-Workspace.SnapMargin))<=Workspace.SnapThreshold?Workspace.Height-Workspace.SnapMargin:null,Editor||Workspace.Touch)for(var oPanel,i=0;i<Workspace.Panels.length;i++)oSnapPanel==(oPanel=Workspace.Panels[i])||oSnapPanel.Layer!=oPanel.Layer||!oPanel.Active||oPanel.Maximized||oPanel.Closed||oSnapPanel.Group&&(!oSnapPanel.Group||-1!=oSnapPanel.Group.indexOf(oPanel))||Workspace.SnapTest(oSnapPanel,oPanel);var oNode;null!=Workspace.SnapState.Top.Value?((oNode=Workspace.SnapState.Top.Node).style.left=(oSnapPanel.Node.offsetWidth-31)/2+oSnapPanel.Left+"px",oNode.style.top=Workspace.SnapState.Top.Value-6+"px",oNode.style.display=""):Workspace.SnapState.Top.Node.style.display="none",null!=Workspace.SnapState.Left.Value?((oNode=Workspace.SnapState.Left.Node).style.left=Workspace.SnapState.Left.Value-6+"px",oNode.style.top=(oSnapPanel.Node.offsetHeight-31)/2+oSnapPanel.Top+"px",oNode.style.display=""):Workspace.SnapState.Left.Node.style.display="none",null!=Workspace.SnapState.Right.Value?((oNode=Workspace.SnapState.Right.Node).style.left=Workspace.SnapState.Right.Value+"px",oNode.style.top=(oSnapPanel.Node.offsetHeight-31)/2+oSnapPanel.Top+"px",oNode.style.display=""):Workspace.SnapState.Right.Node.style.display="none",null!=Workspace.SnapState.Bottom.Value?((oNode=Workspace.SnapState.Bottom.Node).style.left=(oSnapPanel.Node.offsetWidth-31)/2+oSnapPanel.Left+"px",oNode.style.top=Workspace.SnapState.Bottom.Value+"px",oNode.style.display=""):Workspace.SnapState.Bottom.Node.style.display="none"},OnPanelAction:function(iKey,iAction){var oPanel=Workspace.FindPanel(null,iKey);oPanel&&(0==iAction?(oPanel.Maximized||(Workspace.BringForward(oPanel),Workspace.TogglePanel(oPanel)),oPanel.Closed&&Workspace.RestorePanel(oPanel,!0)):1==iAction?oPanel.Closed?Workspace.RestorePanel(oPanel,!0):(Workspace.BringForward(oPanel),Workspace.Spotlight(oPanel)):2==iAction?(oPanel.Maximized&&(Workspace.BringForward(oPanel),Workspace.TogglePanel(oPanel)),oPanel.Closed&&Workspace.RestorePanel(oPanel,!0)):3==iAction&&(oPanel.Closed||Workspace.PanelCloseClick(null,oPanel,!0)))},Spotlight:function(oPanel){Workspace.SpotlightAnim=[{x:2,y:0,w:0,h:0},{x:-5,y:1,w:0,h:0},{x:6,y:-2,w:0,h:0},{x:-6,y:1,w:0,h:0},{x:3,y:0,w:0,h:0}],Workspace.SpotlightPanel=oPanel,setTimeout("Workspace.SpotlightTick(0)",SPOTLIGHT_TICK)},SpotlightTick:function(iIndex){var oChange=Workspace.SpotlightAnim[iIndex];oChange&&(Workspace.UpdatePanel(Workspace.SpotlightPanel,oChange,!1,!0),++iIndex<Workspace.SpotlightAnim.length?setTimeout("Workspace.SpotlightTick("+iIndex+")",SPOTLIGHT_TICK):(Workspace.SpotlightAnim=[],Workspace.SpotlightPanel=null))},PanelCloseClick:function(evt,oPanel,bDisableTracking){if(!oPanel){var oEvent=new EventObj(evt);oPanel=Workspace.FindPanel(oEvent.srcElement)}if(oPanel)if(oPanel.Group)for(var i=0;i<oPanel.Group.length;i++)Workspace.ClosePanel(oPanel.Group[i],bDisableTracking);else Workspace.ClosePanel(oPanel,bDisableTracking)},ClosePanel:function(oPanel,bDisableTracking){oPanel.Node.style.visibility="hidden",oPanel.Closed=!0},PanelToggleClick:function(evt){var oEvent=new EventObj(evt),oPanel=Workspace.FindPanel(oEvent.srcElement);oPanel&&(Workspace.BringForward(oPanel),Workspace.TogglePanel(oPanel))},TogglePanel:function(oPanel){var oChange;if(oPanel.ToggleNode)if(oPanel.Maximized?(oChange=Workspace.CalcChangeRect(oPanel.GetRect(),oPanel.RestoreRect),oPanel.Maximized=!1,oPanel.RestoreRect=null):(oPanel.RestoreRect=oPanel.GetRect(),oChange=Workspace.CalcChangeRect(oPanel.RestoreRect,Workspace.GetMaximizeRect(oPanel)),oPanel.Maximized=!0),Workspace.UpdatePanel(oPanel,oChange,!1,!0),oPanel.Group)for(var i=0;i<oPanel.Group.length;i++)oPanel.Group[i].Maximized=oPanel.Maximized,oPanel.Group[i].ToggleNode.className="Panel"+(oPanel.Maximized?"Restore":"Maximize"),oPanel.Group[i].RestoreRect=oPanel.RestoreRect;else oPanel.ToggleNode.className="Panel"+(oPanel.Maximized?"Restore":"Maximize")},PanelRestoreClick:function(evt){if(!Workspace.AnimPanel&&!Workspace.ShiftRestorePanel){var oEvent=new EventObj(evt),oPanel=Workspace.FindPanel(null,1*oEvent.srcElement.getAttribute("key"));oPanel&&Workspace.RestorePanel(oPanel)}},RestorePanel:function(oPanel,bDisableTracking){oPanel.Closed&&oPanel.NeedFrameSrc&&(Workspace.SetFrameSrc(oPanel),oPanel.NeedFrameSrc=!1),oPanel.Closed||oPanel!=Workspace.TopPanel?(Workspace.BringForward(oPanel),Workspace.ShiftIntoView(oPanel)&&oPanel.Closed?Workspace.AnimatePanelRestore(oPanel):!oPanel.Closed&&oPanel.Group&&Workspace.ActivateGroupedPanel(oPanel)):oPanel==Workspace.TopPanel&&Workspace.PanelCloseClick(null,oPanel)},RestoreNextPanel:function(){if(Workspace.TopPanel&&Workspace.TopPanel.Closed)Workspace.RestorePanel(Workspace.TopPanel);else{for(var oPanel,aPanels=[],i=0;i<Workspace.Panels.length;i++)oPanel=Workspace.Panels[i],(Editor||oPanel.ThumbNode&&"none"!=oPanel.ThumbNode.style.display)&&aPanels.push(oPanel);if(1==aPanels.length)Workspace.RestorePanel(aPanels[0]);else if(aPanels.length>1){aPanels.sort(Workspace.DisplayOrderSort);var iIndex=Workspace.TopPanel?aPanels.indexOf(Workspace.TopPanel)+1:0;iIndex==aPanels.length&&(iIndex=0),Workspace.RestorePanel(aPanels[iIndex])}}},AnimatePanelRestore:function(oPanel){if(!Workspace.Touch&&Workspace.AnimateRestore){var oDest={x:oPanel.Left,y:oPanel.Top,w:oPanel.Width,h:oPanel.Height};Workspace.AnimList.push(oDest);for(var oStart={x:parseInt(Workspace.PanelBar.Left,10)+oPanel.ThumbNode.offsetLeft,y:parseInt(Workspace.PanelBar.Top,10)+oPanel.ThumbNode.offsetTop,w:oPanel.ThumbNode.offsetWidth,h:oPanel.ThumbNode.offsetHeight},oInc={x:Math.floor((oDest.x-oStart.x)/10),y:Math.floor((oDest.y-oStart.y)/10),w:Math.floor((oDest.w-oStart.w)/10),h:Math.floor((oDest.h-oStart.h)/10)},i=9;i>0;i--)oRect={x:oStart.x+oInc.x*i,y:oStart.y+oInc.y*i,w:oStart.w+oInc.w*i,h:oStart.h+oInc.h*i},Workspace.AnimList.push(oRect)}Workspace.AnimPanel=oPanel,setTimeout(Workspace.AnimTick,ANIM_TICK)},PanelClick:function(evt){var oEvent=new EventObj(evt),oPanel=Workspace.FindPanel(oEvent.srcElement);oPanel&&(oPanel.Layer==LAYER_WORKSPACE&&Workspace.BringForward(oPanel),oPanel.LinkHREF.length&&open(oPanel.LinkHREF,oPanel.LinkTarget))},BringForward:function(oPanel){for(var i=0;i<Workspace.Panels.length;i++)if(Workspace.Panels[i]==oPanel){Workspace.Panels.splice(i,1);break}var iZ;Workspace.Panels.push(oPanel),Workspace.TopPanel=oPanel,Workspace.Touch&&Workspace.DragState.Panel&&Workspace.DragState.Panel!=oPanel&&Workspace.TouchClear(!0);for(i=0;i<Workspace.Panels.length;i++)iZ=Workspace.Panels[i].Layer*FOREGROUND_Z+i,Workspace.Panels[i].Node.style.zIndex=iZ,Workspace.Panels[i].MapNode&&(Workspace.Panels[i].MapNode.style.zIndex=iZ);Editor&&Editor.OnPanelSelected(oPanel)},NudgePanel:function(oPanel,cDir){var oChange={x:0,y:0,w:0,h:0};"n"==cDir?oChange.y=-1:"e"==cDir?oChange.x=1:"s"==cDir?oChange.y=1:"w"==cDir&&(oChange.x=-1),Workspace.UpdatePanel(oPanel,oChange,!1,!0)},FindPanel:function(oNode,iKey){if(iKey)oNode=document.getElementById("Panel"+iKey);else if(oNode)for(;oNode&&void 0!=oNode.className&&-1==oNode.className.indexOf("WorkspacePanel");)oNode=oNode.parentNode;if(oNode)for(var i=0;i<Workspace.Panels.length;i++)if(Workspace.Panels[i].Node==oNode)return Workspace.Panels[i];return null},DisplayOrderSort:function(oPanel1,oPanel2){return oPanel1.DisplayOrder!=oPanel2.DisplayOrder?oPanel1.DisplayOrder>oPanel2.DisplayOrder?1:-1:oPanel1.Title>oPanel2.Title?1:-1},CreateCaptureLayer:function(){Workspace.CaptureLayer&&Workspace.Node.parentNode.removeChild(Workspace.CaptureLayer),Workspace.CaptureLayer=document.createElement("div"),Workspace.CaptureLayer.id="CaptureLayerDiv",Workspace.CaptureLayer.style.position="absolute",Workspace.CaptureLayer.style.zIndex=99,Workspace.CaptureLayer.style.backgroundImage="url(/cfr/images/1x1.gif)",Workspace.CaptureLayer.style.top="0px",Workspace.CaptureLayer.style.left="0px",Workspace.CaptureLayer.style.cursor="move",Workspace.CaptureLayer.style.display="none",Workspace.DisableSelection(Workspace.CaptureLayer),Workspace.Node.parentNode.appendChild(Workspace.CaptureLayer)},SizeCaptureLayer:function(oSize){if(Workspace.CaptureLayer){oSize||(oSize=GetViewSize()),Workspace.CaptureLayer.style.width=Math.max(0,oSize.width)+"px";var oScrollPos=Workspace.GetScrollPos();Workspace.CaptureLayer.style.height=Math.max(0,oSize.height+oScrollPos.y)+"px"}},AnimTick:function(){if(Workspace.AnimList.length){var oRect=Workspace.AnimList.pop();Workspace.AnimLayer.style.left=oRect.x+"px",Workspace.AnimLayer.style.top=oRect.y+"px",Workspace.AnimLayer.style.width=Math.max(0,oRect.w)+"px",Workspace.AnimLayer.style.height=Math.max(0,oRect.h)+"px",Workspace.AnimLayer.style.display="",setTimeout(Workspace.AnimTick,ANIM_TICK)}else{if(Workspace.AnimLayer.style.display="none",Workspace.AnimPanel.Node.style.visibility="visible",Workspace.AnimPanel.Closed=!1,Workspace.AnimPanel.Group)for(var i=0;i<Workspace.AnimPanel.Group.length;i++)Workspace.AnimPanel.Group[i].Closed=!1;Workspace.AnimPanel=null}},PanelMapClick:function(evt){var oEvent=new EventObj(evt);if("PanelMapViewPort"==oEvent.srcElement.className){var iLeftPos=1*oEvent.srcElement.getAttribute("leftpos"),iTopPos=1*oEvent.srcElement.getAttribute("toppos");Workspace.ShiftTo(iLeftPos,iTopPos)}},ShiftTo:function(iLeftPos,iTopPos){if(Workspace.ShiftAnimList.length||Workspace.ShiftRestorePanel)return!1;iLeftPos<Workspace.ViewPort.MinLeft&&(iLeftPos=Workspace.ViewPort.MinLeft),iLeftPos>Workspace.ViewPort.MaxLeft&&(iLeftPos=Workspace.ViewPort.MaxLeft),iTopPos<Workspace.ViewPort.MinTop&&(iTopPos=Workspace.ViewPort.MinTop),iTopPos>Workspace.ViewPort.MaxTop&&(iTopPos=Workspace.ViewPort.MaxTop);var oNode=document.getElementById("PanelMapViewPort_"+Workspace.ViewPort.Left+"_"+Workspace.ViewPort.Top);oNode&&(oNode.className="PanelMapViewPort"),(oNode=document.getElementById("PanelMapViewPort_"+iLeftPos+"_"+iTopPos))&&(oNode.className="PanelMapViewPortActive");var iMoveX,iMoveY,iChangeX=Workspace.Width*(Workspace.ViewPort.Left-iLeftPos),iChangeY=Workspace.Height*(Workspace.ViewPort.Top-iTopPos);if(iChangeX+iChangeY==0)return!1;for(;0!=iChangeX||0!=iChangeY;)iMoveX=1*(iChangeX/2).toFixed(0),iMoveY=1*(iChangeY/2).toFixed(0),oRect={x:iMoveX,y:iMoveY,w:0,h:0},Workspace.ShiftAnimList.push(oRect),iChangeX-=iMoveX,iChangeY-=iMoveY;return Workspace.ViewPort.Left=iLeftPos,Workspace.ViewPort.Top=iTopPos,Workspace.PanelMap&&(Workspace.PanelMap.OffsetX=Math.floor(Math.abs(Workspace.ViewPort.MinLeft-Workspace.ViewPort.Left)*Workspace.Width*PANEL_MAP_SCALE),Workspace.PanelMap.OffsetY=Math.floor(Math.abs(Workspace.ViewPort.MinTop-Workspace.ViewPort.Top)*Workspace.Height*PANEL_MAP_SCALE)),Workspace.UpdateShiftButtons(),setTimeout(Workspace.ShiftTick,50),!0},Shift:function(cDirection){Workspace.ShiftAnimList.length||Workspace.ShiftRestorePanel||("n"==cDirection?Workspace.ShiftTo(Workspace.ViewPort.Left,Workspace.ViewPort.Top-1):"e"==cDirection?Workspace.ShiftTo(Workspace.ViewPort.Left+1,Workspace.ViewPort.Top):"s"==cDirection?Workspace.ShiftTo(Workspace.ViewPort.Left,Workspace.ViewPort.Top+1):"w"==cDirection&&Workspace.ShiftTo(Workspace.ViewPort.Left-1,Workspace.ViewPort.Top))},ShiftIntoView:function(oPanel){if(!(oPanel.Behavior&BEHAVIOR_SHIFT))return!0;var iLeftPos=Math.floor((oPanel.VirtualLeft+Math.floor(oPanel.Width/2))/Workspace.Width),iTopPos=Math.floor((oPanel.VirtualTop+Math.floor(oPanel.Height/2))/Workspace.Height);if((Workspace.ViewPort.Left!=iLeftPos||Workspace.ViewPort.Top!=iTopPos)&&(Workspace.ShiftTo(iLeftPos,iTopPos)&&oPanel.Closed))return Workspace.ShiftRestorePanel=oPanel,!1;return!0},ShiftTick:function(){if(Workspace.ShiftAnimList.length){var oPanel,oRect=Workspace.ShiftAnimList.splice(0,1)[0];Workspace.BackgroundShift&&(Workspace.BackgroundPosition.Left+=oRect.x*PARALLAX_FACTOR,Workspace.BackgroundPosition.Top+=oRect.y*PARALLAX_FACTOR,Workspace.Stylesheet.Rules.body.style.backgroundPosition=Workspace.BackgroundPosition.Left+"px "+Workspace.BackgroundPosition.Top+"px");for(var i=0;i<Workspace.Panels.length;i++)(oPanel=Workspace.Panels[i]).Behavior&BEHAVIOR_SHIFT&&Workspace.UpdatePanel(oPanel,oRect,!0,!1);Workspace.ShiftAnimList.length?setTimeout(Workspace.ShiftTick,50):Workspace.ShiftRestorePanel?(Workspace.AnimatePanelRestore(Workspace.ShiftRestorePanel),Workspace.ShiftRestorePanel=null):Workspace.OnShiftComplete&&Workspace.OnShiftComplete()}},CalcChangeRect:function(oRect1,oRect2){var oChange={x:0,y:0,w:0,h:0};return oChange.x=oRect2.x-oRect1.x,oChange.y=oRect2.y-oRect1.y,oChange.w=oRect2.w-oRect1.w,oChange.h=oRect2.h-oRect1.h,oChange},GetMaximizeRect:function(oPanel){var oSize=GetViewSize();oSize.width-=oPanel.Node.offsetWidth-oPanel.Width,oSize.height-=oPanel.Node.offsetHeight-oPanel.Height;var oNode=Workspace.PanelBar.Node,iPos=Workspace.PanelBar.Position,iHeight=iPos==POSITION_BOTTOM||iPos==POSITION_TOP?oNode.offsetHeight:0,iWidth=iPos==POSITION_LEFT||iPos==POSITION_RIGHT?oNode.offsetWidth:0;return{x:MAXIMIZE_PAD-Workspace.Node.offsetLeft+(iPos==POSITION_LEFT?iWidth:0),y:MAXIMIZE_PAD,w:oSize.width-MAXIMIZE_PAD*(iPos==POSITION_BOTTOM||iPos==POSITION_TOP?2:3)-iWidth,h:oSize.height-MAXIMIZE_PAD*(iPos==POSITION_LEFT||iPos==POSITION_RIGHT?2:3)-iHeight}},GetRootLayerSize:function(){var oLayer=document.getElementById("Workspace");return{width:oLayer.offsetWidth,height:oLayer.offsetHeight}},RemoveChildren:function(oNode,cTagName){for(var i=oNode.childNodes.length-1;i>=0;i--)oNode.childNodes[i].tagName==cTagName&&oNode.removeChild(oNode.childNodes[i])},PanelHitTest:function(iLeft,iTop){for(var oPanel,i=Workspace.Panels.length-1;i>=0;i--)if(!(oPanel=Workspace.Panels[i]).Closed&&"hidden"!=oPanel.Node.style.visibility&&oPanel.Left<iLeft&&oPanel.Left+oPanel.Width>iLeft&&oPanel.Top<iTop&&oPanel.Top+oPanel.Height>iTop)return oPanel;return null},MergeAllowed:function(oPanel1,oPanel2){if(!oPanel1||!oPanel2)return!1;if(!oPanel1.Framed||!oPanel2.Framed)return!1;if(Workspace.Editor)oPanel1.InitBehavior!=oPanel2.InitBehavior&&Workspace.Editor.UpdatePanelBehavior(oPanel1,oPanel2.InitBehavior),oPanel1.MinWidth==oPanel2.MinWidth&&oPanel1.MinHeight==oPanel2.MinHeight||Workspace.Editor.UpdatePanelMinSize(oPanel1,oPanel2.MinWidth,oPanel2.MinHeight);else{if(oPanel1.Behavior!=oPanel2.Behavior)return!1;if(oPanel1.MinWidth!=oPanel2.MinWidth||oPanel1.MinHeight!=oPanel2.MinHeight)return!1}return!0},MergePanel:function(oPanel,oMergeWith,bSync){if(oMergeWith||(oMergeWith=Workspace.PanelHitTest(oPanel.Left,oPanel.Top)),oMergeWith&&Workspace.MergeAllowed(oPanel,oMergeWith)){Workspace.Editor&&(Workspace.Editor.UpdatePanelInitClosed(oPanel,!1),Workspace.Editor.UpdatePanelInitClosed(oMergeWith,!1),bSync&&Workspace.Editor.SyncPanel(oPanel,oMergeWith));var oChange=Workspace.CalcChangeRect(oPanel.GetRect(),oMergeWith.GetRect());Workspace.UpdatePanel(oPanel,oChange,!1,!0);var aGroup=[];oMergeWith.Group?aGroup=aGroup.concat(oMergeWith.Group):aGroup.push(oMergeWith),oPanel.Group?aGroup=aGroup.concat(oPanel.Group):aGroup.push(oPanel);for(var i=0;i<aGroup.length;i++)aGroup[i].Group=aGroup,Editor&&(aGroup[i].Modified=!0);return Workspace.UpdatePanelGroup(aGroup,oPanel),!0}return!1},UnMergePanel:function(oPanel){var aGroup=oPanel.Group,iIndex=oPanel.Group.indexOf(oPanel);if(iIndex>-1&&aGroup.splice(iIndex,1),oPanel.Group=null,Editor){oPanel.Modified=!0;for(var i=0;i<aGroup.length;i++)aGroup[i].Group=aGroup,aGroup[i].Modified=!0}aGroup.length>1&&Workspace.UpdatePanelGroup(aGroup,aGroup[0]),Workspace.RemoveChildren(oPanel.TitleNode,"P"),Workspace.RemoveChildren(oPanel.TitleNode,"IMG");var oTitle=document.createElement(0==oPanel.TitleType?"p":"img");oTitle.className="PanelTitle",0==oPanel.TitleType?oTitle.appendChild(document.createTextNode(oPanel.Title)):(oTitle.setAttribute("title",oPanel.Title),oTitle.setAttribute("src",oPanel.ThumbURL)),oPanel.TitleNode.appendChild(oTitle),oPanel.Node.style.visibility="visible",1==aGroup.length&&(oPanel=aGroup[0],Workspace.UnMergePanel(oPanel),oPanel.Node.style.visibility="visible")},UpdatePanelGroup:function(aGroup,oActivePanel){for(var oPanel,i=0;i<aGroup.length;i++)(oPanel=aGroup[i]).Node.style.visibility=oPanel!=oActivePanel||oPanel.Closed?"hidden":"visible",Workspace.UpdatePanelGroupTabs(oPanel)},UpdatePanelGroupTabs:function(oPanel){var oTab,oGroupedPanel;Workspace.RemoveChildren(oPanel.TitleNode,"P"),Workspace.RemoveChildren(oPanel.TitleNode,"IMG");for(var i=0;i<oPanel.Group.length;i++)oGroupedPanel=oPanel.Group[i],(oTab=document.createElement(0==oPanel.TitleType?"p":"img")).className="PanelGroupTab"+(oGroupedPanel==oPanel?"Active":""),0==oPanel.TitleType?oTab.appendChild(document.createTextNode(oGroupedPanel.Title)):(oTab.setAttribute("title",oGroupedPanel.Title),oTab.setAttribute("src",oGroupedPanel.ThumbURL)),oTab.setAttribute("key",oGroupedPanel.Key),oPanel.TitleNode.appendChild(oTab),oGroupedPanel!=oPanel&&AddEventHandler(oTab,Workspace.Touch?"touchstart":"mousedown",Workspace.GroupTabClick),oGroupedPanel.Active||(Editor?oTab.style.opacity=".3":oTab.style.display="none")},GroupTabClick:function(evt){var oEvent=new EventObj(evt),oPanel=Workspace.FindPanel(null,1*oEvent.srcElement.getAttribute("key"));return oPanel&&Workspace.ActivateGroupedPanel(oPanel),oEvent.CancelBubble(!0),oEvent.ReturnValue(!1),!1},ActivateGroupedPanel:function(oPanel){if(oPanel.Group)for(var i=0;i<oPanel.Group.length;i++)oPanel.Group[i].Node.style.visibility="hidden";oPanel.Node.style.visibility="visible",Workspace.BringForward(oPanel)},RestoreInitialState:function(){Workspace.Touch&&Workspace.TouchClear(!0),Workspace.ViewPort.Left||Workspace.ViewPort.Top?(Workspace.ShiftTo(0,0),Workspace.OnShiftComplete=Workspace.RestorePanels):Workspace.RestorePanels()},RestorePanels:function(){var oPanel,oChange;Workspace.OnShiftComplete=null,Workspace.Panels.sort(Workspace.InitialStateSort);for(var i=0;i<Workspace.Panels.length;i++)((oPanel=Workspace.Panels[i]).Layer||Editor)&&(oPanel.Group&&Workspace.UnMergePanel(oPanel),oChange=Workspace.CalcChangeRect(oPanel.GetRect(),oPanel.InitialState),Workspace.UpdatePanel(oPanel,oChange,!1,!1),oPanel.Node.style.zIndex=oPanel.InitialState.z,oPanel.Closed=oPanel.InitialState.c,oPanel.Node.style.visibility=oPanel.Closed?"hidden":"visible",oPanel.Maximized&&(oPanel.Maximized=!1,oPanel.ToggleNode.className="PanelMaximize"));var iWidthChange=Workspace.Width-Workspace.InitialSize.Width,iHeightChange=Workspace.Height-Workspace.InitialSize.Height;for(i=0;i<Workspace.Panels.length;i++)((oPanel=Workspace.Panels[i]).Layer||Editor)&&(oChange={x:0,y:0,w:0,h:0},oPanel.Behavior&BEHAVIOR_ONRESIZE_L&&(oChange.x=iWidthChange),oPanel.Behavior&BEHAVIOR_ONRESIZE_T&&(oChange.y=iHeightChange),oPanel.Behavior&BEHAVIOR_ONRESIZE_W&&(oChange.w=iWidthChange),oPanel.Behavior&BEHAVIOR_ONRESIZE_H&&(oChange.h=iHeightChange),Workspace.UpdatePanel(oPanel,oChange,!1,!1));Workspace.InitializeGroups()},SetLayerDisplay:function(iLayer,bVisible){for(var oPanel,i=0;i<Workspace.Panels.length;i++)(oPanel=Workspace.Panels[i]).Layer==iLayer&&(oPanel.Node.style.display=bVisible?"":"none")},InitialStateSort:function(oPanel1,oPanel2){return oPanel1.InitialState.z>oPanel2.InitialState.z?1:-1},GetBoundingRect:function(){if(!Workspace.Panels.length)return{Left:0,Top:0,Width:Workspace.Width,Height:Workspace.Height};for(var oRect={Left:999999,Top:999999,Width:0,Height:0},i=0;i<Workspace.Panels.length;i++)oPanel=Workspace.Panels[i],oPanel.Left<oRect.Left&&(oRect.Left=oPanel.Left),oPanel.Top<oRect.Top&&(oRect.Top=oPanel.Top),oPanel.Left+oPanel.Width>oRect.Width&&(oRect.Width=oPanel.Left+oPanel.Width),oPanel.Top+oPanel.Height>oRect.Height&&(oRect.Height=oPanel.Top+oPanel.Height);return oRect},GetScrollPos:function(){return"number"==typeof window.pageYOffset?{x:window.pageXOffset,y:window.pageYOffset}:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}:document.body&&(document.body.scrollLeft||document.body.scrollTop)?{x:document.body.scrollLeft,y:document.body.scrollTop}:{x:0,y:0}},BatchHandler:function(aMessage){if(Workspace.TransitionColor)for(var i=aMessage.length-1;i>=0;i--){if(1002==aMessage[i].Type)return;1001==aMessage[i].Type&&setTimeout(Workspace.Transition,10)}},MessageHandler:function(oMessage){Workspace.TransitionColor&&(1001==oMessage.Type?setTimeout(Workspace.Transition,10):1002==oMessage.Type&&setTimeout("Workspace.Transition(true)",10))},Transition:function(bReverse){if(Workspace.TransitionColor)try{Workspace.Initialized?Workspace.Stylesheet.Rules.body.style.backgroundColor=bReverse?Workspace.BackgroundColor:Workspace.TransitionColor:setTimeout("Workspace.Transition("+(bReverse?"true":"false")+")",50)}catch(e){}},LoadScript:function(cScript,fnOnLoad){var oScript=document.createElement("script");oScript.setAttribute("type","text/javascript"),oScript.setAttribute("src","/cfr/scripts/"+cScript),"function"==typeof fnOnLoad&&AddEventHandler(oScript,"load",fnOnLoad),document.getElementsByTagName("head")[0].appendChild(oScript)},OnLoadAutoImage:function(evt){for(var oObj,cSrc,oImage,aImage=document.getElementsByTagName("img"),i=0;i<aImage.length;i++)(cSrc=(oImage=aImage[i]).getAttribute("autosrc"))&&cSrc.length&&(oObj=new AutoImage(cSrc,oImage.parentNode,oImage,!0),Workspace.AutoImages.push(oObj),window[oImage.getAttribute("id").replace("AutoImage","PanelResize")]=oObj.fnContainerResize)}};function GetViewSize(){return"function"==typeof GetWorkspaceViewSize?GetWorkspaceViewSize():GetWindowSize()}var SS={Sheets:{},Init:function(){for(var i=0;i<document.styleSheets.length;i++)this.Sheets[this.GetSheetName(document.styleSheets[i])]=new Sheet(document.styleSheets[i])},FindSheet:function(cHint){for(var cName in SS.Sheets)if(cName.indexOf(cHint)>-1)return this.Sheets[cName];return null},GetSheetName:function(oSheet){if(!oSheet.href)return"tag";var cName=oSheet.href.substr(oSheet.href.lastIndexOf("/")+1);if((cName=cName.replace(".css","")).indexOf("F:")>-1){var iStart=cName.indexOf("F:")+2,iEnd=cName.indexOf("&");cName=cName.substring(iStart,iEnd)}return cName}};function Sheet(oSheet){this.styleSheet=oSheet,this.Rules={};for(var oRules=oSheet.rules?oSheet.rules:oSheet.cssRules,i=0;i<oRules.length;i++)this.Rules[oRules[i].selectorText]=oRules[i]}function Touch(oContainer,iStartX,iStartY,fnOnMove,fnOnComplete){var _this=this;this.oContainer=oContainer,this.fnOnMove="function"==typeof fnOnMove?fnOnMove:null,this.fnOnComplete="function"==typeof fnOnComplete?fnOnComplete:null,this.iStartX=iStartX,this.iStartY=iStartY,this.oStartTime=new Date,this.iLastX=iStartX,this.iLastY=iStartY,this.iDeltaX=0,this.iDeltaY=0,this.iDistanceX=0,this.iDistanceY=0,this.iDuration=0,this.fnOnTouchMove=function(evt){_this.iDeltaX=evt.touches[0].pageX-_this.iLastX,_this.iDeltaY=evt.touches[0].pageY-_this.iLastY,_this.iLastX=evt.touches[0].pageX,_this.iLastY=evt.touches[0].pageY,_this.iDistanceX=evt.touches[0].pageX-_this.iStartX,_this.iDistanceY=evt.touches[0].pageY-_this.iStartY,_this.iDuration=new Date-_this.oStartTime,_this.fnOnMove&&_this.fnOnMove(_this),evt.preventDefault()},this.fnOnTouchEnd=function(evt){_this.iDuration=new Date-_this.oStartTime,RemoveEventHandler(_this.oContainer,"touchmove",_this.fnOnTouchMove),RemoveEventHandler(_this.oContainer,"touchend",_this.fnOnTouchEnd),_this.fnOnComplete&&_this.fnOnComplete(_this)},AddEventHandler(oContainer,"touchmove",this.fnOnTouchMove),AddEventHandler(oContainer,"touchend",this.fnOnTouchEnd)}Sheet.prototype.CloneRules=function(cMatch,cReplace){for(var cName in this.Rules)cName.indexOf(cMatch)>-1&&this.styleSheet.insertRule(this.Rules[cName].cssText.replace(cMatch,cReplace),0)},SS.Init(),window.IMQ&&window.IMQ.Attach(Workspace.BatchHandler,Workspace.MessageHandler);