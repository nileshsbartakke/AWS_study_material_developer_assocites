function Scrolly(){var m_oContent,m_aoElements,m_oHiddenTop,m_oVisibleSpace,m_oHiddenBottom,m_iVisibleStartingIndex,m_oLastPageSize,m_fnSort,m_oSparsedHeightCacl,_this=this,m_iHiddenTopHeight=0,m_iHiddenBottomHeight=0,m_iVisibleCount=30,m_iLoadMode=Scrolly.LoadModes.DELAYED,m_iScrollTop=0,m_iTimeout=null,m_bAutoChildrenSize=!1;function onContentScroll(oEvent){var iScrollTop=m_oContent.scrollTop;if(Math.abs(iScrollTop-m_iScrollTop)>=_this.defaultRowHeight)switch(_this.loadMode){case Scrolly.LoadModes.INSTANT:onScrollTimeoutHelper(-1);break;default:m_iTimeout&&clearTimeout(m_iTimeout),m_iTimeout=setTimeout(onScrollTimeoutHelper,20,-1)}}function onScrollTimeoutHelper(iIndex){RequestAnimationFrame()(function(){rebalanceVisibleSpace(-1)}),m_iTimeout=null}function getIndexRelativeToScrollPosition(iScrollTop){var iIndex=m_oSparsedHeightCacl.getIndexNear(iScrollTop);return iIndex=Math.max(parseInt(iIndex-m_iVisibleCount/4),0),iIndex=Math.min(iIndex,Math.max(m_aoElements.length-m_iVisibleCount,0))}function rebalanceVisibleSpace(iStartingIndex){var iIndex,oData,iHeight,iStartScrollTop=m_oContent.scrollTop;m_oContent.scrollHeight;if(iStartingIndex<0&&(iStartingIndex=getIndexRelativeToScrollPosition(iStartScrollTop)),m_iVisibleStartingIndex!=iStartingIndex){for(;m_oVisibleSpace.children.length&&m_oVisibleSpace.children[0]!=m_aoElements[iStartingIndex].element;)m_oVisibleSpace.removeChild(m_oVisibleSpace.children[0]);m_iVisibleStartingIndex=iStartingIndex}iIndex=m_iVisibleStartingIndex;for(var iDefaultHeight=_this.defaultRowHeight;m_oVisibleSpace.children.length<m_iVisibleCount&&iIndex<m_aoElements.length;)oData=m_aoElements[iIndex],m_oVisibleSpace.appendChild(oData.element),m_bAutoChildrenSize&&m_oSparsedHeightCacl.getSelfValueAt(iIndex)==iDefaultHeight&&(iHeight=oData.element.offsetHeight)!=m_oSparsedHeightCacl.getSelfValueAt(iIndex)&&m_oSparsedHeightCacl.setAt(iIndex,iHeight),iIndex++;if(iIndex=getIndexRelativeToScrollPosition(iStartScrollTop),Math.abs(iStartingIndex-iIndex)>5)m_oVisibleSpace.innerHTML="",rebalanceVisibleSpace(iIndex);else{m_iHiddenTopHeight=m_oSparsedHeightCacl.getAt(iStartingIndex),m_oHiddenTop.style.height=m_iHiddenTopHeight+"px";var iMaxHeight=m_oSparsedHeightCacl.getAt(m_aoElements.length),iHeightAtLastRender=m_oSparsedHeightCacl.getAt(m_iVisibleStartingIndex+m_oVisibleSpace.children.length);m_iHiddenBottomHeight=iMaxHeight-iHeightAtLastRender,m_oHiddenBottom.style.height=m_iHiddenBottomHeight+"px",m_oContent.scrollTop!=iStartScrollTop&&(m_oContent.scrollTop=iStartScrollTop),m_iScrollTop=iStartScrollTop}}function addChildHelper(oWrapper,iIndex){m_oSparsedHeightCacl.setAt(iIndex,oWrapper.height)}this.addChild=function(oElem,iHeight,bInsertSort){var iIndex;if(bInsertSort)iIndex=_this.insertChild(oElem,iHeight);else{var oWrapper={element:oElem,height:iHeight};iIndex=m_aoElements.length,m_aoElements.push(oWrapper),addChildHelper(oWrapper,iIndex)}return iIndex},this.appendChild=function(oElem,iHeight,bInsertSort){var iScrollTop=-1;bInsertSort&&(iScrollTop=m_oContent.scrollTop);var iIndex=_this.addChild(oElem,iHeight,bInsertSort);if(bInsertSort&&iIndex>=m_iVisibleStartingIndex&&iIndex<=m_iVisibleStartingIndex+m_iVisibleCount){var oWrapper=m_aoElements[iIndex];if(iIndex+1<m_aoElements.length){var oNext=m_aoElements[iIndex+1];oNext.element.parentNode==m_oVisibleSpace&&m_oVisibleSpace.insertBefore(oWrapper.element,oNext.element)}else m_oVisibleSpace.appendChild(oWrapper.element);iScrollTop&&(m_oContent.scrollTop=m_iScrollTop=iScrollTop+oWrapper.height)}else m_oVisibleSpace.children.length<m_iVisibleCount?m_oVisibleSpace.appendChild(oElem):(m_iHiddenBottomHeight+=iHeight,m_oHiddenBottom.style.height=m_iHiddenBottomHeight+"px");var iVisibility=Scrolly.Visibility.UNKNOWN;if(iScrollTop>-1){var iTopAtIndex=m_oSparsedHeightCacl.getAt(iIndex);iVisibility=iScrollTop>iTopAtIndex?Scrolly.Visibility.ABOVE_VIEWPORT:iScrollTop+m_oLastPageSize.height>iTopAtIndex?Scrolly.Visibility.IN_VIEWPORT:Scrolly.Visibility.BELOW_VIEWPORT}return iVisibility},this.insertChild=function(oElem,iHeight){var iIndex;if(m_aoElements.length&&m_fnSort){var oWrapper={element:oElem,height:iHeight};iIndex=function insertSortChildHelper(iIndexStart,iIndexEnd,oWrapper){var iIndex=iIndexStart+Math.floor((iIndexEnd-iIndexStart)/2);var iResult=m_fnSort(oWrapper,m_aoElements[iIndex]);iResult<0?iIndex==iIndexStart?(m_aoElements.splice(iIndex,0,oWrapper),addChildHelper(oWrapper,iIndex)):iIndex=insertSortChildHelper(iIndexStart,iIndex,oWrapper):iIndexEnd-iIndex==1?(iIndex+=1,m_aoElements.splice(iIndex,0,oWrapper),addChildHelper(oWrapper,iIndex)):iIndex=insertSortChildHelper(iIndex,iIndexEnd,oWrapper);return iIndex}(0,m_aoElements.length,oWrapper)}else iIndex=_this.addChild(oElem,iHeight);return iIndex},this.removeChild=function(oElem){for(var oData,iLup=0;iLup<m_aoElements.length;iLup++)if((oData=m_aoElements[iLup]).element==oElem){oData.element.parentNode==m_oVisibleSpace&&m_oVisibleSpace.removeChild(oData.element),m_aoElements.splice(iLup,1);break}},this.removeChildAt=function(iIndex){if(iIndex>-1&&iIndex<m_aoElements.length){var oData=m_aoElements[iIndex];m_oVisibleSpace==oData.element.parentNode&&m_oVisibleSpace.removeChild(oData.element),m_aoElements.splice(iIndex,1)}},this.getChildAt=function(iIndex){return m_aoElements[iIndex].element},this.removeAllChildren=function(){m_oHiddenTop.style.height="0px",m_oVisibleSpace.innerHTML="",m_oHiddenBottom.style.height="0px",m_iHiddenTopHeight=0,m_iHiddenBottomHeight=0,m_aoElements=[]},this.indexOf=function(oElem){for(var iLup=0;iLup<m_aoElements.length;iLup++)if(m_aoElements[iLup].element==oElem)return iLup;return-1},this.containsChild=function(oElem){return oElem.parentNode==m_oVisibleSpace||_this.indexOf(oElem)>-1},this.sortChildren=function(fnSort,bRebalance){fnSort&&(m_fnSort=function(oA,oB){return this(oA.element,oB.element)}.bind(fnSort),m_aoElements.sort(m_fnSort)),bRebalance&&(m_oVisibleSpace.innerHTML="",rebalanceVisibleSpace(0))},this.scrollIntoView=function(oElem){var iIndex=_this.indexOf(oElem);_this.scrollTo(iIndex)},this.scrollTo=function(iIndex){iIndex<m_iVisibleStartingIndex||iIndex>m_iVisibleStartingIndex+m_iVisibleCount?_this.element.scrollTop=m_oSparsedHeightCacl.getAt(iIndex):m_aoElements[iIndex].element.scrollIntoView({block:"start",behavior:"auto"})},this.setPageSize=function(oSize){oSize.width&&(m_oContent.style.width=oSize.width+"px"),oSize.height&&(m_oContent.style.height=oSize.height+"px"),m_oLastPageSize=oSize},this.redraw=function(iScrollTop){m_oVisibleSpace.innerHTML="",rebalanceVisibleSpace(0),iScrollTop&&(m_oContent.scrollTop=iScrollTop)},this.updateHeightAt=function(iIndex,iHeight){m_oSparsedHeightCacl.setAt(iIndex,iHeight)},Object.defineProperty(this,"defaultRowHeight",{get:function(){return m_oSparsedHeightCacl.data.baseValue},set:function(val){m_oSparsedHeightCacl.data.baseValue=val}}),Object.defineProperty(this,"visibleCount",{get:function(){return m_iVisibleCount},set:function(val){m_iVisibleCount=val}}),Object.defineProperty(this,"loadMode",{get:function(){return m_iLoadMode},set:function(val){m_iLoadMode=val}}),Object.defineProperty(this,"length",{get:function(){return m_aoElements.length}}),Object.defineProperty(this,"autoChildrenSize",{get:function(){return m_bAutoChildrenSize},set:function(val){m_bAutoChildrenSize=val}}),m_aoElements=[],m_iVisibleStartingIndex=0,(m_oSparsedHeightCacl=new SparsedValueArray).configure({baseValue:100}),(m_oContent=document.createElement("div")).style.overflowY="auto",m_oContent.style.overflowX="hidden",m_oContent.style.webkitOverflowScrolling="touch",m_oContent.addEventListener("scroll",onContentScroll),_this.element=m_oContent,m_oHiddenTop=document.createElement("div"),m_oContent.appendChild(m_oHiddenTop),m_oVisibleSpace=document.createElement("div"),m_oContent.appendChild(m_oVisibleSpace),m_oHiddenBottom=document.createElement("div"),m_oContent.appendChild(m_oHiddenBottom)}function SparsedValueArray(){var m_oData,_this=this,m_aoItems=[],m_iLastRealIndex=-1;function createEntryAt(iIndex,iSelfValue){var iValue=0,oEntry=m_aoItems[iIndex-1];oEntry&&(oEntry.value||-1==oEntry.targetIndex)&&oEntry.selfValue&&(iValue=oEntry.value+oEntry.selfValue);for(var iTargetIndex=-1,iLup=iIndex-1;iLup>-1;iLup--)if(m_aoItems[iLup]){iTargetIndex=iLup;break}m_aoItems[iIndex]={targetIndex:iTargetIndex,value:iValue,selfValue:iSelfValue},iIndex>m_iLastRealIndex&&(m_iLastRealIndex=iIndex)}function getValue(iIndex){var iValue=0,oEntry=m_aoItems[iIndex];if(oEntry)if(oEntry.value)iValue=oEntry.value;else if(oEntry.targetIndex>-1){iValue=getValue(oEntry.targetIndex),(oEntry2=m_aoItems[oEntry.targetIndex]).selfValue?iValue+=oEntry2.selfValue+(iIndex-oEntry.targetIndex-1)*_this.data.baseValue:iValue+=(iIndex-oEntry.targetIndex)*_this.data.baseValue}else iValue+=iIndex*_this.data.baseValue;else if(m_iLastRealIndex>-1){for(var iLastIndex=-1,iLup=iIndex-1;iLup>-1;iLup--)if(m_aoItems[iLup]){iLastIndex=iLup;break}if(iLastIndex>-1){var oEntry2;Math.min(iLastIndex);iValue=getValue(iLastIndex),(oEntry2=m_aoItems[iLastIndex]).selfValue?iValue+=oEntry2.selfValue+(iIndex-iLastIndex-1)*_this.data.baseValue:iValue+=(iIndex-iLastIndex)*_this.data.baseValue}else iValue=iIndex*_this.data.baseValue}else iValue=iIndex*_this.data.baseValue;return iValue}function getIndexNearHelper(iValue,iStartIndex,iEndIndex){var iIndex=iStartIndex+parseInt((iEndIndex-iStartIndex)/2),iDiff=_this.getAt(iIndex)-iValue;return iIndex-iStartIndex<2||Math.abs(iDiff)<=_this.data.baseValue?iIndex:iDiff<0?getIndexNearHelper(iValue,iIndex,iEndIndex):getIndexNearHelper(iValue,iStartIndex,iIndex)}_this.configure=function(oData){m_oData=oData},_this.getAt=function(iIndex){return getValue(iIndex)},_this.setAt=function(iIndex,iValue){var iTargetIndex=-1;if(iValue==_this.data.baseValue){if(oEntry=m_aoItems[iIndex]){var oEntry;delete m_aoItems[iIndex];for(var iLup=iIndex-1;iLup>-1;iLup--)if(oEntry=m_aoItems[iLup]){iTargetIndex=iLup;break}for(iLup=iIndex+1;iLup<m_aoItems.length;iLup++)(oEntry=m_aoItems[iLup])&&(oEntry.targetIndex<=iIndex&&(oEntry.targetIndex=iTargetIndex),oEntry.value&&(oEntry.value=0))}}else{var oEntry2,iDelta=iValue;(oEntry=m_aoItems[iIndex])?(iDelta=iValue-oEntry.selfValue,oEntry.selfValue=iValue):(createEntryAt(iIndex,iValue),oEntry=m_aoItems[iIndex]),iTargetIndex=iIndex;for(iLup=iIndex+1;iLup<m_aoItems.length;iLup++)(oEntry2=m_aoItems[iLup])&&(oEntry2.targetIndex<=iIndex&&(oEntry2.targetIndex=iTargetIndex),oEntry2.value?oEntry2.value+=iDelta:oEntry&&oEntry.value&&oEntry.selfValue&&(oEntry2.value=oEntry.value+oEntry.selfValue)),(oEntry=oEntry2)&&(iTargetIndex=iLup)}},_this.getSelfValueAt=function(iIndex){var oEntry=m_aoItems[iIndex];return oEntry?oEntry.selfValue:_this.data.baseValue},_this.getIndexNear=function(iValue){var iIndex=parseInt(iValue/_this.data.baseValue),iDiff=getValue(iIndex)-iValue;return Math.abs(iDiff)>_this.data.baseValue&&(iIndex=iDiff<0?getIndexNearHelper(iValue,iIndex,m_aoItems.length):getIndexNearHelper(iValue,0,iIndex)),iIndex},_this.append=function(iValue){_this.setAt(m_aoItems.length,iValue)},_this.insertAt=function(iIndex,iValue){if(iValue==_this.data.baseValue){m_aoItems.splice(iIndex,0,void 0);for(var iLup=iIndex+1;iLup<m_aoItems.length;iLup++)(oItem=m_aoItems[iLup]).targetIndex<=iIndex&&oItem.targetIndex++,oItem.value&&(oItem.value=0)}else{var oItem;createEntryAt(iIndex,iValue);for(iLup=iIndex+1;iLup<m_aoItems.length;iLup++)(oItem=m_aoItems[iLup]).targetIndex<=iIndex&&oItem.targetIndex++,oItem.value&&(oItem.value+=iValue)}},Object.defineProperty(this,"data",{get:function(){return m_oData},set:function(val){m_oData=val}}),Object.defineProperty(this,"debug",{get:function(){return m_aoItems}})}Scrolly.LoadModes={DELAYED:0,INSTANT:1},Scrolly.Visibility={UNKNOWN:-2,ABOVE_VIEWPORT:-1,IN_VIEWPORT:0,BELOW_VIEWPORT:1};