var g_oStudioManagedChatManager,STUDIOMC_FULL_WIDTH=800,STUDIOMC_MID_WIDTH=600,STUDIOMC_PUBLISH_NO_ANSWER=32,g_aStudioModeratedChatPredefinedMessages=[],g_aChatStaffers=[],MC_PRIO_IGNORE=2,MC_PRIO_LOW=4,MC_PRIO_MED=8,MC_PRIO_HIGH=16,MC_PRIO_PUBLISH=32,MC_MOD_ATT_HEIGHT_OFFSET=78,MC_MOD_ATT_HEIGHT_FILTER_OFFSET=76,MC_MOD_ATT_HEIGHT_FULL_OFFSET=50,MC_ATT_HEIGHT_OFFSET=50,MC_MOD_ATT_THIRD_PANEL_WIDTH=300,MC_MOD_ATT_FOLDER_WIDTH=238,StudioModeratedChatManager=function(m_oData){var m_iLastWidth,m_iLastHeight,_this=this,m_oMainContainer=null,m_bAdmin=!1,m_oDataStore=null,m_iLastDisplayCnt=0,m_iUserDisplayCnt=3,m_aDisplays=[],m_bForceRedraw=!0,m_iToLoad=0,m_oPublisher=null,m_fnOnReady=null,m_oLoadingLayer=null,m_oComponents={FolderLayout:null,ModListLayout:null,AttendeeLayout:null,EditLayout:null,FolderManager:null,DragAndDrop:null,HistoryLayout:null};function LoadJS(cURL){m_iToLoad++;var oScript=document.createElement("script");oScript.src=cURL,oScript.async=!1,document.head.appendChild(oScript),oScript.addEventListener("load",function(evt){--m_iToLoad||function(){for(var iLup=0;iLup<3;iLup++)m_aDisplays.push(new StudioModeratedChatContentDisplay(iLup)),m_oMainContainer.appendChild(m_aDisplays[iLup].Container);m_oDataStore=new StudioModeratedChatDataStore,m_oPublisher=new InxpoPublisher,m_fnOnReady&&m_fnOnReady.apply(_this)}()})}function OnResize(iWidth,iHeight){iWidth&&"undefined"!=iWidth||(iWidth=0),iHeight&&"undefined"!=iHeight||(iHeight=0);var oSizeData={};oSizeData.width=iWidth,oSizeData.height=iHeight-MC_ATT_HEIGHT_OFFSET;var iDisplays=1;if(m_bAdmin&&(iWidth>STUDIOMC_FULL_WIDTH?(iDisplays=Math.min(m_iUserDisplayCnt,3),oSizeData.width=MC_MOD_ATT_THIRD_PANEL_WIDTH,oSizeData.height=iHeight-MC_MOD_ATT_HEIGHT_FULL_OFFSET):iWidth>STUDIOMC_MID_WIDTH?(iDisplays=Math.min(m_iUserDisplayCnt,2),oSizeData.width=iWidth-MC_MOD_ATT_FOLDER_WIDTH,oSizeData.height=iHeight-MC_MOD_ATT_HEIGHT_OFFSET):(iDisplays=1,oSizeData.height=iHeight-MC_MOD_ATT_HEIGHT_OFFSET)),(iDisplays!=m_iLastDisplayCnt||m_bForceRedraw)&&m_aDisplays[2]){if(m_oMainContainer.setAttribute("data-size-mode",iDisplays),m_bForceRedraw=!1,m_aDisplays[0].Active=!0,m_aDisplays[1].Active=!0,m_aDisplays[2].Active=!0,m_oComponents.FolderLayout&&m_oComponents.FolderLayout.Component.Container&&m_aDisplays[0].Content.appendChild(m_oComponents.FolderLayout.Component.Container),m_oComponents.FolderManager&&m_oComponents.FolderManager.Component.Container&&m_aDisplays[0].Content.appendChild(m_oComponents.FolderManager.Component.Container),m_oComponents.ModListLayout&&m_oComponents.ModListLayout.Component.Container){m_aDisplays[1].Content.appendChild(m_oComponents.ModListLayout.Component.Container);var oHeader=m_oComponents.ModListLayout.Component.FilterSuite.HeaderElem;oHeader.innerHTML="";var oMenuRow=document.createElement("div");oMenuRow.className="AxiomModeratedChatNavRow",oHeader.appendChild(oMenuRow);var oMenu=document.createElement("span");oMenu.className="StudioModeratedChatHamburger",oMenu.addEventListener("click",ShowFolderMenu),oMenuRow.appendChild(oMenu);var oCurrentFolder=document.createElement("div");oCurrentFolder.className="StudioModeratedChatFolderName",oCurrentFolder.appendChild(document.createTextNode(_this.Messages.All)),oMenuRow.appendChild(oCurrentFolder);var oLabel=document.createElement("p");oLabel.className="AxiomLabel",oLabel.appendChild(document.createTextNode(_this.Messages.StafferView)),oHeader.appendChild(oLabel)}m_oComponents.AttendeeLayout&&m_oComponents.AttendeeLayout.Component.Container&&(m_oComponents.AttendeeLayout.Component.Container.parentNode||(m_aDisplays[2].Content.appendChild(m_oComponents.AttendeeLayout.Component.Container),m_aDisplays[2].RegisterComponent(m_oComponents.AttendeeLayout.Component),m_oComponents.AttendeeLayout.Component.OnActiveChange=m_aDisplays[2].CheckComponentsActive),m_aDisplays[2].Active&&m_oComponents.AttendeeLayout.Component.OnResize(oSizeData)),m_oComponents.EditLayout&&m_oComponents.EditLayout.Component.Container&&(m_oComponents.EditLayout.Component.Container.parentNode||(m_aDisplays[2].Content.appendChild(m_oComponents.EditLayout.Component.Container),m_aDisplays[2].RegisterComponent(m_oComponents.EditLayout.Component),m_oComponents.EditLayout.Component.OnActiveChange=m_aDisplays[2].CheckComponentsActive)),m_oComponents.HistoryLayout&&m_oComponents.HistoryLayout.Component.Container&&(m_oComponents.HistoryLayout.Component.Container.parentNode||(m_aDisplays[2].Content.appendChild(m_oComponents.HistoryLayout.Component.Container),m_aDisplays[2].RegisterComponent(m_oComponents.HistoryLayout.Component),m_oComponents.HistoryLayout.Component.OnActiveChange=m_aDisplays[2].CheckComponentsActive)),m_oComponents.DragAndDrop&&(m_oComponents.DragAndDrop.Component.Active=1!=iDisplays),m_aDisplays[2].CheckComponentsActive(),m_iLastDisplayCnt=iDisplays}else m_aDisplays[2]&&m_aDisplays[2].Active&&m_oComponents.AttendeeLayout.Component.OnResize(oSizeData)}function StudioModeratedChatContentDisplay(m_cDisplayID){var m_oContainer=null,m_oContent=null,m_bActive=!1,m_aComponents=[];Object.defineProperties(this,{Container:{get:function(){return m_oContainer}},Active:{set:function(bActive){"boolean"==typeof bActive&&(m_bActive=bActive,m_oContainer.setAttribute("data-active",bActive?1:0))},get:function(){return m_bActive}},Content:{get:function(){return m_oContent}}}),this.RegisterComponent=function(oComponent){oComponent&&m_aComponents.push(oComponent)},this.CheckComponentsActive=function(){m_aComponents.some(function(oComponent){return oComponent.Active})?m_oContent.setAttribute("data-active",1):m_oContent.setAttribute("data-active",0)},(m_oContainer=document.createElement("div")).className="StudioModeratedChatContent",m_oContainer.setAttribute("data-active",0),null!=m_cDisplayID&&""!==m_cDisplayID&&void 0!==m_cDisplayID&&(m_oContainer.setAttribute("id","SMCContent"+m_cDisplayID),m_oContainer.setAttribute("data-display-id",m_cDisplayID)),(m_oContent=document.createElement("div")).className="StudioModeratedChatContentView",m_oContent.setAttribute("data-active",0),m_oContainer.appendChild(m_oContent)}function ShowFolderMenu(){m_oComponents.FolderLayout.Component.Active=!0,2==m_iLastDisplayCnt&&setTimeout(function(){window.addEventListener("click",HandleFolderListWindowClick)},0)}function HandleFolderListWindowClick(evt){var oSrc=evt.target;_this.Components.FolderLayout.Component.Container.contains(oSrc)||(m_oComponents.FolderLayout.Component.Active=!1,window.removeEventListener("click",HandleFolderListWindowClick))}function AnswerQuestionOnComplete(oJSON){if(oJSON&&0==oJSON.Status&&oJSON.ResultSet[0]){var oResponse=oJSON.ResultSet[0][0];_this.ProcessAnswerSaveAttResponse(oResponse)}}Object.defineProperties(this,{Container:{get:function(){return m_oMainContainer}},element:{get:function(){return m_oMainContainer}},DataStore:{get:function(){return m_oDataStore}},Components:{get:function(){return m_oComponents}},Publisher:{get:function(){return m_oPublisher}},UserData:{get:function(){return m_oData.UserData}},LASData:{get:function(){return m_oData.LASData}},Messages:{get:function(){return m_oData.Messages}},Moderators:{get:function(){return m_oData.Moderators}},IsAdmin:{get:function(){return m_bAdmin}},OnReady:{set:function(fnOnReady){m_fnOnReady="function"==typeof fnOnReady?fnOnReady:null}}}),this.ShowLoadingLayer=function(bShow,oContainer){if(!m_oLoadingLayer){(m_oLoadingLayer=document.createElement("div")).className="StudioModeratedChatLoadingBGLayer";var oAxiomLoader=document.createElement("div");oAxiomLoader.className="AxiomLoadingAnimation",m_oLoadingLayer.appendChild(oAxiomLoader)}oContainer||(oContainer=m_oMainContainer.parentNode),bShow&&oContainer?oContainer.appendChild(m_oLoadingLayer):oContainer&&m_oLoadingLayer.parentNode==oContainer&&oContainer.removeChild(m_oLoadingLayer)},this.LoadLayout=function(){m_fnLoadLayout&&m_fnLoadLayout.apply(_this)},this.AddComponent=function(cComponent,oComponent){if(Object.keys(m_oComponents).indexOf(cComponent)>-1){if(m_oComponents[cComponent])for(var iLup=0;iLup<m_oComponents[cComponent].Subscribers.length;iLup++)m_oDataStore.Publisher.Unsubscribe(m_oComponents[cComponent].Subscribers[iLup]);var oSubscriber;m_oComponents[cComponent]={Component:oComponent,Subscribers:[]},oComponent.OnItemAdded&&(oSubscriber=new InxpoSubscriber("ItemAdded",oComponent.OnItemAdded),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnItemRemoved&&(oSubscriber=new InxpoSubscriber("ItemRemoved",oComponent.OnItemRemoved),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnModeratorNodeUpdated&&(oSubscriber=new InxpoSubscriber("ModeratorNodeUpdated",oComponent.OnModeratorNodeUpdated),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnAttendeeNodeUpdated&&(oSubscriber=new InxpoSubscriber("AttendeeNodeUpdated",oComponent.OnAttendeeNodeUpdated),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnPublishedUpdated&&(oSubscriber=new InxpoSubscriber("PublishedUpdated",oComponent.OnPublishedUpdated),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnChildAdded&&(oSubscriber=new InxpoSubscriber("ChildAdded",oComponent.OnChildAdded),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnChildRemoved&&(oSubscriber=new InxpoSubscriber("ChildRemoved",oComponent.OnChildRemoved),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnTagRemoved&&(oSubscriber=new InxpoSubscriber("TagRemoved",oComponent.OnTagRemoved),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnTagAdded&&(oSubscriber=new InxpoSubscriber("TagAdded",oComponent.OnTagAdded),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),oComponent.OnPriorityUpdated&&(oSubscriber=new InxpoSubscriber("PriorityUpdated",oComponent.OnPriorityUpdated),m_oComponents[cComponent].Subscribers.push(oSubscriber),m_oDataStore.Publisher.Subscribe(oSubscriber)),m_bForceRedraw=!0,OnResize(m_iLastWidth,m_iLastHeight)}},this.AddData=function(oData){return _this.DataStore.AddMessageData(oData)},this.RemoveData=function(iKey){return _this.DataStore.RemoveMessageData(iKey)},this.OnResize=function(iWidth,iHeight){iWidth&&"number"==typeof iWidth&&(m_iLastWidth=iWidth),iHeight&&"number"==typeof iHeight&&(m_iLastHeight=iHeight),OnResize(m_iLastWidth,m_iLastHeight)},this.SetPageSize=function(oSize){_this.OnResize(oSize.width,oSize.height)},this.ModeratorRow=function(oChat){return _this.IsAdmin?StudioModeratedChatModeratorRow3(oChat):null},this.AttendeeRow=function(oChat){return _this.IsAdmin?StudioModeratedChatAttendeeViewModeratorRow(oChat):StudioModeratedChatAttendeeRow(oChat)},this.RedrawModeratorNodes=function(){for(var oSMC,aData=m_oDataStore.GetDataAsArray(),iLup=0;iLup<aData.length;iLup++)(oSMC=aData[iLup]).ModeratorElementData&&oSMC.ModeratorElementData.Element.parentNode?(oSMC.ModeratorElementData=_this.ModeratorRow(oSMC),_this.AttachAdminHandlers(oSMC)):oSMC.ModeratorElementData&&(oSMC.ModeratorElementData=null)},this.QueueQuestion=function(cQuestion,cPriority,iEventQuestionKey){var cParams="LASCmd=AI:"+m_oData.LASData.InstanceID+";F:LBSEXPORT!JSON&SQLID=30305&EventKey="+g_oSettings.EventKey+"&QuestionText="+URLEncode(cQuestion)+"&Priority="+MC_PRIO_MED;new AxiomHTTP(m_oData.LASData.LASFileName,function(oJSON){!function(oJSON,cQuestion,cPriority,iEventQuestionKey,iFilterFlag){if(oJSON&&0==oJSON.Status&&oJSON.ResultSet[0]){var oResponse=oJSON.ResultSet[0][0];oResponse.QuestionText=cQuestion,oResponse.Priority=parseInt(cPriority),oResponse.QuestionKey=oResponse.EventQuestionKey,oResponse.DateAsked=oResponse.QuestionAskedDate,_this.ProcessQueQuestionResponse(oResponse)}}(oJSON,cQuestion,cPriority)},!0,"POST",cParams,null)},this.ProcessQueQuestionResponse=function(oQuestionData){if(!_this.DataStore.GetData(oQuestionData.QuestionKey)){var oChat=new StudioModeratedChat(oQuestionData.QuestionKey,null,oQuestionData.UserKey,oQuestionData.UserType,oQuestionData.UserName,oQuestionData.QuestionText,oQuestionData.DateAsked,oQuestionData.QuestionNumber);oChat.Priority=oQuestionData.Priority,_this.IsAdmin?(oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachModeratorAttendeeHandlers(oChat),oChat.ModeratorElementData=_this.ModeratorRow(oChat),_this.AttachAdminHandlers(oChat)):(oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachAttendeeHandlers(oChat)),_this.AddData(oChat),oChat.AddTag("FOLDER_ALL")}},this.DeleteQuestion=function(){},this.ProcessDeleteQuestionResponse=function(oDeleteResponse){_this.DataStore.RemoveMessageData(oDeleteResponse.EventQuestionKey?oDeleteResponse.EventQuestionKey:oDeleteResponse.QuestionKey)},this.AddAnswerSaveMod=function(){},this.ProcessAnswerSaveModResponse=function(oAnswerData){if(oChat=_this.DataStore.GetData(oAnswerData.AnswerKey))oChat.Text=oAnswerData.AnswerText,oChat.Published=0==oAnswerData.Status,oChat.AttendeeElementData&&(delete oChat.AttendeeElementData,oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.IsAdmin||_this.AttachAttendeeHandlers(oChat));else{var oChat=new StudioModeratedChat(oAnswerData.AnswerKey,oAnswerData.QuestionKey,oAnswerData.UserKey,oAnswerData.UserType,oAnswerData.UserName,oAnswerData.AnswerText,oAnswerData.DateAnswered,0,!0);_this.IsAdmin?(oChat.AttendeeElementData=_this.AttendeeRow(oChat),oChat.ModeratorElementData=_this.ModeratorRow(oChat)):(oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachAttendeeHandlers(oChat)),oChat.Published=0==oAnswerData.Status,_this.AddData(oChat);var oRootQuestion=_this.DataStore.GetData(oAnswerData.QuestionKey);oRootQuestion&&!_this.IsAdmin&&oRootQuestion&&oRootQuestion.UserKey==_this.UserData.UserKey&&_this.Components.AttendeeLayout.Component.SetUserMessage("There is a new answer to one of your questions!",SMC_USER_MESSAGE_FLASH)}},this.AddAnswerSaveAtt=function(iEventQuestionKey,cText,iEventQuestionAnswerKey){var cParams="LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30316&EventKey="+g_oSettings.EventKey+"&EventQuestionKey="+iEventQuestionKey+"&EventQuestionAnswerKey="+(iEventQuestionAnswerKey||0)+"&ReplyToQuestionKey="+iEventQuestionKey+"&AnswerText="+cText;new AxiomHTTP(g_oSettings.LASFileName,AnswerQuestionOnComplete,!0,"POST",cParams,null)},this.ProcessAnswerSaveAttResponse=function(oAnswerData){var oChat=_this.DataStore.GetData(oAnswerData.AnswerKey),oParentChat=_this.DataStore.GetData(oAnswerData.QuestionKey);(oChat?(oChat.Text=oAnswerData.AnswerText,oChat.Published=0==oAnswerData.Status):(oChat=new StudioModeratedChat(oAnswerData.AnswerKey,oAnswerData.QuestionKey,oAnswerData.UserKey,oAnswerData.UserType,oAnswerData.UserName,oAnswerData.AnswerText,oAnswerData.DateAnswered,0,!1),_this.IsAdmin?(oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachModeratorAttendeeHandlers(oChat),oChat.ModeratorElementData=_this.ModeratorRow(oChat)):(oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachAttendeeHandlers(oChat)),oChat.Published=0==oAnswerData.Status,_this.AddData(oChat)),_this.Components.EditLayout&&_this.Components.EditLayout.Component)&&(!_this.Components.EditLayout.Component.CheckForModInEdit(oAnswerData.QuestionKey)&&oParentChat&&(oParentChat.ReadByModerator=!1,oParentChat.ModeratorElementData&&oParentChat.ModeratorElementData.SetNotRead(!0)),_this.Components.ModListLayout.Component&&_this.Components.ModListLayout.Component.OnDataChange(oParentChat))},this.AnswerDelete=function(){},this.ProcessAnswerDeleteResponse=function(oAnswerData){_this.DataStore.RemoveMessageData(oAnswerData.AnswerKey)},this.SetPriority=function(iEventQuestionKey,iPriority){},this.ProcessSetPriorityResponse=function(oPriorityData){var oChat=_this.DataStore.GetData(oPriorityData.EventQuestionKey?oPriorityData.EventQuestionKey:oPriorityData.QuestionKey);oChat&&(oChat.Priority=oPriorityData.Priority)},this.AddFolder=function(iFolderKey,cFolderName,iDisplayOrder,cTagList){},this.ProcessAddFolderResponse=function(oFolderData){var oFolder=new StudioModeratedChatFolder(oFolderData.FolderKey,-1==oFolderData.FolderKey,_this);if(oFolder.Name=oFolderData.FolderName,oFolder.DisplayOrder=oFolderData.DisplayOrder,oFolderData.TagList)for(var aTagList=oFolderData.TagList.split(","),iLup=0;iLup<aTags.length;iLup++)oFolder.AddTag(aTagList[iLup]);0==_this.Components.FolderLayout.Component.GetFolders().length&&(m_bForceRedraw=!0),_this.Components.FolderLayout.Component.AddFolder(oFolder),oFolder.Container.addEventListener("dragenter",m_oComponents.DragAndDrop.Component.OnDragEnter),oFolder.Container.addEventListener("dragleave",m_oComponents.DragAndDrop.Component.OnDragLeave),oFolder.Container.addEventListener("dragover",function(evt){evt.preventDefault()}),oFolder.Container.addEventListener("drop",m_oComponents.DragAndDrop.Component.OnDrop),OnResize(m_iLastWidth,m_iLastHeight),_this.Publisher.Publish("FolderAdded",{Folder:oFolder})},this.UpdateFolder=function(){},this.ProcessUpdateFolderResponse=function(oFolderData){var oFolder=_this.Components.FolderLayout.Component.GetFolder(oFolderData.FolderKey);if(oFolder){var bTriggerEvent=!1;oFolder.Name==oFolderData.FolderName&&oFolder.DisplayOrder==oFolderData.DisplayOrder||(bTriggerEvent=!0),oFolder.Name=oFolderData.FolderName,oFolder.DisplayOrder=oFolderData.DisplayOrder,bTriggerEvent&&_this.Publisher.Publish("FolderUpdated",{Folder:oFolder})}},this.DeleteFolder=function(){},this.ProcessDeleteFolderResponse=function(oFolderData){var oFolder=_this.Components.FolderLayout.Component.GetFolder(oFolderData.FolderKey);oFolder&&(_this.Components.FolderLayout.Component.RemoveFolder(oFolderData.FolderKey),_this.Publisher.Publish("FolderRemoved",{Folder:oFolder}),OnResize(m_iLastWidth,m_iLastHeight))},this.UpdateTags=function(){},this.ProcessUpdateTagsResponse=function(oTagData){if(1==oTagData.Source){var oFolder=_this.Components.FolderLayout.Component.GetFolder(oTagData.KeyVal);if(oFolder){var aCurrentTags=oFolder.GetTags();(aNewTags=oTagData.TagList.split(",")).forEach(function(cTag){aCurrentTags.indexOf(cTag)<0&&oFolder.RemoveTag(cTag);for(var iLup=0;iLup<aNewTags.length;iLup++)oFolder.AddTag(aNewTags[iLup])})}}else{var oChat=_this.DataStore.GetData(oTagData.KeyVal);if(oChat){aCurrentTags=oChat.GetTags();var aNewTags=oTagData.TagList.split(",");aCurrentTags.forEach(function(cTag){aNewTags.indexOf(cTag)<0&&oChat.RemoveTag(cTag)}),_this.Components.ModListLayout&&_this.Components.ModListLayout.Component.OnDataChange(oChat);var aFolders=_this.Components.FolderLayout.Component.GetFolders();aNewTags.forEach(function(cTag){oChat.AddTag(cTag),aFolders.forEach(function(oFolder){if(oFolder.HasTag(cTag)){var oFilterable=new StudioModeratedChatFilterableItem(oChat);oFilterable.Filtered=!1,oFolder.AddItem(oFilterable),oFolder===_this.Components.FolderLayout.Component.CurrentFolder&&_this.Components.FolderLayout.Component.Publisher.Publish("ItemAdded",{Filterable:oFilterable})}})})}}},this.GeneralStatusUpdate=function(){},this.ProcessGeneralStatusResponse=function(oGeneralStatusData){if(_this.Components.EditLayout){var oModeratorData,oChat=_this.DataStore.GetData(oGeneralStatusData.QuestionKey),cName="";for(var cKey in _this.Moderators)if((oModeratorData=_this.Moderators[cKey]).UserKey==oGeneralStatusData.Sender){cName=oModeratorData.Name,oChat&&(oChat.ReadByModerator=!0,oChat.ModeratorElementData?oChat.ModeratorElementData.SetNotRead(!1):(oChat.ModeratorElementData=_this.ModeratorRow(oChat),_this.AttachAdminHandlers(oChat)),1==oGeneralStatusData.Status&&oChat.ModeratorElementData.ShowLocked(!0));break}_this.Components.EditLayout.Component.ModifyEditGroup(1==oGeneralStatusData.Status,oGeneralStatusData.Sender,cName,oGeneralStatusData.QuestionKey),0==oGeneralStatusData.Status&&(_this.Components.EditLayout.Component.CheckForModInEdit(oGeneralStatusData.QuestionKey)||oChat&&oChat.ModeratorElementData&&oChat.ModeratorElementData.ShowLocked(!1)),_this.Components.ModListLayout.Component&&_this.Components.ModListLayout.Component.OnDataChange(oChat)}},this.ProcessStaffUpdateResponse=function(oViewerData){if(oViewerData.UserKey&&0!=(8388608&oViewerData.ModeratorRights)&&!oViewerData.Connected){var iEditQuestionKey=_this.Components.EditLayout.Component.CheckForEditUser(oViewerData.UserKey);iEditQuestionKey&&_this.Components.EditLayout.Component.ModifyEditGroup(!1,oViewerData.UserKey,null,iEditQuestionKey)}},this.AttendeeGetAnswers=function(fnOnComplete){var cURL=m_oData.LASData.LASFileName+"?LASCmd=AI:"+m_oData.LASData.InstanceID+";F:LBSEXPORT!JSON&SQLID=30311&EventKey="+g_oSettings.EventKey;new AxiomHTTP(cURL,function(oJSON){if(oJSON&&oJSON.ResultSet.length>0){for(var oChat,oData,aQuestions=oJSON.ResultSet[0],aAnswers=oJSON.ResultSet[1],iLup=0;iLup<aQuestions.length&&!(oData=aQuestions[iLup]).NoQuestions;iLup++)(oChat=new StudioModeratedChat(oData.QuestionKey,null,oData.UserKey,oData.UserType,oData.UserName,oData.QuestionText,oData.DateAsked,oData.QuestionNumber)).Priority=oData.Priority,oChat.AttendeeElementData=StudioModeratedChatAttendeeRow(oChat),_this.AttachModeratorAttendeeHandlers(oChat),_this.AddData(oChat);for(var iLup=0;iLup<aAnswers.length&&!(oData=aAnswers[iLup]).NoAnswers;iLup++)(oChat=new StudioModeratedChat(oData.AnswerKey,oData.QuestionKey,oData.UserKey,oData.UserType,oData.UserName,oData.AnswerText,oData.DateAnswered,0)).AttendeeElementData=StudioModeratedChatAttendeeRow(oChat),oChat.Published=0==oData.Status,_this.AddData(oChat);this&&this(1)}else this&&this(0)}.bind(fnOnComplete),!0,"GET",null,null)},this.AttachModeratorAttendeeHandlers=function(oSMChat){oSMChat&&(oSMChat.AttendeeElementData.OnClick=function(){_this.Components.EditLayout.Component.LoadChatThread(oSMChat.Key)})},this.AttachAdminHandlers=function(oSMChat){if(oSMChat.ModeratorElementData){if(oSMChat.ModeratorElementData.Element&&oSMChat.ModeratorElementData.Element.addEventListener("click",function(evt){_this.Components.HistoryLayout.Component.Active=!1,evt.ctrlKey||evt.shiftKey||_this.Components.EditLayout.Component.LoadChatThread(oSMChat.Key)}),oSMChat.ModeratorElementData.PriorityElem&&(oSMChat.ModeratorElementData.PriorityElem.AddOption(_this.Messages.Low,""+MC_PRIO_LOW,"#4D5558","#FECF24"),oSMChat.ModeratorElementData.PriorityElem.AddOption(_this.Messages.Medium,""+MC_PRIO_MED,"#4D5558","#FF9D3E"),oSMChat.ModeratorElementData.PriorityElem.AddOption(_this.Messages.High,""+MC_PRIO_HIGH,"#4D5558","#F05B5B"),oSMChat.ModeratorElementData.PriorityElem.Value=oSMChat.Priority&~(MC_PRIO_PUBLISH|MC_PRIO_IGNORE),oSMChat.ModeratorElementData.PriorityElem.OnChange=function(evt){if(evt.preventDefault(),evt.stopPropagation(),!(oSMChat.Priority&parseInt(oSMChat.ModeratorElementData.PriorityElem.Value))){var iPriority=oSMChat.Priority&MC_PRIO_IGNORE;iPriority|=parseInt(oSMChat.ModeratorElementData.PriorityElem.Value),_this.SetPriority(oSMChat.Key,iPriority)}return!1}),oSMChat.ModeratorElementData.FolderSelect){for(var oOption,oFolder,aFolders=_this.Components.FolderLayout.Component.GetFolders(),oFolderSelect=oSMChat.ModeratorElementData.FolderSelect,aTags=oSMChat.GetTags(),iLup=0;iLup<aFolders.length;iLup++){if((oFolder=aFolders[iLup])&&oFolder.IsRoot)(oOption=document.createElement("option")).text=_this.Messages.None,oOption.value=-1,oFolderSelect.appendChild(oOption),1==aTags.length&&oFolder.HasTag(aTags[0])&&(oOption.selected=!0);else{(oOption=document.createElement("option")).text=oFolder.Name,oOption.value=oFolder.Key,oFolderSelect.appendChild(oOption);for(var inLup=0;inLup<aTags.length;inLup++)if(oFolder.HasTag(aTags[inLup])){oOption.selected=!0;break}}oFolderSelect.appendChild(oOption)}oFolderSelect.addEventListener("change",function(evt){var oFolder=_this.Components.FolderLayout.Component.GetFolder(oFolderSelect.value),aItemTags=oSMChat.GetTags();if(oFolder){if(oFolder&&oFolder.IsRoot)RemoveFromExtraFolders(aItemTags);else{if(aItemTags.some(function(cTag){return oFolder.HasTag(cTag)}))return;RemoveFromExtraFolders(aItemTags)}var cFolderTag=oFolder.GetFolderTag();_this.UpdateTags(2,oSMChat.Key,cFolderTag)}});var oSubscriberAdd=new InxpoSubscriber("TagAdded",function(oCustomEventObj){_this.Components.FolderLayout.Component.GetFolders().some(function(oFolder){if(oFolder.HasTag(oCustomEventObj.Tag)){for(var bFound=!1,iLup=0;iLup<oFolderSelect.options.length;iLup++)if(oFolderSelect.options[iLup].value==oFolder.Key)return bFound=!0,oFolderSelect.value=oFolder.Key,!0;bFound||((oOption=document.createElement("option")).text=oFolder.Name,oOption.value=oFolder.Key,oFolderSelect.appendChild(oOption),oFolderSelect.value=oFolder.Key)}return!1})}),oSubscriberRem=new InxpoSubscriber("TagRemoved",function(oCustomEventObj){oFolderSelect.selectedIndex=0});oSMChat.Publisher.Subscribe(oSubscriberAdd),oSMChat.Publisher.Subscribe(oSubscriberRem);var oSubscriberRemFolder=new InxpoSubscriber("FolderRemoved",function(oCustomEventObj){for(var oCurrOpt,iLup=0;iLup<oFolderSelect.options.length;iLup++)if((oCurrOpt=oFolderSelect.options[iLup]).value==oCustomEventObj.Folder.Key){oFolderSelect.selectedIndex==iLup&&(oFolderSelect.selectedIndex=0),oFolderSelect.removeChild(oCurrOpt);break}oSMChat.HasTag(oCustomEventObj.Folder.GetFolderTag())&&_this.UpdateTags(2,oSMChat.Key,"FOLDER_ALL")});_this.Publisher.Subscribe(oSubscriberRemFolder);var oSubscriberUpdateFolder=new InxpoSubscriber("FolderUpdated",function(oCustomEventObj){for(var oCurrOpt,iLup=0;iLup<oFolderSelect.options.length;iLup++)(oCurrOpt=oFolderSelect.options[iLup]).value==oCustomEventObj.Folder.Key&&oFolderSelect.selectedIndex==iLup&&(oCurrOpt.text=oCustomEventObj.Folder.Name)});_this.Publisher.Subscribe(oSubscriberUpdateFolder);var oSubscriberNewFolder=new InxpoSubscriber("FolderAdded",function(oCustomEventObj){var oCurrOpt,bAdded=!1,oNewOpt=document.createElement("option");oNewOpt.text=oCustomEventObj.Folder.Name,oNewOpt.value=oCustomEventObj.Folder.Key;for(var iLup=1;iLup<oFolderSelect.options.length;iLup++)if((oCurrOpt=oFolderSelect.options[iLup]).text.localeCompare(oNewOpt.text)>0){oFolderSelect.insertBefore(oNewOpt,oCurrOpt),bAdded=!0;break}bAdded||oFolderSelect.appendChild(oNewOpt)});function RemoveFromExtraFolders(aItemTags){for(var cItemTag,iLup=0;iLup<aItemTags.length;iLup++)"FOLDER_ALL"!=(cItemTag=aItemTags[iLup])&&oSMChat.RemoveTag(cItemTag)}_this.Publisher.Subscribe(oSubscriberNewFolder)}oSMChat.ModeratorElementData.IgnoreWidget&&(oSMChat.ModeratorElementData.IgnoreWidget.SetPriority=_this.SetPriority)}},this.AttachAttendeeHandlers=function(oSMChat){oSMChat.AttendeeElementData&&oSMChat.AttendeeElementData.Input&&(oSMChat.AttendeeElementData.OnSubmit=function(evt){var cStr;evt.preventDefault(),evt.stopPropagation(),""!=oSMChat.AttendeeElementData.Input.value.replace(/\s/g,"")?(_this.AddAnswerSaveAtt(oSMChat.Key,oSMChat.AttendeeElementData.Input.value,0),oSMChat.AttendeeElementData.Input.value="",cStr=_this.Messages.MessageSent,_this.Components.AttendeeLayout.Component.SetUserMessage(cStr,SMC_USER_MESSAGE_FLASH)):(cStr=_this.Messages.NoEmptyMessage,_this.Components.AttendeeLayout.Component.SetUserMessage(cStr,SMC_USER_MESSAGE_FLASH))})},function(){(m_oMainContainer=document.createElement("div")).className="StudioModeratedChatContentContainer",m_oData||(m_oData={}),m_oData.UserData||(m_oData.UserData={}),m_oData.Messages||(m_oData.Messages={}),m_oData.LASData||(m_oData.LASData={}),m_oData.Moderators||(m_oData.Moderators={}),m_oData.Functions||(m_oData.Functions={}),m_oData.Functions.QueueQuestion&&(_this.QueueQuestion=m_oData.Functions.QueueQuestion),m_oData.Functions.DeleteQuestion&&(_this.DeleteQuestion=m_oData.Functions.DeleteQuestion),m_oData.Functions.AddAnswerSaveMod&&(_this.AddAnswerSaveMod=m_oData.Functions.AddAnswerSaveMod),m_oData.Functions.AddAnswerSaveAtt&&(_this.AddAnswerSaveAtt=m_oData.Functions.AddAnswerSaveAtt),m_oData.Functions.AnswerDelete&&(_this.AnswerDelete=m_oData.Functions.AnswerDelete),m_oData.Functions.SetPriority&&(_this.SetPriority=m_oData.Functions.SetPriority),m_oData.Functions.AddFolder&&(_this.AddFolder=m_oData.Functions.AddFolder),m_oData.Functions.UpdateFolder&&(_this.UpdateFolder=m_oData.Functions.UpdateFolder),m_oData.Functions.DeleteFolder&&(_this.DeleteFolder=m_oData.Functions.DeleteFolder),m_oData.Functions.UpdateTags&&(_this.UpdateTags=m_oData.Functions.UpdateTags),m_oData.Functions.GeneralStatusUpdate&&(_this.GeneralStatusUpdate=m_oData.Functions.GeneralStatusUpdate);var aScripts=[_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatDataStore.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatAttendeeView.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatModeratorFullView.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatWorkerView.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatFolderView.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatItemView.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/StudioModeratedChatFilters.js",_this.LASData.ScriptsDir+"/VTS/Axiom/StudioModeratedChat/AxiomMultiOptionSingleSelect.js",_this.LASData.ScriptsDir+"/VTS/Axiom/Mobile/Scrolly.js",_this.LASData.ScriptsDir+"/VTS/Axiom/Mobile/AutoScrolly.js"];LoadJS(aScripts[0]),LoadJS(aScripts[1]),LoadJS(aScripts[6]),LoadJS(aScripts[8]),LoadJS(aScripts[9]),m_oAttendeeList=null,_this.UserData.ModeratorRights?(8388608&_this.UserData.ModeratorRights)>0&&(m_bAdmin=!0,m_fnOnReady=m_oData.Functions.OnReadyAdmin,LoadJS(aScripts[2]),LoadJS(aScripts[3]),LoadJS(aScripts[4]),LoadJS(aScripts[5]),LoadJS(aScripts[7])):(m_bAdmin=!1,m_fnOnReady=m_oData.Functions.OnReadyAttendee)}()},StudioModeratedChatListDisplay=function(){var m_oContainer,_this=this;Object.defineProperties(this,{Container:{get:function(){return m_oContainer}}}),this.Render=function(aElems){for(;m_oContainer.childNodes.length;)m_oContainer.removeChild(m_oContainer.firstChild);if(aElems.length<51)for(var iLup=0;iLup<aElems.length;iLup++)_this.AddToTail(aElems[iLup]);else{var fnRAF=RequestAnimationFrame(),iIter=(Math.floor(aElems.length/200),0);fnRAF(function PlaceElems(){if(iIter++,0!=aElems.length){for(var iLup=0;iLup<Math.min(200*iIter,aElems.length);iLup++)_this.AddToTail(aElems.pop());fnRAF(PlaceElems)}})}},this.RemoveElem=function(oElem){oElem instanceof Element&&m_oContainer.contains(oElem)&&oElem.parentNode.removeChild(oElem)},this.AddToHead=function(oElem){m_oContainer.childElementCount?m_oContainer.insertBefore(oElem,m_oContainer.firstChild):m_oContainer.appendChild(oElem)},this.AddToTail=function(oElem){m_oContainer.appendChild(oElem)},this.RemoveHead=function(){m_oContainer.childElementCount&&m_oContainer.removeChild(m_oContainer.firstChild)},this.RemoveTail=function(){m_oContainer.childElementCount&&m_oContainer.removeChild(m_oContainer.lastChild)},this.ScrollElemIntoView=function(oElem){if(!(!oElem instanceof HTMLElement||oElem.parentNode!=m_oContainer))if(IsElementAboveFold(oElem,m_oContainer))for(;!isElementInViewport(oElem);)m_oContainer.scrollTop--;else for(;!isElementInViewport(oElem);)m_oContainer.scrollTop++},this.ScrollToBottom=function(){m_oContainer.scrollTop=m_oContainer.scrollHeight},(m_oContainer=document.createElement("div")).className="StudioModeratedChatListContainer"},StudioModeratedRetVal=function(m_bRetVal,m_cMsg){var m_oData;m_cMsg||(m_cMsg=""),m_bRetVal||(m_bRetVal=!1),Object.defineProperties(this,{Msg:{get:function(){return m_cErrorMsg},set:function(cMsg){m_cErrorMsg="string"==typeof cMsg?cMsg:""}},RetVal:{get:function(){return m_bRetVal},set:function(bRetVal){"boolean"==typeof bRetVal&&(m_bRetVal=bRetVal)}},Data:{get:function(){return m_oData},set:function(oData){m_oData=oData}}})},InxpoPublisher=function(){var m_oSubscribers={};this.Subscribe=function(oSubscriberObject){oSubscriberObject instanceof InxpoSubscriber&&(m_oSubscribers[oSubscriberObject.Event]||(m_oSubscribers[oSubscriberObject.Event]=[]),m_oSubscribers[oSubscriberObject.Event].push(oSubscriberObject))},this.Unsubscribe=function(oSubscriberObject){if(oSubscriberObject instanceof InxpoSubscriber){var aSubscribers=m_oSubscribers[oSubscriberObject.Event];if(!aSubscribers)return;for(var iLup=0;iLup<aSubscribers.length;iLup++)if(aSubscribers[iLup]===oSubscriberObject){aSubscribers.splice(iLup,1);break}}},this.Publish=function(cEvent,oData){if(String(cEvent)){var aSubscribers=m_oSubscribers[String(cEvent)];if(aSubscribers)for(var iLup=0;iLup<aSubscribers.length;iLup++)aSubscribers[iLup].Signal(oData)}}},InxpoSubscriber=function(cEventName,m_fnSignalCB){if("function"!=typeof m_fnSignalCB)return null;if(!String(cEventName))return null;Object.defineProperty(this,"Event",{get:function(){return cEventName}}),this.Signal=function(oData){m_fnSignalCB(oData)}};function StudioModeratedChatLoadAdmin(){var _this=this;g_oAxiomCommManager&&(g_oAxiomCommManager.SetQuestionDeleteHandler(g_cSocketName,{call:_this.ProcessDeleteQuestionResponse}),g_oAxiomCommManager.SetGeneralStatusHandler(g_cSocketName,{call:_this.ProcessGeneralStatusResponse}),g_oAxiomCommManager.SetAnswerSaveModHandler(g_cSocketName,{call:_this.ProcessAnswerSaveModResponse}),g_oAxiomCommManager.SetAnswerSaveAttHandler(g_cSocketName,{call:_this.ProcessAnswerSaveAttResponse}),g_oAxiomCommManager.SetAnswerDeleteHandler(g_cSocketName,{call:_this.ProcessAnswerDeleteResponse}),g_oAxiomCommManager.SetFolderUpdateHandler(g_cSocketName,{call:_this.ProcessUpdateFolderResponse}),g_oAxiomCommManager.SetFolderDeleteHandler(g_cSocketName,{call:_this.ProcessDeleteFolderResponse}),g_oAxiomCommManager.SetStaffUpdateHandler(g_cSocketName,{call:_this.ProcessStaffUpdateResponse}),g_oAxiomCommManager.SetQuestionPriorityHandler(g_cSocketName,{call:_this.ProcessSetPriorityResponse}),g_oAxiomCommManager.SetQuestionSaveHandler(g_cSocketName,{call:_this.ProcessQueQuestionResponse}),g_oAxiomCommManager.SetTagUpdateHandler(g_cSocketName,{call:_this.ProcessUpdateTagsResponse}),g_oAxiomCommManager.SetFolderCreateHandler(g_cSocketName,{call:_this.ProcessAddFolderResponse}));var oFolderLayout=new StudioModeratedChatFolderLayout(this),oAttendeeLayout=new StudioModeratedChatAttendeeLayout(this),oEditLayout=new StudioModeratedChatEditLayout(this);oEditLayout.DataStore=this.DataStore;var oModListLayout=new StudioModeratedChatItemListLayout(this),oFolderManager=new StudioModeratedChatFolderManager(this);oFolderLayout.ShowHeader(!0),oFolderManager.OnSaveFn=function(oData){oData.Deleted&&oData.Key?_this.DeleteFolder(oData.Key):parseInt(oData.Key)&&!isNaN(parseInt(oData.Key))?_this.UpdateFolder(oData.Key,oData.Name,oData.DisplayOrder):_this.AddFolder(0,oData.Name,oData.DisplayOrder,null)};var oWrapper=document.createElement("div");oWrapper.className="StudioModeratedChatHeaderWrapper";var oMenuRow=document.createElement("div");oMenuRow.className="AxiomModeratedChatNavRow",oWrapper.appendChild(oMenuRow);var oClose=document.createElement("div");oClose.className="AxiomCardNavCloseButton",oClose.addEventListener("click",function(evt){_this.Components.FolderLayout.Component.Active=!1}),oMenuRow.appendChild(oClose);var oFolderHeader=document.createElement("div");oFolderHeader.className="StudioModeratedChatHeader",oWrapper.appendChild(oFolderHeader);var oFolderHeaderText=document.createElement("div");oFolderHeaderText.className="AxiomLabel",oFolderHeaderText.innerText=g_oMessages.FoldersLabel,oFolderHeader.appendChild(oFolderHeaderText);var oAddNew=document.createElement("div");oAddNew.className="AxiomAddNewIconSmall",oFolderHeader.appendChild(oAddNew),oAddNew.addEventListener("click",oFolderManager.LaunchAddFolderDialogue),oFolderLayout.Header.appendChild(oWrapper),oAttendeeLayout.ShowHeader(!0),oAttendeeLayout.FilterSuite=StudioModeratedChatAttendeeFilterSuite,oAttendeeLayout.Header.appendChild(oAttendeeLayout.FilterSuite.Container),oModListLayout.FilterSuite=StudioModeratedChatModeratorFilterSuite,oModListLayout.Header.appendChild(oModListLayout.FilterSuite.Container);var oModListSub1=new InxpoSubscriber("ItemAddedToCurrentFolder",oModListLayout.OnAddData),oModListSub2=new InxpoSubscriber("ItemRemovedFromCurrentFolder",oModListLayout.OnRemoveData),oModListSub3=new InxpoSubscriber("FolderSelected",oModListLayout.OnFolderSelect),oModListSub4=new InxpoSubscriber("RefreshCurrentFolder",oModListLayout.OnRefreshPageRequest);oFolderLayout.Publisher.Subscribe(oModListSub1),oFolderLayout.Publisher.Subscribe(oModListSub2),oFolderLayout.Publisher.Subscribe(oModListSub3),oFolderLayout.Publisher.Subscribe(oModListSub4);var oWorkerSub=new InxpoSubscriber("FolderSelected",oEditLayout.HideEditDialogue);oFolderLayout.Publisher.Subscribe(oWorkerSub);var oDragAndDrop=new StudioModeratedChatDragAndDropManager(this.Container,this),oHistoryLayout=new StudioModeratedChatHistoryLayout(this.DataStore,this,this.Components);this.AddComponent("DragAndDrop",oDragAndDrop),this.AddComponent("FolderLayout",oFolderLayout),this.AddComponent("FolderManager",oFolderManager),this.AddComponent("AttendeeLayout",oAttendeeLayout),this.AddComponent("EditLayout",oEditLayout),this.AddComponent("ModListLayout",oModListLayout),this.AddComponent("HistoryLayout",oHistoryLayout);var oFolder=new StudioModeratedChatFolder(-1,!0,this);oFolder.Name="All",oFolder.DisplayOrder=0,_this.Components.FolderLayout.Component.AddFolder(oFolder),oFolder.Container.addEventListener("dragenter",this.Components.DragAndDrop.Component.OnDragEnter),oFolder.Container.addEventListener("dragleave",this.Components.DragAndDrop.Component.OnDragLeave),oFolder.Container.addEventListener("dragover",function(evt){evt.preventDefault()}),oFolder.Container.addEventListener("drop",this.Components.DragAndDrop.Component.OnDrop),_this.Publisher.Publish("FolderAdded",{Folder:oFolder});var oContainer=document.getElementById("ModeratedChatFrame");if(oContainer&&(oContainer.appendChild(_this.Container),_this.OnResize(oContainer.offsetWidth,oContainer.offsetHeight)),_this.IsAdmin?(_this.ModeratorRow=StudioModeratedChatModeratorRow3,_this.AttendeeRow=StudioModeratedChatAttendeeViewModeratorRow):_this.AttendeeRow=StudioModeratedChatAttendeeRow,!g_oSettings.Demo){_this.ShowLoadingLayer(!0),_this.Components.ModListLayout&&_this.Components.ModListLayout.Component.FilterSuite&&(_this.Components.ModListLayout.Component.FilterSuite.Paused=!0),_this.Components.AttendeeLayout.Component&&(_this.Components.AttendeeLayout.Component.Loading=!0,_this.Components.AttendeeLayout.Component.FilterSuite&&(_this.Components.AttendeeLayout.Component.FilterSuite.Paused=!0));var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30315&EventKey="+g_oSettings.EventKey;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){if(!oResponse||0!=oResponse.Status)return;g_aChatStaffers=oResponse.ResultSet[1],g_aStudioModeratedChatPredefinedMessages=oResponse.ResultSet[2];for(var oFolderData,aFolders=oResponse.ResultSet[3]?oResponse.ResultSet[3]:[],iLup=0;iLup<aFolders.length;iLup++)oFolderData=aFolders[iLup],_this.AddFolder(oFolderData.FolderKey,oFolderData.FolderName,oFolderData.DisplayOrder,oFolderData.TagList);cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30330&EventKey="+g_oSettings.EventKey+"&IncludeEmptyResultSets=1",new AxiomHTTP(cURL,LoadChatDataComplete,!0,"GET",null,null);var cURL},!0,"GET",null,null)}function LoadChatDataComplete(oResponse,oAJAXObj){if(oResponse&&0==oResponse.Status){for(var oChat,oParent,oData,aTags,aQuestions=oResponse.ResultSet[0],aAnswers=oResponse.ResultSet[1],iLup=0;iLup<aQuestions.length&&!(oData=aQuestions[iLup]).NoQuestions;iLup++){var cTag;(oChat=new StudioModeratedChat(oData.QuestionKey,null,oData.UserKey,oData.UserType,oData.UserName,oData.QuestionText,oData.DateAsked,oData.QuestionNumber)).Priority=oData.Priority,oChat.ReadByModerator=1==g_oSettings.IsOnDemand,oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachModeratorAttendeeHandlers(oChat),_this.AddData(oChat),aTags=oData.TagList.split(",");for(var inLup=0;inLup<aTags.length;inLup++)(cTag=aTags[inLup])&&""!=cTag&&oChat.AddTag(cTag);oChat.AddTag("FOLDER_ALL")}for(iLup=0;iLup<aAnswers.length&&!(oData=aAnswers[iLup]).NoAnswers;iLup++)oParent=_this.DataStore.GetData(oData.QuestionKey),(oChat=new StudioModeratedChat(oData.AnswerKey,oData.QuestionKey,oData.UserKey,oData.UserType,oData.UserName,oData.AnswerText,oData.DateAnswered,0,1==oData.FromModerator)).AttendeeElementData=_this.AttendeeRow(oChat),oChat.Published=0==oData.Status,oParent&&(oParent.ReadByModerator=1==oData.FromModerator),_this.AddData(oChat);g_oAxiomCommManager&&g_oAxiomCommManager.GetQAStatusMessages(g_cSocketName),_this.Components.ModListLayout&&_this.Components.ModListLayout.Component.FilterSuite&&(_this.Components.ModListLayout.Component.FilterSuite.Paused=!1),_this.Components.AttendeeLayout.Component&&(_this.Components.AttendeeLayout.Component.FilterSuite&&(_this.Components.AttendeeLayout.Component.FilterSuite.Paused=!1),_this.Components.AttendeeLayout.Component.Loading=!1,_this.Components.AttendeeLayout.Component.ListObj.ScrollToBottom());var iEditQuestionKey=_this.Components.EditLayout.Component.CheckForEditUser(g_oSettings.UserKey);iEditQuestionKey&&_this.Components.EditLayout.Component.LoadChatThread(iEditQuestionKey),_this.Components.FolderLayout.Component.SelectFolder(oFolder.Key),_this.ShowLoadingLayer(!1)}}}function StudioModeratedChatLoadAttendee(){var _this=this;g_oAxiomCommManager&&(g_oAxiomCommManager.SetQuestionDeleteHandler(g_cSocketName,{call:_this.ProcessDeleteQuestionResponse}),g_oAxiomCommManager.SetGeneralStatusHandler(g_cSocketName,{call:_this.ProcessGeneralStatusResponse}),g_oAxiomCommManager.SetAnswerSaveModHandler(g_cSocketName,{call:_this.ProcessAnswerSaveModResponse}),g_oAxiomCommManager.SetAnswerSaveAttHandler(g_cSocketName,{call:_this.ProcessAnswerSaveAttResponse}),g_oAxiomCommManager.SetAnswerDeleteHandler(g_cSocketName,{call:_this.ProcessAnswerDeleteResponse}),g_oAxiomCommManager.SetFolderUpdateHandler(g_cSocketName,{call:_this.ProcessUpdateFolderResponse}),g_oAxiomCommManager.SetFolderDeleteHandler(g_cSocketName,{call:_this.ProcessDeleteFolderResponse}),g_oAxiomCommManager.SetStaffUpdateHandler(g_cSocketName,{call:_this.ProcessStaffUpdateResponse}),g_oAxiomCommManager.SetQuestionPriorityHandler(g_cSocketName,{call:_this.ProcessSetPriorityResponse}),g_oAxiomCommManager.SetQuestionSaveHandler(g_cSocketName,{call:_this.ProcessQueQuestionResponse}),g_oAxiomCommManager.SetQuestionBoradcastHandler(g_cSocketName,{call:_this.ProcessQueQuestionResponse}),g_oAxiomCommManager.SetTagUpdateHandler(g_cSocketName,{call:_this.ProcessUpdateTagsResponse}),g_oAxiomCommManager.SetFolderCreateHandler(g_cSocketName,{call:_this.ProcessAddFolderResponse}));var oAttendeeLayout=new StudioModeratedChatAttendeeLayout(this);oAttendeeLayout.ShowInput(!0),oAttendeeLayout.Active=!0,this.AddComponent("AttendeeLayout",oAttendeeLayout);var oContainer=document.getElementById("ModeratedChatFrame");if(oContainer&&(oContainer.appendChild(_this.Container),_this.OnResize(oContainer.offsetWidth,oContainer.offsetHeight)),!g_oSettings.Demo&&!_this.IsAdmin){_this.ShowLoadingLayer(!0);var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30311&EventKey="+g_oSettings.EventKey;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){if(!oResponse||0!=oResponse.Status)return;for(var oChat,oData,aQuestions=oResponse.ResultSet[0],aAnswers=oResponse.ResultSet[1],iLup=0;iLup<aQuestions.length&&!(oData=aQuestions[iLup]).NoQuestions;iLup++)(oChat=new StudioModeratedChat(oData.QuestionKey,null,oData.UserKey,oData.UserType,oData.UserName,oData.QuestionText,oData.DateAsked,oData.QuestionNumber)).Priority=oData.Priority,oChat.AttendeeElementData=_this.AttendeeRow(oChat),_this.AttachAttendeeHandlers(oChat),_this.AddData(oChat);for(var iLup=0;iLup<aAnswers.length&&!(oData=aAnswers[iLup]).NoAnswers;iLup++)(oChat=new StudioModeratedChat(oData.AnswerKey,oData.QuestionKey,oData.UserKey,oData.UserType,oData.UserName,oData.AnswerText,oData.DateAnswered,0,1==oData.FromModerator)).AttendeeElementData=_this.AttendeeRow(oChat),oChat.Published=0==oData.Status,_this.AddData(oChat);"undefined"!=typeof g_cWelcomeMsg&&""!=g_cWelcomeMsg&&setTimeout(function(){_this.Components.AttendeeLayout.Component.SetUserMessage(g_cWelcomeMsg,SMC_USER_MESSAGE_PERSIST)},2e3);g_oAxiomCommManager&&g_oAxiomCommManager.GetQAStatusMessages(g_cSocketName);setTimeout(function(){if(_this.IsAdmin){var iEditQuestionKey=_this.Components.EditLayout.Component.CheckForEditUser(g_oSettings.UserKey);iEditQuestionKey&&_this.Components.EditLayout.Component.LoadChatThread(iEditQuestionKey)}_this.ShowLoadingLayer(!1)},100)},!0,"GET",null,null)}}function SMCDeleteQuestion(iEventQuestionKey){if(g_oSettings.IsOnDemand){var cParams="LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30306&EventKey="+g_oSettings.EventKey;cParams+="&EventQuestionKey="+iEventQuestionKey;new AxiomHTTP(g_oSettings.LASFileName,function(cResponse,oAJAX){var oResponse=EvalResponse(cResponse);oResponse&&0==oResponse.Status&&oResponse.ResultSet[0]&&(oResponse=oResponse.ResultSet[0][0],g_oStudioManagedChatManager.ProcessDeleteQuestionResponse(oResponse))},!0,"POST",cParams,null)}else g_oAxiomCommManager.QuestionDelete(g_cSocketName,null,g_oSettings.EventAttendeeKey,iEventQuestionKey)}function SMCAddAnswerSaveMod(iReplyToEventQuestionKey,cAnswerText,cStatus,iEventQuestionAnswerKey){if(g_oSettings.IsOnDemand){var cParams="LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30316&EventKey="+g_oSettings.EventKey;cParams+="&EventQuestionAnswerKey="+(iEventQuestionAnswerKey||0),cParams+="&ReplyToQuestionKey="+iReplyToEventQuestionKey,cParams+="&AnswerText="+cAnswerText,cParams+="&Status="+cStatus;new AxiomHTTP(g_oSettings.LASFileName,function(oResponse,oAJAX){oResponse&&0==oResponse.Status&&oResponse.ResultSet[0]&&(oResponse=oResponse.ResultSet[0][0],g_oStudioManagedChatManager.ProcessAnswerSaveModResponse(oResponse))},!0,"POST",cParams,null)}else g_oAxiomCommManager.AnswerSaveMod(g_cSocketName,null,g_oSettings.EventAttendeeKey,iReplyToEventQuestionKey,cAnswerText,cStatus,iEventQuestionAnswerKey)}function SMCAnswerDelete(iEventQuestionKey,iEventQuestionAnswerKey){if(g_oSettings.IsOnDemand){var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30304&EventKey="+g_oSettings.EventKey+"&EventQuestionKey="+iEventQuestionKey+"&EventQuestionAnswerKey="+iEventQuestionAnswerKey;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){oResponse&&0==oResponse.Status&&oResponse.ResultSet[0]&&(oResponse=oResponse.ResultSet[0][0],g_oStudioManagedChatManager.ProcessAnswerDeleteResponse(oResponse))},!0,"GET",null,null)}else g_oAxiomCommManager.AnswerDelete(g_cSocketName,null,g_oSettings.EventAttendeeKey,iEventQuestionKey,iEventQuestionAnswerKey)}function SMCSetPriority(iEventQuestionKey,iPriority){if(g_oSettings.IsOnDemand){var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30307&EventKey="+g_oSettings.EventKey+"&EventQuestionKey="+iEventQuestionKey+"&Priority="+iPriority;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){oResponse&&0==oResponse.Status&&oResponse.ResultSet[0]&&(oResponse=oResponse.ResultSet[0][0],g_oStudioManagedChatManager.ProcessSetPriorityResponse(oResponse))},!0,"GET",null,null)}else g_oAxiomCommManager.QuestionPriority(g_cSocketName,null,g_oSettings.EventAttendeeKey,iEventQuestionKey,iPriority)}function SMCAddFolder(iFolderKey,cFolderName,iDisplayOrder,cTagList){if(iFolderKey||-1==iFolderKey)g_oStudioManagedChatManager.ProcessAddFolderResponse({FolderKey:iFolderKey,FolderName:cFolderName,DisplayOrder:iDisplayOrder,TagList:cTagList});else if(g_oSettings.IsOnDemand){var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30320&EventKey="+g_oSettings.EventKey+"&FolderName="+cFolderName+"&DisplayOrder="+iDisplayOrder;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){oResponse&&0==oResponse.Status&&oResponse.ResultSet[0]&&g_oStudioManagedChatManager.ProcessAddFolderResponse({FolderKey:oResponse.ResultSet[0][0].FolderKey,FolderName:cFolderName,DisplayOrder:iDisplayOrder})},!0,"GET",null,null)}else g_oAxiomCommManager.FolderCreate(g_cSocketName,null,g_oSettings.EventAttendeeKey,cFolderName,iDisplayOrder)}function SMCUpdateFolder(iFolderKey,cFolderName,iDisplayOrder){if(g_oSettings.IsOnDemand){var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30321&FolderKey="+iFolderKey+"&FolderName="+cFolderName+"&DisplayOrder="+iDisplayOrder;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){oResponse&&0==oResponse.Status&&g_oStudioManagedChatManager.ProcessUpdateFolderResponse({FolderName:cFolderName,FolderKey:iFolderKey,DisplayOrder:iDisplayOrder})},!0,"GET",null,null)}else g_oAxiomCommManager.FolderUpdate(g_cSocketName,null,g_oSettings.EventAttendeeKey,iFolderKey,cFolderName,iDisplayOrder)}function SMCDeleteFolder(iFolderKey){if(g_oSettings.IsOnDemand){var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30322&FolderKey="+iFolderKey;new AxiomHTTP(cURL,function(oResponse,oAJAXObj){oResponse&&0==oResponse.Status&&g_oStudioManagedChatManager.ProcessDeleteFolderResponse({FolderKey:iFolderKey})},!0,"GET",null,null)}else g_oAxiomCommManager.FolderDelete(g_cSocketName,null,g_oSettings.EventAttendeeKey,iFolderKey)}function SMCUpdateTags(iSource,iKeyVal,cTagList){if(g_oSettings.IsOnDemand){var cURL=g_oSettings.LASFileName+"?LASCmd=AI:"+g_oSettings.InstanceID+";F:LBSEXPORT!JSON&SQLID=30325&EventKey="+g_oSettings.EventKey+"&Source="+iSource+"&KeyVal="+iKeyVal+"&TagList="+URLEncode(cTagList);new AxiomHTTP(cURL,function(oResponse,oAJAXObj){oResponse&&0==oResponse.Status&&g_oStudioManagedChatManager.ProcessUpdateTagsResponse({Source:iSource,KeyVal:iKeyVal,TagList:cTagList})},!0,"GET",null,null)}else g_oAxiomCommManager.TagUpdate(g_cSocketName,null,g_oSettings.EventAttendeeKey,iSource,iKeyVal,cTagList)}function SMCGeneralStatusUpdate(iEventQuestionKey,cUserID,iStatus){g_oSettings.IsOnDemand?g_oStudioManagedChatManager.ProcessGeneralStatusResponse({QuestionKey:iEventQuestionKey,Sender:cUserID,Status:iStatus}):g_oAxiomCommManager.GeneralStatus(g_cSocketName,null,g_oSettings.EventAttendeeKey,iEventQuestionKey,cUserID,iStatus)}